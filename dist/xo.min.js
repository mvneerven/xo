!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("node:util"),require("regenerator-runtime/runtime")):"function"==typeof define&&define.amd?define(["node:util","regenerator-runtime/runtime"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).xo=t()}(this,(function(){"use strict";function e(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class t{constructor(e){this.obj=e,this.eventTarget=document.createDocumentFragment(),["addEventListener","dispatchEvent","removeEventListener"].forEach(this.delegate,this)}delegate(e){this.obj[e]=this.eventTarget[e].bind(this.eventTarget)}}class i{static addEvents(e){new t(e)}static getObjectValue(e,t,s){t=i.stringToPath(t);for(var n=e,r=0;r<t.length;r++){if(void 0===typeof n[t[r]])return s;n=n[t[r]]}return n}static stringifyJs(e,t,i){const s=(e,t,i,n)=>{let r=typeof e,a=e=>" ".repeat(i*e);if("function"===r)return e.toString();if("object"!==r)return JSON.stringify(e,t);if(Array.isArray(e)){let r="[\n",o=[];return r+=a(++n),e.forEach((e=>{o.push(s(e,t,i,n))})),r+=o.join(","),r+="\n"+a(--n)+"]",r}let o="";return o+="{\n"+a(++n),o+=Object.keys(e).filter((e=>!e.startsWith("_"))).map((r=>`${r}: ${s(e[r],t,i,n)}`)).join(",\n"+a(n))+"\n",o+=a(--n)+"}",o};return s(e,t,i,0)}static scopeEval(e,t){return Function('"use strict";'+t).bind(e)()}static isUrl(e){try{return"string"==typeof e&&(-1===e.indexOf("\n")&&-1===e.indexOf(" ")&&(new URL(e,window.location.origin),!0))}catch{}return!1}static setObjectValue(e,t,s){t=i.stringToPath(t);for(var n=e,r=0;r<t.length;r++)n=n[t[r]],r===t.length-2&&(n[t[r+1]]=s)}static stringToPath(e){if("string"!=typeof e)return e;var t=[];return e.split(".").forEach((function(e){e.split(/\[([^}]+)\]/g).forEach((function(e){e.length>0&&t.push(e)}))})),t}static compare(e,t,i){return this.operatorTable[e](t,i)}static stringifyJSONWithCircularRefs(e){var t=[],i=JSON.stringify(e,((e,i)=>{if("object"==typeof i&&null!==i){if(t.includes(i))return;t.push(i)}return i}),2);return t=null,i}static toPascalCase(e){return"string"!=typeof e?e:e.replace(/(\w)(\w*)/g,(function(e,t,i){return t.toUpperCase()+i.toLowerCase()}))}static prettyPrintJSON(e){return JSON.stringify(e,null,3).replace(/&/g,"&amp;").replace(/\\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/^( *)("[\w]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/gm,(function(e,t,i,s,n){var r=t||"";return i&&(r=r+'<span class="json-key" style="color: brown">'+i.replace(/[": ]/g,"")+"</span>: "),s&&(r=r+('"'==s[0]?'<span class="json-string" style="color: olive">':'<span class="json-value" style="color: navy">')+s+"</span>"),r+(n||"")}))}static guid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}static async waitFor(e,t){return new Promise(((i,s)=>{let n=new Date,r=setInterval((function(){e()?(clearInterval(r),i()):new Date-n>t&&(clearInterval(r),s())}),20)}))}static isValidUrl(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}static toWords(e){var t=e.replace(/([A-Z])/g," $1");return t.charAt(0).toUpperCase()+t.slice(1)}}e(i,"operatorTable",{">":(e,t)=>e>t,"<":(e,t)=>e<t,">":(e,t)=>e>=t,"<=":(e,t)=>e<=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"&&":(e,t)=>e&&t}),e(i,"Iterator",class{constructor(e,t){for(var i in this.index=[],this.i=0,this.o=e,e)this.index.push({key:i,order:e[i][t]});this.index.sort((function(e,t){var i=e.order,s=t.order;return i==s?0:i>s?1:-1})),this.len=this.index.length}next(){return this.i<this.len?this.o[this.index[this.i++].key]:null}});class s{static parseHTML(e){return(new DOMParser).parseFromString(e,"text/html").body.firstChild}static getValue(e){if(s._checkNull("getValue",e),"select"===e.type||"select-one"===e.type)return-1!==e.selectedIndex?e.options[e.selectedIndex].value:void 0;if("radio"===e.type){let t=e.closest('[data-name="'+e.name+'"]').querySelector(":checked");return t?t.value:void 0}return e.value}static setValue(e,t){s._checkNull("setValue",e),e.value=t}static elementPath(e){return e.toString()}static elementToString(e){s._checkNull("elementToString",e);let t=[];return e&&e.nodeName&&t.push(e.nodeName),e.id&&t.push("#",e.id),e.classList&&e.classList.length&&(t.push("."),t.push(Array(e.classList).join("."))),t.join("")}static _checkNull(e,t){}static hide(e){s._checkNull("hide",e),e.style.display="none"}static show(e){s._checkNull("show",e),e.style.display="block"}static enable(e){s._checkNull("enable",e),e.removeAttribute("disabled")}static disable(e){s._checkNull("disable",e),e.setAttribute("disabled","disabled")}static trigger(e,t,i){s._checkNull("trigger",e);let n=new Event(t);n.detail=i,e.dispatchEvent(n)}static throttleResize(e,t){s._checkNull("throttleResize",e);let i;t(),e.addEventListener("resize",(e=>{clearTimeout(i),i=setTimeout(t,100)}))}static changeHash(e){history.replaceState(null,null,document.location.pathname+"#"+e)}static prettyPrintHTML(e){var t=document.createElement("div");return t.innerHTML=e.trim(),s.formatHTMLNode(t,0).innerHTML.trim()}static formatHTMLNode(e,t){for(var i,n=new Array(1+t++).join("  "),r=new Array(t-1).join("  "),a=0;a<e.children.length;a++)i=document.createTextNode("\n"+n),e.insertBefore(i,e.children[a]),s.formatHTMLNode(e.children[a],t),e.lastElementChild==e.children[a]&&(i=document.createTextNode("\n"+r),e.appendChild(i));return e}static setupGrid(){const e=document.querySelector("HTML");s.throttleResize(window,(t=>{((t,i)=>{const s="nsp-",n={xs:768,sm:992,md:1200,lg:1440,xl:1920,uw:2300};var r="nsp-xs";for(var a in n)e.classList.remove(s+a),t>n[a]&&(r=s+a);e.classList.remove("nsp-portrait"),e.classList.remove("nsp-landscape"),e.classList.add(t>i?"nsp-landscape":"nsp-portrait"),e.classList.add(r)})(window.innerWidth,window.innerHeight)}))}static parseCSS(e){let t=document.implementation.createHTMLDocument(""),i=document.createElement("style");return i.textContent=e,t.body.appendChild(i),i.sheet.cssRules}static waitFor(e,t){return t||(t=1e3),i.waitFor((()=>document.querySelector(e)),t)}static require(e,t){"string"==typeof e&&(e=[e]);var i=document;let s=0;return new Promise(((n,r)=>{e.forEach((r=>{let a=i.createElement("script");a.src=r,i.head.appendChild(a),a.onload=i=>{s++,s===e.length&&("function"==typeof t&&t(),n())}}))}))}static addStyleSheet(e,t){var i=document;if(i.querySelector("head > link[rel=stylesheet][href='"+e+"']"))return;let s=i.createElement("link");if(s.rel="stylesheet",s.href=e,t)for(var n in t)s.setAttribute(n,t[n]);i.head.appendChild(s)}static format(e,t,s){if(s=s||{empty:""},e="function"==typeof e?e():e,-1===["string","number"].indexOf(typeof e))throw"Placeholders: please provide a valid template";return t?e=e.replace(/\{\{([^}]+)\}\}/g,(function(e){e=e.slice(2,-2);var n=i.getObjectValue(t,e.trim());return n||(void 0!==s.empty?s.empty:"{{"+e+"}}")})):e}static replace(e,t){let i=e;return i.parentNode.insertBefore(t,i),i.remove(),t}static unwrap(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);return t.removeChild(e),t}static copyToClipboard(e){const t=window.getSelection(),i=document.createRange();i.selectNodeContents(e),t.removeAllRanges(),t.addRange(i);const s=document.execCommand("copy");return window.getSelection().removeAllRanges(),s}static maskInput(e,t){t.pattern,t.mask;const i=(e,t,i)=>{for(var s=e.replace(/[^0-9]/g,"").split(""),n=0,r="",a=0;a<t.length;a++){const e=t[a];s[n]?/\*/.test(e)?(r+=s[n],n++):r+=e:i&&i.split("")[a]&&(r+=i.split("")[a])}return r},s=e=>{const t=i(e.value,e.getAttribute("data-format"));if(e.value=i(e.value,e.getAttribute("data-format"),e.getAttribute("data-mask")),e.createTextRange){var s=e.createTextRange();s.move("character",t.length),s.select()}else e.selectionStart&&(e.focus(),e.setSelectionRange(t.length,t.length))};e.addEventListener("keyup",(function(){s(e)})),e.addEventListener("keydown",(function(){s(e)})),s(e)}}e(s,"DragDropSorter",class{constructor(e,t,s){i.addEvents(this),this.masterContainer=e,this.selector=t,this.childSelector=s,this.dragSortContainers=e.querySelectorAll(t),console.debug("dragSortContainers selected for dragdrop sorting: "+this.dragSortContainers.length,", selector: ",t),this.enableDragList(e,s)}triggerEvent(e,t){console.debug("Triggering event",e,"detail: ",t);let i=new Event(e);i.detail=t,this.dispatchEvent(i)}on(e,t){return console.debug("Listening to event",e,t),this.addEventListener(e,t),this}enableDragList(e,t){let i=e.querySelectorAll(t);console.debug("Elements selected for dragdrop sorting: "+i.length,", childSelector: ",t),i.forEach((e=>{this.enableDragItem(e)}))}enableDragItem(e){e.setAttribute("draggable",!0),e.ondrag=e=>{this.handleDrag(e)},e.ondragend=e=>{this.handleDrop(e)}}handleDrag(e){const t=e.target,i=t.closest(this.selector),s=e.clientX,n=e.clientY;t.classList.add("drag-sort-active");let r=t.closest(this.selector);r&&(r.classList.add("drag-sort-in-process"),console.debug("drag starts: "+t.class,", container:",r.class));let a=null===document.elementFromPoint(s,n)?t:document.elementFromPoint(s,n);i===a.parentNode&&(a=a!==t.nextSibling?a:a.nextSibling,i.insertBefore(t,a))}handleDrop(e){e.target.classList.remove("drag-sort-active"),console.debug("drag stopped: "+e.target.class);let t=e.target.closest(this.selector);t&&(console.debug("Sort container: "+t.class),t.classList.remove("drag-sort-in-process")),this.triggerEvent("sort",{order:this.getOrder()})}getOrder(){return[]}destroy(){this.masterContainer.querySelectorAll("[draggable]").forEach((e=>{e.draggable=!1,e.ondrag=null,e.ondragend=null}))}}),e(s,"_staticConstructor",void s.setupGrid());class n{constructor(e){this.dataBinding=e,this.exo=e.exo,this._boundControlState=[]}addBoundControl(e){this._boundControlState.push(e)}resolve(){this._checkSchemaLogic(),this._replaceVars(this.exo.container),this._bindControlStateToUpdatedModel()}_resolveVars(e,t,i){return e.replace(/(?:^|[\s/+*(-])[@]([A-Za-z_]+[A-Za-z_0-9.]*[A-Za-z_]+[A-Za-z_0-9]*)(?=[\s+/*,.?!)]|$)/gm,((e,s)=>(i.push(e)," "+t(s))))}_replaceVars(e){let t=[];if(3==e.nodeType){let i=e.data;e.parentElement.data&&e.parentElement.data.origData&&(i=e.parentElement.data.origData),i=this._resolveVars(i,(e=>this.dataBinding.get(e,"")),t),t.length&&(e.parentElement.data&&void 0!==e.parentElement.data.origData||(e.parentElement.data=e.parentElement.data||{},e.parentElement.data.origData=e.data),e.data=i)}if(1==e.nodeType&&"SCRIPT"!=e.nodeName)for(var i=0;i<e.childNodes.length;i++)this._replaceVars(e.childNodes[i])}_checkSchemaLogic(){const e=this.exo.dataBinding.model;if(e&&e.logic)if("function"==typeof e.logic)this.applyJSLogic(e.logic,null,e);else if(e.logic&&"JavaScript"===e.logic.type){let t=this.assembleScript(e.logic);this.applyJSLogic(null,t,e)}}assembleScript(e){return e&&Array.isArray(e.lines)?"let model = this.dataBinding.model;\n"+e.lines.join("\n"):""}applyJSLogic(e,t,s){try{e?s.logic.bind(this.exo)(s,this.exo):i.scopeEval(this.exo,t)}catch(e){console.error(e),this.dataBinding._signalDataBindingError(e)}}_bindControlStateToUpdatedModel(){this._boundControlState.forEach((e=>{let t=this.dataBinding.get(e.path);console.debug("Databinding: bindControlStateToUpdatedModel",e.propertyName,"on",ne.fieldToString(e.field),"to",t,e.path),e.control[e.propertyName]=t}))}}class r{constructor(t,s){e(this,"_model",{instance:{},bindings:{}}),this.exo=t,i.addEvents(this),this._init(t,s),this._resolver=new n(this),t.on(ne.events.renderStart,(e=>{this.resolver._checkSchemaLogic()})),t.on(ne.events.renderReady,(e=>{t.on(ne.events.dataModelChange,(e=>{this.resolver.resolve()})),this.resolver.resolve()})),this._ready()}get resolver(){return this._resolver}_ready(){const e=this.exo;e.on(ne.events.schemaLoaded,(()=>{let t={};const i=[r.origins.bind,r.origins.schema].includes(this._origin);console.log("Model set up: "+i),e.query((e=>{e.name&&(e.bind||i||(e.bind="instance.data."+e.name),e.bind&&(e.value=(i?this.get(e.bind):e.value)||"",console.debug("ExoFormDatabinding: applying instance."+e.name,e.bind,e.value),t[e.name]=e.value))})),i||(console.log("Fill initial model",t),this._model.instance.data=t),console.log("Firing Model ready event ",this._model.instance),this._triggerEvent("ready",{model:this._model})})).on(ne.events.interactive,(()=>{e.form.addEventListener("change",(e=>{let t=ne.getFieldFromElement(e.target,{master:!0});if(t&&t.bind){let e=t._control.value;i.setObjectValue(this._model,t.bind,e),console.log("Model Instance changed",t.bind,e,this._model.instance),this._mapped&&(this._mapped=this._model.instance),this._triggerEvent("change",{model:this._model,changed:t.bind,value:e})}}))}))}_triggerEvent(e,t,i){return console.debug("ExoFormDatabinding: triggering event",e,"detail: ",t),i||(i=new Event(e,{bubbles:!1,cancelable:!0})),i.detail={app:this,...t||{}},this.dispatchEvent(i)}_signalDataBindingError(e){this._triggerEvent("error",{exo:this.exo,error:e})}get(e,t){let s=null;try{s=i.getObjectValue(this._model,e,t)}catch(e){this._signalDataBindingError(e)}return s}on(e,t){return console.debug("ExoFormDatabinding: listening to event",e,t),this.addEventListener(e,t),this}_init(e,t){t?(this._mapped=t,this._model.instance=t,this._origin=r.origins.bind):e.schema.model?(this._origin=r.origins.schema,this._model={...e.schema.model},this._model.bindings=this._model.bindings||{}):this._origin=r.origins.none}toString(){return JSON.stringify(this.model,null,2)}get model(){if(!this._instanceInitialized)try{if(this._origin===r.origins.none){let e=this.exo.getFormValues();this._model.instance={data:e}}}catch{}finally{this._instanceInitialized=!0,this._model.instance=this._model.instance||{data:{}}}return this._model}_processFieldProperty(e,t,i){let s=i;if("string"==typeof i&&i.startsWith("@")){let n=i.substring(1);console.debug("ExoFormDatabinding: resolving databound control property",t,i,"path:",n),s=this.get(n,void 0),void 0===s?s=i:(console.debug("ExoFormDatabinding: resolved databound control property",t,i,s),this.resolver.addBoundControl({control:e,field:e.context.field,path:n,propertyName:t,originalBoundValue:s}))}return s}}e(r,"origins",{schema:"schema",bind:"bind",none:"none"});class a{constructor(t){e(this,"types",{unknown:void 0,js:"javascript",json:"json"}),i.addEvents(this),this._type=this.types.undefined,this.options=t||{}}parse(e){if("object"!=typeof e){let t=ne.tryScriptLiteral(e);if(t)this._type=this.types.js,e=t;else try{e=JSON.parse(e),this._type=this.types.json}catch(e){throw"ExoFormSchema: could not convert string to ExoForm schema: "+e.toString()}}if(!e||!e.pages||!Array.isArray(e.pages))throw"ExoFormSchema: invalid ExoForm schema";this._schemaData={...this.options.defaults||{},...e},this._schemaData.form=this._schemaData.form||{},this._schemaData.pages=this._schemaData.pages||[],this._totalFieldCount=this.query().length}triggerEvent(e,t,i){return console.debug("Triggering event",e,"detail: ",t),i||(i=new Event(e,{bubbles:!1,cancelable:!0})),i.detail={exoForm:this,...t||{}},this.dispatchEvent(i)}get type(){return this._type}on(e,t){return console.debug("Listening to event",e,t),this.addEventListener(e,t),this}get data(){return this._schemaData}toString(e){switch(void 0===e&&(e=this.type||this.guessType()),e){case"js":case"javascript":return this.toJSString();case"json":return this.toJSONString()}return super.toString()}get navigation(){return this._schemaData.navigation}get validation(){return this._schemaData.validation}get progress(){return this._schemaData.progress}get rules(){return this._schemaData.rules}get theme(){return this._schemaData.theme}guessType(){return"function"==typeof this.model.logic?this.types.js:this.types.json}toJSONString(){return JSON.stringify(this._schemaData,((e,t)=>{if(!e.startsWith("_"))return t}),2)}toJSString(){return"const schema = "+i.stringifyJs(this._schemaData,null,2)}get form(){return this._schemaData.form}get pages(){return this._schemaData.pages}get model(){return this._schemaData.model}query(e,t){void 0===e&&(e=()=>!0);let i=[];if(!this._schemaData||!this._schemaData.pages||!Array.isArray(this._schemaData.pages))return i;let s=0;return this._schemaData.pages.forEach((t=>{s=0,e(t,{type:"page",pageIndex:0})&&Array.isArray(t.fields)&&t.fields.forEach((t=>{t._page={index:0},e(t,{type:"field",fieldIndex:s})&&i.push(t),s++}))})),i}get fieldCount(){return this._totalFieldCount}}class o{static setup(){}constructor(e,t){if(i.addEvents(this),!(e&&e instanceof ne.Context))throw"ExoForm: invalid instantiation of ExoForm: need ExoFormContext instance";this.context=e,t=t||{};this.options={type:"form",customMethods:{},...t},this.form=document.createElement("form"),this.form.setAttribute("method","post"),this.form.classList.add("exf-form"),this.container=s.parseHTML(o.meta.templates.exocontainer)}get schema(){return this._schema}load(e,t){const s=this;return(t=t||{mode:"async"}).mode.startsWith("sync")?this.loadSchema(e):new Promise(((t,n)=>{const r=e=>{e?(this.loadSchema(e),t(s)):t(s)};if(i.isUrl(e)){let t=new URL(e,this.context.baseUrl);try{"js"===t.toString().split(".").pop()?fetch(t).then((e=>e.text())).then((e=>{r(e)})).catch((e=>{n(e)})):fetch(t).then((e=>e.json())).then((e=>{r(e)})).catch((e=>{n(e)}))}catch(e){n(e)}}else r(e)}))}loadSchema(e){if(this._schema=this.context.createSchema(),this._schema.parse(e),this._dataBinding=new r(this,this._mappedInstance),this.dataBinding.on("change",(e=>{e.detail.state="change",this.triggerEvent(ne.events.dataModelChange,e.detail)})).on("ready",(e=>{e.detail.state="ready",this.triggerEvent(ne.events.dataModelChange,e.detail)})).on("error",(e=>{this.triggerEvent(ne.events.error,e.detail)})),this.triggerEvent(ne.events.schemaLoaded),this._createComponents(),this.schema.form){(this.schema.form.class?this.schema.form.class.split(" "):["standard"]).forEach((e=>{this.form.classList.add(e)}))}}get dataBinding(){return this._dataBinding}bind(e){this._mappedInstance=e}_createComponents(){for(var e in this.addins={},ne.meta){let t=ne.meta[e].type.getType(this);console.debug("ExoForm:",e,"component used:",t.name),this.addins[e]=new t(this)}}triggerEvent(e,t,i){return console.debug("ExoForm: triggering event",e,"detail: ",t),i||(i=new Event(e,{bubbles:!1,cancelable:!0})),i.detail={exoForm:this,...t||{}},this.dispatchEvent(i)}renderForm(){const e=this;return e.triggerEvent(ne.events.renderStart),e._cleanup(),new Promise(((t,i)=>{e.container.appendChild(e.form);try{e._renderPages().then((()=>{e._finalizeForm(),t(e)})).catch((e=>{i("_renderPages() failed: "+e.toString())}))}catch(e){i("Exception in _renderPages(): "+e.toString())}}))}_finalizeForm(){this.addins.navigation.render(),this.addins.progress.render(),this.addins.theme.apply(),this.form.addEventListener("submit",(e=>{e.preventDefault(),e.stopPropagation(),this.submitForm(e)})),this.form.addEventListener("change",(e=>{e.stopPropagation()})),this.addins.rules.checkRules(),this.addins.navigation.restart(),this.triggerEvent(ne.events.renderReady),new IntersectionObserver(((e,t)=>{this.container.offsetHeight&&(console.debug("ExoForm: interactive event"),this.triggerEvent(ne.events.interactive))}),{root:document.documentElement}).observe(this.container)}_cleanup(){this.addins&&this.addins.navigation&&this.addins.navigation.clear(),this.container&&(this.container.innerHTML="")}on(e,t){return console.debug("ExoForm: added event listener",e,t),this.addEventListener(e,t),this}_renderPages(){const e=this;return new Promise(((t,i)=>{var n=0;let r=0;e.pageContainer=s.parseHTML('<div class="exf-wrapper" />'),e.schema.pages.forEach((a=>{n++,a=e._enrichPageSettings(a,n),e.pageContainer.appendChild(a.dummy),e.createControl(a).then((o=>{let l=0;a.fields.forEach((c=>{console.debug("ExoForm: rendering field",c.name,c),c.dummy=s.parseHTML("<span/>"),o.appendChild(c.dummy),e.createControl(c).then((()=>{c._control.render().then((e=>{if(!e)throw"ExoForm: "+ne.fieldToString(c)+" does not render an HTML element";l=this._addRendered(c,e,l,a,o)})).catch((e=>{this.triggerEvent(ne.events.error,{error:e}),console.error(e);let t=s.parseHTML(s.format('<span class="exf-error exf-render-error" title="{{title}}">ERROR</span>',{title:"ExoForm: error rendering field "+ne.fieldToString(c)+": "+e.toString()}));l=this._addRendered(c,t,l,a,o)})).finally((i=>{if(r++,r===e.schema.fieldCount)if(e.container.classList.add(n>1?"exf-multi-page":"exf-single-page"),e.schema.form.container){let i=e._getFormContainerProps(e);e.createControl(i).then((i=>{i.render().then((n=>{n.appendChild(e.pageContainer),e.pageContainer=s.unwrap(e.pageContainer),i.finalize(e.pageContainer),e.form.appendChild(n),t()}))}))}else e.form.appendChild(e.pageContainer),t()}))})).catch((e=>{i("Exception in createControl() for control "+ne.fieldToString(c)+": "+e.toString())}))}))})).catch((e=>{i("Exception in createControl() for page container "+ne.fieldToString(a)+": "+e.toString())}))}))}))}_addRendered(e,t,i,n,r){return s.replace(e.dummy,t),delete e.dummy,++i===n.fields.length&&(console.debug("ExoForm: page",n.index+"rendered with",i," controls"),r.render().then((e=>{s.replace(n.dummy,e),delete n.dummy}))),i}_getFormContainerProps(){return{type:"div",class:"exf-wrapper",...this.schema.form.container,pages:this.schema.pages&&this.schema.pages.length?this.schema.pages.map((e=>({id:"page"+e.id,caption:e.legend}))):[]}}_enrichPageSettings(e,t){return e.index=t,e.isPage=!0,e.type=e.type||"fieldset",e.class="exf-cnt exf-page"+(e.class?" "+e.class:""),e.dummy=document.createElement("span"),e}query(e,t){return void 0===e&&(e=()=>!0),t=t||{},this.schema.query(((i,s)=>"page"===s.type?!t.inScope||this.isPageInScope(s.pageIndex):e(i,s)))}isPageInScope(e){return null!==this.form.querySelector(".exf-page[data-page='"+e.index+"']:not([data-skip='true'])")}get(e){let t=this.query((t=>t.name===e));return t.length?t[0]:null}map(e){return this.query().forEach((t=>{let i=e(t);void 0!==i&&(t.value=i,t._control.value=i)})),this}submitForm(e){if(e&&e.preventDefault(),!this.addins.validation.checkValidity())return console.debug("checkValidity - Form not valid"),void this.addins.validation.reportValidity();this.form;let t=this.getFormValues(e);this.triggerEvent(ne.events.post,{postData:t})}getFormValues(){const e={};return this.query().forEach((t=>{t._control&&(e[t.name]=t._control.value)})),e}getFieldValue(e){if(e&&e._control)return e._control.value;if(e.form&&e.name){let t=ne.getFieldFromElement(e);if(t)return t._control.value}}async renderSingleControl(e){let t=await this.createControl(e);e._control=t;let i=await t.render();if(!i)throw ne.fieldToString(e)+" does not render an HTML element";return i}createControl(e){const t=this;return new Promise(((i,n)=>{const r=(e,t)=>{e._control=t,t.htmlElement.data=t.htmlElement.data||{},t.htmlElement.data.field=e,t.htmlElement.setAttribute("data-exf","1"),console.debug("ExoForm: resolving ",ne.fieldToString(e)),i(t)};try{if(!e||!e.type)throw"ExoForm: incorrect field options. Must be object with at least 'type' property. "+JSON.stringify(e);e.id=e.id||t._generateUniqueElementId();let i=t.context.get(e.type);if(!i)throw"ExoForm: "+e.type+" is not a registered ExoForm field type";let s=i.type;if(!s)throw"ExoForm: class for "+e.type+" not defined";if(!t.context.isExoFormControl(e))throw"ExoForm: cannot create control: class for "+e.type+" is not derived from ExoControlBase";let n=null,a={exo:t,field:e};e.custom?ne.loadCustomControl(e,e.custom).then((t=>{let i=t.default;n=new i(a),r(e,n)})):(n=new s(a),r(e,n))}catch(i){let n=new(t.context.get("div").type)({exo:t,field:{...e}});t.triggerEvent(ne.events.error,{stage:"Create",error:i}),console.error(i),n.htmlElement.appendChild(s.parseHTML(s.format('<span class="exf-error exf-create-error" title="{{title}}">ERROR</span>',{title:"Error creating "+ne.fieldToString(e)+": "+i.toString()}))),r(e,n)}}))}_generateUniqueElementId(){let e=i.guid();return e=e.split("-"),e=e[e.length-1],"exf"+e}clear(){this.form.reset(),this.form.querySelectorAll(".clearable").forEach((e=>{e.innerHTML=""}))}}e(o,"meta",{properties:{all:["accept","alt","autocomplete","autofocus","capture","checked","dirName","disabled","height","list","max","maxLength","min","minLength","multiple","name","pattern","placeholder","readOnly","required","size","src","step","type","value","width","className"],map:{class:"className",readonly:"readOnly",dirname:"dirName",minlength:"minLength",maxlength:"maxLength"},reserved:["caption","template","elm","ctl","tagname","ispage"]},templates:{empty:'<span data-replace="true"></span>',exocontainer:'<div class="exf-container"></div>',legend:'<legend class="exf-page-title">{{legend}}</legend>',pageIntro:'<p class="exf-page-intro">{{intro}}</p>',datalist:'<datalist id="{{id}}"></datalist>',datalistItem:'<option label="{{label}}" value="{{value}}" >',button:'<button name="{{name}}" type="{{type}}" class="btn {{class}}">{{caption}}</button>'}}),e(o,"_staticConstructor",void o.setup());class l{constructor(t){if(e(this,"attributes",{}),e(this,"_visible",!0),e(this,"_disabled",!1),e(this,"_rendered",!1),e(this,"acceptedProperties",[]),e(this,"dataProps",{}),this.constructor===l)throw new Error("Can't instantiate abstract class!");if(this.context=t,!t||!t.field||!t.exo)throw"Invalid instantiation of ExoControlBase";this.htmlElement=document.createElement("span"),this.acceptProperties({name:"visible"},{name:"disabled"})}_getContainerTemplate(e){if(this.context.field.isPage)return s.format('<span data-replace="true"></span>',this._getContainerAttributes());if("button"===this.context.field.type){const e='<div data-id="{{id}}" class="exf-ctl-cnt {{class}"><span data-replace="true"></span></div>';return s.format(e,this._getContainerAttributes())}return`<div data-id="${e.id}" class="${e.class}" data-field-type="${e.type}">\n    <div class="exf-ctl">\n        <label for="${e.id}" aria-hidden="true" class="exf-label" title="${e.caption}">${e.caption}</label>\n        \n        <span data-replace="true"></span>\n        \n    </div>\n    <div class="exf-fld-details">\n        <div class="exf-help-wrapper"></div>\n    </div>\n</div>`}set htmlElement(e){this._htmlElement=e,this.allowedAttributes=ne.listNativeProps(this.htmlElement),this.isSelfClosing=["area","base","col","embed","hr","img","input","link","meta","param","source","track","wbr"].includes(e.tagName.toLowerCase())}get htmlElement(){return this._htmlElement}appendChild(e){this.htmlElement.appendChild(e)}typeConvert(e){return ne.checkTypeConversion(this.context.field.type,e)}get value(){let e=this.htmlElement.value;return this.typeConvert(e)}set value(e){this.htmlElement.value=e}triggerChange(e){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),t.detail=e,this.htmlElement.dispatchEvent(t)}set visible(e){(this._visible=e,this.rendered)&&((this.container||this.htmlElement).style.display=e?"block":"none")}get visible(){return this._visible}set disabled(e){this._disabled=e,this.rendered&&(e?(this.htmlElement.setAttribute("disabled","disabled"),this.container.classList.add("exf-disabled")):(this.htmlElement.removeAttribute("disabled"),this.container.classList.remove("exf-disabled")))}get rendered(){return this._rendered}get disabled(){return this._disabled}acceptProperties(...e){e.forEach((e=>{"string"==typeof e&&(e={name:e}),this.acceptedProperties.find((t=>t.name===e.name))||(this.acceptedProperties.push(e),void 0!==this.context.field[e.name]&&(this[e.name]=this._processProp(e.name,this.context.field[e.name])))}))}_scope(){let e=this.context.field;return{...e,caption:e.caption||"",tooltip:e.tooltip||"",class:"",id:e.id}}_addContainerClasses(){this.container.classList.add(...this._getContainerClasses())}_getContainerClasses(){let e=[];if(this.isPage||e.push("exf-ctl-cnt"),e.push("exf-base-"+this._getBaseType()),this.context.field.containerClass){this.context.field.containerClass.trim().split(" ").forEach((t=>{e.push(t)}))}return"INPUT"!==this.htmlElement.tagName&&"TEXTAREA"!==this.htmlElement.tagName||e.push("exf-input"),this.context.field.readOnly&&e.push("exf-readonly"),this.context.field.disabled&&e.push("exf-disabled"),e}_getBaseType(){let e=this.context.field.returnValueType?this.context.field.returnValueType.name:"String";return this.isTextInput?"text":"Boolean"===e?"bool":"Array"===e?"multi":"default"}async render(){for(var e in this.setProperties(),this.attributes)"required"!==e?this._htmlElement.setAttribute(e,this.attributes[e]):this._htmlElement.required=this.attributes[e];for(var e in this.dataProps)this._htmlElement.setAttribute("data-"+e,this.dataProps[e]);let t=this._scope();if(this.container=s.parseHTML(this._getContainerTemplate(t)),t.caption&&0!==t.caption.length||this.container.classList.add("exf-lbl-empty"),"true"===this.container.getAttribute("data-replace"))this.container=this.htmlElement;else{let e=this.container.querySelector('[data-replace="true"]');e?s.replace(e,this.htmlElement):this.container=this.htmlElement}return this.addEventListeners(),this.context.field.required&&this.container.classList.add("exf-required"),this.context.field.value&&(this.value=this.context.field.value,this.value&&this.container.classList.add("exf-filled")),this._addContainerClasses(),this._rendered=!0,this.container}addEventListeners(){const e=this,t=e.context.exo,i=e.context.field;e.htmlElement.addEventListener("invalid",(s=>(console.debug("check validity on ",s.target,"submitCheck",e.submitCheck),"true"===s.target.closest("[data-page]").getAttribute("data-skip")?(console.debug("invalid event on skipped control",s.target.name),s.preventDefault(),!1):t.addins.validation.testValidity(s,i)))),e.htmlElement.addEventListener("change",(e=>{let t=e.target.value!=e.target.defaultValue,i=e.target.closest(".exf-ctl-cnt");i&&i.classList[t?"add":"remove"]("exf-dirty")}))}_getContainerAttributes(){let e=this.context.field;return{...e,caption:e.caption||"",tooltip:e.tooltip||"",id:this.id+"-container"}}setProperties(){let e=this.context.field;for(var t in e){if(o.meta.properties.reserved.includes(t))continue;let i=t.toLowerCase(),s=e[i],n=t;this.acceptedProperties.find((e=>e.name===n))||(this.allowedAttributes.includes(n)?this.attributes[n]=this._processProp(i,s):"object"==typeof s?this[n]=s:this.dataProps[n]=this._processProp(i,s))}}_processProp(e,t){let i=this.context.exo.dataBinding;return i?i._processFieldProperty(this,e,t):t}get valid(){let e=0;const t=t=>{if(t.reportValidity)try{t.reportValidity()||e++}catch{}};let i=this.container||this.htmlElement;return t(i),i.querySelectorAll("*").forEach(t),0===e}get validationMessage(){let e="";return this.container.querySelectorAll("*").forEach((t=>{t.validationMessage&&(e=t.validationMessage)})),e}showValidationError(){return!this.htmlElement||!this.htmlElement.reportValidity||this.htmlElement.reportValidity()}showHelp(e,t){if(!e)return null!=this._error&&(this._error.parentNode.removeChild(this._error),this._error=null),void(this.container&&(this.container.removeAttribute("aria-invalid"),this.container.classList.remove("exf-invalid")));t=t||{type:"info"},null==this._error?(this._error=s.parseHTML(`<div class="exf-help exf-help-${t.type}">${e}</div>`),"invalid"===t.type&&(this.container.setAttribute("aria-invalid","true"),this.container.classList.add("exf-invalid")),this.container.querySelector(".exf-help-wrapper").appendChild(this._error)):this._error.innerHTML=e}}e(l,"returnValueType",void 0);class c extends l{constructor(e){if(super(e),e.field.tagName)try{if(this.htmlElement=s.parseHTML("<"+e.field.tagName+"/>"),this.htmlElement.nodeName!==e.field.tagName.toUpperCase())throw"'"+e.field.tagName+"' is not a valid tagName";this.isSelfClosing||this.acceptProperties({name:"html",type:String,description:"Inner HTML"}),this.html&&(this.htmlElement.innerHTML=this.html)}catch(t){throw"Could not generate '"+e.field.tagName+"' element: "+t.toString()}}}e(c,"returnValueType",void 0);class d extends c{constructor(e){super(e),this.htmlElement=document.createElement("input")}async render(){switch("email"===this.context.field.type&&this.createEmailLookup(),await super.render(),this.testDataList(),this.context.field.type){case"color":this.container.classList.add("exf-std-lbl");case"hidden":this.container.classList.add("exf-hidden")}return this.container}createEmailLookup(){const e=this;e.htmlElement.addEventListener("keyup",(t=>{if("Enter"!==t.key){console.log(t.key);let i=[];["@gmail.com","@outlook.com","@live.nl","@yahoo.com","@hotmail.com"].forEach((e=>{i.push(t.target.value.split("@")[0]+e)})),i.length>1?e.createDataList(e.context.field,i):e.destroyDataList()}else{let i=e.container.querySelector("datalist");i&&i.remove(),t.preventDefault()}}))}destroyDataList(){let e=this.container.querySelector("datalist");e&&e.remove()}testDataList(){const e=this;let t=e.context.field;if(t.lookup)if(Array.isArray(t.lookup))e.createDataList(t,t.lookup);else{let s=i=>{let s=t.lookup.replace(".json","_"+i+".json");s=new URL(s,e.context.baseUrl),fetch(s).then((e=>e.json())).then((i=>{e.createDataList(t,i)}))};i.isValidUrl(t.lookup)||(s=e.getFetchLookup(t)),this.htmlElement.addEventListener("keyup",(e=>{s(t._control.htmlElement.value)}))}}getFetchLookup(e){const t=this,i=t.context.exo,s={field:e,type:"lookup",data:e.lookup,callback:(e,i)=>{t.createDataList.call(t,e,i)}};return"OpenData"===s.data.type?e=>{e=e.substr(0,1).toUpperCase()+e.substr(1);let t=s.data.url+"?$top=20&$filter=substring("+s.data.field+",0,"+e.length+") eq '"+e+"'";fetch(t).then((e=>e.json())).then((e=>{e&&e.value&&s.callback(s.field,e.value.map((e=>e.Title)))}))}:i.options.get(s)}createDataList(e,t){let i=e.id;e._control.htmlElement.setAttribute("list","list-"+i);let n=e._control.container.querySelector("datalist");n&&n.remove();const r=s.parseHTML(s.format(o.meta.templates.datalist,{id:"list-"+i}));t.forEach((e=>{let t={value:e,label:e.name,...e};r.appendChild(s.parseHTML(s.format(o.meta.templates.datalistItem,t)))})),e._control.container.appendChild(r)}}e(d,"returnValueType",String);class h extends d{constructor(e){super(e),this.isTextInput=!0,this.htmlElement=s.parseHTML('<input type="text"/>')}async render(){var e=this.context.field;return this.attributes.placeholder||(this.attributes.placeholder=" "),await super.render(),e.mask&&s.maskInput(this.htmlElement,{mask:e.mask,format:e.format}),this.container}}class u extends c{constructor(t){super(t),e(this,"html",""),this.htmlElement=document.createElement("div"),this.acceptProperties({name:"html",type:String,description:"Inner HTML of the div"})}async render(){return this.html&&(this.htmlElement.innerHTML=this.html),await super.render()}}class p extends c{constructor(t){super(t),e(this,"isMultiSelect",!1),e(this,"view","block"),this.htmlElement=s.parseHTML("<select></select>"),this.acceptProperties({name:"view",type:String,description:"Set the view mode (list, tiles)"})}async populateList(e,t){const i=this,s=i.context.field;if(s.items&&Array.isArray(s.items)){let n=0;s.items.forEach((r=>{i.addListItem(s,r,t,e,n),n++}))}}addListItem(e,t,i,n,r){const a=this;var o=s.parseHTML("<span/>");n.appendChild(o);let l={...t,name:"string"==typeof t.name?t.name:t,value:void 0!==t.value?t.value:t,type:a.optionType,inputname:e.name,checked:t.checked||t.selected?"checked":"",selected:t.checked||t.selected?"selected":"",tooltip:(t.tooltip||t.name||"").replace("{{field}}",""),oid:e.id+"_"+r};var c={field:e,control:a,item:l};if(l.element)c.listElement=l.element,s.replace(o,l.element);else if(l.field)this.renderFieldSync(l,i,n);else if(l.html)c.listElement=s.parseHTML(l.html),s.replace(o,c.listElement);else{var d=s.format(i,l);c.listElement=s.parseHTML(d),s.replace(o,c.listElement)}a.context.exo.triggerEvent(ne.events.getListItem,c)}renderFieldSync(e,t,i){return(async(e,t)=>{-1===e.name.indexOf("{{field}}")&&(e.tooltip=e.tooltip||e.name,e.name=e.name+"{{field}}");const n=this.context.exo.context;let r=await n.createForm().renderSingleControl(e.field);e.name=s.format(e.name,{field:r.outerHTML}),i.appendChild(s.parseHTML(s.format(t,e)))})(e,t)}async render(){let e=await super.render();switch(this.view){case"tiles":e.classList.add("tiles");break;case"list":e.classList.add("list");break;default:e.classList.add("block")}return e}}class m extends p{constructor(e){super(e);this.htmlElement=s.parseHTML(s.format('<div data-evtarget="true" class="{{class}}" {{required}}>{{inner}}</div>',{class:[this.context.field.class||""].join(" ")}))}async render(){this.context.field;return await this.populateList(this.htmlElement,'<div class="exf-ilc-cnt" title="{{tooltip}}">\n            <input class="{{class}}" {{checked}} name="{{inputname}}" value="{{value}}" type="{{type}}" id="{{oid}}" />\n            <label for="{{oid}}" class="exf-caption">\n                <div class="exf-caption-main">{{name}}</div>\n                <div title="{{description}}" class="exf-caption-description">{{description}}</div>\n            </label>\n        </div>'),await super.render(),this.container.classList.add("exf-input-group","exf-std-lbl"),this.container}get valid(){if(this.context.field.required){if(0===this.container.querySelectorAll("input:checked").length){let e=this.container.querySelector("input");try{e.setCustomValidity(this.getValidationMessage()),e.reportValidity()}catch{}return!1}}return!0}get value(){return s.getValue(this.htmlElement.querySelector("[name]"))}set value(e){let t=this.htmlElement.querySelector("[name]");t&&(t.value=e)}getValidationMessage(){let e="You must select a value",t=s.parseHTML('<form><input name="test" required /></form');return t.querySelector("input").addEventListener("invalid",(t=>{e=t.validationMessage,t.preventDefault()})),t.submit(),e}showValidationError(){this.htmlElement.querySelector("input").setCustomValidity("This cannot be empty")}get validationMessage(){return this.htmlElement.querySelector("input").validationMessage}}class g extends m{constructor(...t){super(...t),e(this,"optionType","checkbox")}get value(){let e=[];return this.container.querySelectorAll(":checked").forEach((t=>{e.push(t.value)})),e}set value(e){this.container.querySelectorAll("[name]").forEach((e=>{}))}}e(g,"returnValueType",Array);class f extends g{constructor(t){super(t),e(this,"text",""),this.acceptProperties({name:"text",description:"Text to display on checkbox label"}),t.field.items=[{name:this.text||t.field.caption,value:!0,checked:t.field.value,tooltip:t.field.tooltip||""}]}async render(){return this.text?this.context.field.class=((this.context.field.class||"")+" exf-std-lbl").trim():this.context.field.caption="",await super.render(),this.container}get value(){return!!this.container.querySelector(":checked")}set value(e){this.container.querySelector("[name]").checked=e}}e(f,"returnValueType",Boolean);class v extends d{constructor(t){super(t),e(this,"buttons",!1),this.context.field.type="number",this.acceptProperties({name:"buttons",description:"Add plus and minus buttons",type:Boolean})}async render(){return await super.render(),this.buttons&&(this.minusButton=document.createElement("button"),this.minusButton.innerText="-",this.minusButton.classList.add("nmbr-m"),this.plusButton=document.createElement("button"),this.plusButton.innerText="+",this.plusButton.classList.add("nmbr-p"),this.htmlElement.parentNode.insertBefore(this.minusButton,this.htmlElement),this.htmlElement.parentNode.insertBefore(this.plusButton,this.htmlElement.nextSibling),this.container.classList.add("exf-nmbr-btns"),this.container.classList.add("exf-std-lbl"),this.container.addEventListener("click",(e=>{e.cancelBubble=!0,e.preventDefault();let t=parseInt("0"+this.htmlElement.step)||1;e.target===this.plusButton?(""===this.htmlElement.max||parseInt(this.htmlElement.value)<parseInt(this.htmlElement.max))&&(this.htmlElement.value=parseInt("0"+(this.htmlElement.value||(""!=this.htmlElement.min?this.htmlElement.min-1:-1)))+t):e.target===this.minusButton&&(""===this.htmlElement.min||parseInt(this.htmlElement.value)>parseInt(this.htmlElement.min))&&(this.htmlElement.value=parseInt("0"+(this.htmlElement.value||(""!=this.htmlElement.max?this.htmlElement.max-1:1)))-t),this.triggerChange()}))),this.container}}e(v,"returnValueType",Number);class y extends v{constructor(t){super(t),e(this,"showoutput",!1),this.context.field.type="range",this.acceptProperties({name:"showoutput",type:Boolean})}async render(){return await super.render(),this.showoutput&&(this.output=document.createElement("output"),this.htmlElement.parentNode.insertBefore(this.output,this.htmlElement.nextSibling),this.htmlElement.addEventListener("input",this._sync),this._sync(),this.container.classList.add("exf-rng-output")),this.container.classList.add("exf-std-lbl"),this.container}_sync(){this.output&&this.htmlElement&&(this.output.value=this.htmlElement.value)}set value(e){super.value=e,this.showoutput&&this._sync()}}e(y,"returnValueType",Number);class x extends u{constructor(e){super(e),this._relevant=!0,this._previouslyRelevant=!0,this.acceptProperties({name:"relevant",description:"Specifies whether the page is currently relevant/in scope",type:Boolean})}async render(){return await super.render(),this._setRelevantState(),this.container}set relevant(e){e!==this._previouslyRelevant&&(this._relevant=e,this.container&&this._setRelevantState(),this._previouslyRelevant=this._relevant)}get relevant(){return this._relevant}_setRelevantState(){this.relevant?this.container.removeAttribute("data-skip"):(console.debug("ExoFormBaseControls: page",this.index,"not relevant"),this.container.setAttribute("data-skip","true")),this.context.exo.triggerEvent(ne.events.pageRelevancyChange,{index:this.index,relevant:this.relevant})}finalize(){}}class b{}e(b,"controls",{base:{hidden:!0,type:l},element:{type:c,note:"Any raw HTML Element",demo:{type:"element",tagName:"img",src:"https://source.unsplash.com/random/600x400"}},input:{hidden:!0,type:d},div:{hidden:!0,type:u,note:"A standard HTML div container element",demo:{html:"<h3>Wow!</h3>"}},form:{hidden:!0,type:class extends c{constructor(e){super(e),this.htmlElement=s.parseHTML("<form />")}}},formpage:{hidden:!0,type:x},fieldset:{hidden:!0,for:"page",type:class extends x{constructor(e){super(e),this._index=e.field.index,this.acceptProperties({name:"legend",description:"The legend of the page",type:String},{name:"intro",description:"The intro of the page",type:String},{name:"index",description:"Number of the page (1-based)",type:Number}),this.htmlElement=s.parseHTML('<fieldset class="exf-cnt exf-page"></fieldset>'),this.legend&&this.appendChild(s.parseHTML(s.format(o.meta.templates.legend,{legend:this.legend}))),this.intro&&this.appendChild(s.parseHTML(s.format(o.meta.templates.pageIntro,{intro:this.intro})))}get index(){return this._index}set index(e){if("number"!=typeof e)throw"Page index must be a number";if(e<1||e>this.context.exo.schema.pages.length)throw"Invalid page index";this._index=e}async render(){return await super.render(),this.index===this.context.exo.addins.navigation.currentPage&&this.htmlElement.classList.add("active"),this.htmlElement.setAttribute("data-page",this.index),this.container}},note:"A fieldset for grouping controls in a form"},text:{caption:"Short text",type:h,note:"Standard text input"},url:{caption:"Website Address/URL",base:"text",note:"A text input that will accept URLs only"},tel:{caption:"Phone number",base:"input",note:"A text input that is used to input phone numbers",demo:{value:"06 23467899"}},number:{caption:"Numeric Control",type:v,note:"A text input that is used to input phone numbers",demo:{min:1,max:99}},range:{caption:"Range Slider",type:y,note:"A range slider input",demo:{min:1,max:10,value:5}},color:{caption:"Color Input",base:"input",note:"A control to select a color",demo:{value:"#cc4433"}},checkbox:{type:f,note:"A checkbox",demo:{checked:!0}},email:{caption:"Email Address",base:"text",note:"A text input that validates email addresses",demo:{required:!0}},date:{base:"input",note:"A date input that is used to input phone numbers"},month:{base:"input",note:"A month selector input"},"datetime-local":{caption:"Local Date &amp; Time selector",base:"input",note:"A date input that is used to input local date/time"},search:{base:"text",note:"A search text input with a clear button"},password:{base:"text",note:"A text input for password masking"},file:{caption:"File upload",base:"text",note:"A standard file upload control"},multiline:{caption:"Long text",type:class extends h{constructor(t){super(t),e(this,"autogrow",!1),this.acceptProperties({name:"autogrow",type:Boolean,description:"Use to automatically expand the typing area as you add lines"}),this.htmlElement=s.parseHTML("<textarea/>")}setProperties(){super.setProperties(),this.attributes.value&&(this.htmlElement.innerHTML=this.attributes.value,delete this.attributes.value)}async render(){return await super.render(),this.autogrow&&(this.htmlElement.setAttribute("onInput","this.parentNode.dataset.replicatedValue = this.value"),this.htmlElement.parentNode.classList.add("autogrow")),this.container}},alias:"textarea",note:"A multi-line text input"},list:{hidden:!0,type:p},dropdown:{type:class extends p{constructor(e){super(e),this.htmlElement=s.parseHTML('<select size="1"></select>')}async render(){this.context.field;return await this.populateList(this.htmlElement,'<option class="{{class}}" {{selected}} value="{{value}}">{{name}}</option>'),await super.render(),this.container.classList.add("exf-input-group","exf-std-lbl"),this.container}},alias:"select",note:"A dropdown list control",demo:{items:["First","Second"]}},checkboxlist:{caption:"Multiselect List (checkbox)",type:g,note:"A group of checkboxes to select multiple items",demo:{items:["First","Second"]}},radiobuttonlist:{caption:"Single select List (radio)",type:class extends m{constructor(t){super(t),e(this,"optionType","radio")}set value(e){this.htmlElement.querySelectorAll("[name]").forEach((t=>{t.value==e&&(t.checked=!0)}))}get value(){let e=this.htmlElement.querySelector("[name]:checked");return e?e.value:""}},note:"A group of radio buttons to select a single value from",demo:{items:["First","Second"]}},hidden:{base:"input",note:"A hidden input that is used to store variables"},custom:{hidden:!0,base:"div",note:"A custom control that is used to render your own ExoFormControl classes"},button:{type:class extends c{constructor(e){super(e),this.iconHtml="",this.htmlElement=s.parseHTML('<button class="exf-btn" />'),this.acceptProperties({name:"icon",description:"Icon class to be used (using a span)"},{name:"click",description:"Click method"},{name:"action",description:"Possible values: \n                    - 'next' (next page in Wizard)\n                    - 'reset' (back to first page)\n                    - 'goto:[page]' (jump to given page)\n                "})}async render(){const e=this;return await super.render(),e.icon&&(e.htmlElement.appendChild(s.parseHTML('<span class="'+e.icon+'"></span>')),this.htmlElement.appendChild(document.createTextNode(" "))),e.htmlElement.appendChild(s.parseHTML(`<span class="exf-caption">${this.context.field.caption}</span>`)),await super.render(),e.htmlElement.addEventListener("click",(t=>{if(e.click){let i=e.context.exo.getFormValues(),s=e.click;if("function"!=typeof s&&(s=e.context.exo.options.customMethods[s]),"function"!=typeof s){if(!e.context.exo.options.host)throw"Not a valid function: "+e.click;if("function"==typeof e.context.exo.options.host[e.click])return s=e.context.exo.options.host[e.click],void s.apply(e.context.exo.options.host,[i,t])}s.apply(e,[i,t])}else if(e.action){let t=e.action.split(":");switch(t[0]){case"next":e.context.exo.addins.navigation.nextPage();break;case"reset":e.context.exo.addins.navigation.goto(1);break;case"goto":e.context.exo.addins.navigation.goto(parseInt(t[1]))}}})),this.container.classList.add("exf-btn-cnt"),this.htmlElement.classList.add("exf-btn"),this.container}set icon(e){this._icon=e}get icon(){return this._icon}},note:"A button control",demo:{caption:"Click me"}},time:{caption:"Time selector",base:"text",note:"A time input control"},progressbar:{type:class extends c{constructor(e){super(e),this.htmlElement=s.parseHTML("<progress />")}},alias:"progress",note:"A progress indicator control"},link:{type:class extends c{constructor(e){super(e),this.htmlElement=document.createElement("a"),this.acceptProperties({name:"external",type:Boolean,description:"External to open in new tab"},{name:"html",type:String})}async render(){return this.external&&this.htmlElement.setAttribute("target","_blank"),super.render()}},note:"HTML Anchor element"}});class E extends b.controls.input.type{constructor(t){super(t),e(this,"height",120),this.acceptProperties({name:"maxSize"},{name:"max",type:Number,description:"Max number of files accepted"},{name:"fileTypes",type:String|Array,description:'Array of strings - example: ["image/"]'},{name:"maxSize",type:Number,description:"Maximum filesize of files to be uploaded (in bytes) - example: 4096000"},{name:"height",type:Number,description:"Height of drop area"})}async render(){const e=this;return e.field=e.context.field,e.field.type="file",e.field.data=this.field.data||[],await super.render(),e.previewDiv=s.parseHTML('<div class="file-preview clearable"></div>'),e.previewDiv.style.height=`${this.height}px`,e.container.querySelector(".exf-ctl").appendChild(e.previewDiv),e.container.classList.add("exf-filedrop"),e.bindEvents((t=>{if(t.error)e.showHelp(t.error,{type:"error"});else{var i=s.parseHTML('<div data-id="'+t.fileName+'" class="thumb '+t.type.replace("/"," ")+'"></div>');let n=s.parseHTML('<button title="Remove" type="button" class="close">x</button>');n.addEventListener("click",(t=>{let i=t.target.closest(".thumb"),s=i.getAttribute("data-id");Array.from(e.previewDiv.children).indexOf(i),i.remove(),e.field.data=e.field.data.filter((e=>e.fileName!==s)),e._change()})),i.appendChild(n),i.setAttribute("title",t.fileName);let r=s.parseHTML('<div class="thumb-data"></div>');t.type.startsWith("image/")?(i.classList.add("image"),r.style.backgroundImage='url("'+e.getDataUrl(t.b64,t.type)+'")'):i.classList.add("no-img"),i.appendChild(r),i.appendChild(s.parseHTML("<figcaption>"+t.fileName+"</figcaption>")),e.previewDiv.appendChild(i)}})),e.container}get value(){return this.context.field.data.sort()}set value(e){}_change(){s.trigger(this.htmlElement,"change",{data:this.context.field.data})}bindEvents(e){const t=this,i=i=>{var s=i.file;t.showHelp();var n=new FileReader;n.onload=function(){let s={error:"",fileName:i.file.name,type:i.file.type,size:i.file.size,date:i.file.lastModifiedDate};if(t.field.max&&t.field.data.length>=t.field.max&&(s.error="Maximum number of attachements reached"),t.field.fileTypes){let e=!1;t.field.fileTypes.forEach((t=>{0===i.file.type.indexOf(t)&&(e=!0)})),e||(s.error="Invalid file type")}!s.error&&t.field.maxSize&&i.file.size>t.field.maxSize&&(s.error="Max size exceeded"),s.error||(s.b64=btoa(n.result)),s.error||(t.field.data.push(s),t._change()),e(s)};try{n.readAsBinaryString(s)}catch{}},s=t.htmlElement.closest(".exf-ctl-cnt");t.htmlElement.addEventListener("change",(e=>{if(!e.detail){for(var t in e.stopImmediatePropagation(),e.cancelBubble=!0,e.preventDefault(),e.stopPropagation(),e.returnValue=!1,s.classList.remove("drag-over"),e.target.files)i({file:e.target.files[t]});return!1}})),s.addEventListener("dragover",(e=>{e.dataTransfer.dropEffect="copy",s.classList.add("drag-over")})),s.addEventListener("drop",(e=>{e.dataTransfer.dropEffect="none",s.classList.remove("drag-over")})),s.addEventListener("dragleave",(e=>{e.dataTransfer.dropEffect="none",s.classList.remove("drag-over")}))}getDataUrl(e,t){return"data:"+t+";base64,"+e}get valid(){return this.htmlElement,checkValidity()}}class L extends b.controls.div.type{constructor(e){super(e),this.htmlElement.data={}}get value(){return this.htmlElement.data.editor.getData()}set value(e){this.htmlElement.data.editor.setData(e)}async render(){const e=this;return await super.render(),e.htmlElement,new Promise(((t,i)=>{s.require("https://cdn.ckeditor.com/ckeditor5/17.0.0/classic/ckeditor.js",(()=>{ClassicEditor.create(e.htmlElement).catch((e=>{console.error(e)})).then((t=>{e.htmlElement.data.editor=t})),t(e.container)}))}))}}class w extends b.controls.range.type{setProperties(){this.context.field.min=0,this.context.field.max=1,this.context.field.value=this.context.field.value||0,super.setProperties(),this.context.field.type="switch"}async render(){const e=this;let t=await super.render();this.container.classList.add("exf-switch"),this.container.classList.add("exf-std-lbl");const i=t=>{let i=t.target.closest(".exf-switch"),s=i.querySelector("[type='range']");i.classList["1"===s.value?"add":"remove"]("on"),e.triggerChange()};return i({target:t}),t.addEventListener("click",(e=>{e.stopImmediatePropagation(),e.cancelBubble=!0,e.preventDefault(),e.stopPropagation(),e.returnValue=!1;let t=e.target.closest(".exf-switch").querySelector("[type='range']");"INPUT"!=e.target.tagName&&(t.value="0"==t.value?1:0,i({target:t})),i({target:t})})),this.container}}e(w,"returnValueType",Boolean);class _ extends b.controls.text.type{constructor(t){super(t),e(this,"max",null),e(this,"duplicate",!1),e(this,"wrapperClass","exf-tags-input"),e(this,"tagClass","tag"),e(this,"arr",[]),this.acceptProperties({name:"max",type:Number,description:"Maximum number of tags allowed"},{name:"duplicate",type:Boolean,description:"Allow duplicates. Default false"},{name:"tags",description:"Tag names to set (array)"})}async render(){const e=this;return await super.render(),e.wrapper=document.createElement("div"),e.input=document.createElement("input"),e.htmlElement.setAttribute("type","hidden"),e.htmlElement.addEventListener("change",(e=>{e.detail||(e.stopImmediatePropagation(),e.cancelBubble=!0,e.preventDefault(),e.stopPropagation(),e.returnValue=!1)})),e.wrapper.append(e.input),e.wrapper.classList.add(e.wrapperClass),e.htmlElement.parentNode.insertBefore(e.wrapper,e.htmlElement),e.wrapper.addEventListener("click",(function(){e.input.focus()})),e.input.addEventListener("keydown",(t=>{var i=e.input.value.trim();if(~[9,13,188].indexOf(t.keyCode))t.preventDefault(),t.stopPropagation(),t.returnValue=!1,e.input.value="",""!==i&&e.addTag(i);else if("Backspace"===t.key&&""===e.input.value){let t=e.wrapper.querySelectorAll(".tag");if(t.length){let i=t.length-1;e.deleteTag(t[i],i)}}})),e.tags&&e.tags.forEach((t=>{e.addTag(t)})),e.container.classList.add("exf-std-lbl"),e.container}get value(){return this.arr}addTag(e){const t=this;if(!t.anyErrors(e)){t.arr.push(e);var i=document.createElement("span");i.className=this.tagClass,i.textContent=e;var s=document.createElement("a");return s.innerHTML="&times;",s.addEventListener("click",(e=>{e.preventDefault();for(var i=e.target.parentNode,s=0;s<t.wrapper.childNodes.length;s++)t.wrapper.childNodes[s]==i&&t.deleteTag(i,s)})),i.appendChild(s),t.wrapper.insertBefore(i,t.input),t.triggerChange(),t}}deleteTag(e,t){return e.remove(),this.arr.splice(t,1),this.triggerChange(),this}triggerChange(){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!0),e.detail={field:"tags"},this.input.dispatchEvent(e)}anyErrors(e){return null!=this.max&&this.arr.length>=this.max||!this.duplicate&&-1!=this.arr.indexOf(e)}addData(e){var t=this;return e.forEach((function(e){t.addTag(e)})),this}}class C extends b.controls.div.type{constructor(e){super(e),s.require("https://www.google.com/recaptcha/api.js"),this.acceptProperties({name:"sitekey",type:String,description:"Key for Google reCaptcha",more:"https://developers.google.com/recaptcha/intro"},{name:"invisible",type:Boolean,description:"Use invisible Captcha method",more:"https://developers.google.com/recaptcha/docs/invisible"})}async render(){return this.htmlElement.classList.add("g-recaptcha"),this.htmlElement.setAttribute("data-sitekey",this.sitekey),this.invisible&&this.htmlElement.setAttribute("data-size","invisible"),this.htmlElement}set sitekey(e){this._sitekey=e}get sitekey(){return this._sitekey}get invisible(){return!0===this._invisible}set invisible(e){this._invisible=1==e}}class S extends b.controls.list.type{constructor(t){super(t),e(this,"navTemplate",'\n        <nav class="ul-drop" role=\'navigation\'>\n            <ul>\n                <li>\n                    <a class="user-icon" href="#"><span class="ti-user"></span></a>\n                    <ul></ul>\n                </li>\n            </ul>\n        </nav>'),this.context.field.type="hidden",this.htmlElement=s.parseHTML(this.navTemplate)}async render(){this.context.field;return await this.populateList(this.htmlElement.querySelector("ul > li > ul"),'<li title="{{tooltip}}"><a class="{{class}}" href="{{value}}">{{name}}</a></li>'),await super.render()}setupButton(){document.querySelector("body").classList.add("signed-out"),container.appendChild(s.parseHTML(s.format(tpl,data,{empty:void 0})))}}class T extends b.controls.element.type{constructor(t){super(t),e(this,"_width","600px"),e(this,"_height","400px"),this.htmlElement=document.createElement("iframe"),this.acceptProperties({name:"url",description:"Url of the page to embed"},{name:"width"},{name:"height"})}async render(){this.htmlElement.setAttribute("src",this.url),this.htmlElement.setAttribute("frameborder","0"),this.htmlElement.setAttribute("allowfullscreen","true"),this.htmlElement.setAttribute("allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),await super.render();let e=document.createElement("div");return e.classList.add("exf-embed-container"),e.appendChild(this.htmlElement),this.container.querySelector(".exf-ctl").appendChild(e),this.container.classList.add("exf-base-embed"),this.container}get width(){return this._width}set width(e){this._width=e,this.htmlElement.style.width=e}get height(){return this._height}set height(e){this._height=e,this.htmlElement.style.height=e}}class k extends T{constructor(t){super(t),e(this,"mute",!1),e(this,"autoplay",!0),e(this,"player","youtube"),e(this,"code","abcdefghij"),this.acceptProperties({name:"code",description:"Code of the video to embed"},{name:"width"},{name:"height"},{name:"autoplay",type:Boolean,description:"Boolean indicating whether the video should immediately start playing"},{name:"mute",type:Boolean,description:"Boolean indicating whether the video should be muted"},{name:"player",type:String,description:"Player type. Currently implemented: youtube, vimeo"})}async render(){const e=k.players[this.player];return this.url=s.format(e.url,this),await super.render(),this.container}}e(k,"players",{youtube:{url:"https://www.youtube.com/embed/{{code}}?autoplay={{autoplay}}&mute={{mute}}"},vimeo:{url:"https://player.vimeo.com/video/{{code}}?title=0&byline=0&portrait=0&background={{mute}}"}});class A extends b.controls.div.type{constructor(t){super(t),e(this,"columns",""),e(this,"areas",""),e(this,"gap","1rem"),this.acceptProperties({name:"grid-template",description:"CSS3 grid template",more:"https://developer.mozilla.org/en-US/docs/Web/CSS/grid-template"},{name:"areas",description:"Grid template areas to set up on the containing div",example:'"field1 field1 field2"\n                "field3 field4 field4"'},{name:"columns",description:"Grid columns to set up on containing div",example:"10em 10em 1fr"},{name:"gap",description:"Grid gap to set up on containing div",example:"16px"},{name:"fields",type:Object,description:"Fields structure",example:{first:{caption:"First",type:"text",maxlength:30},last:{caption:"Last",type:"text",maxlength:50}}})}async render(){await super.render();const e=this,t=e.context.field;e.context.exo,this.htmlElement.classList.add("exf-cnt","exf-ctl-group"),(this.areas&&this.columns||this["grid-template"]||this.grid)&&this.htmlElement.classList.add("grid"),this.areas&&this.columns?this.htmlElement.setAttribute("style",`display: grid; grid-template-areas: ${this.areas}; grid-template-columns: ${this.columns}; grid-gap: ${this.gap}`):this["grid-template"]?this.htmlElement.setAttribute("style",`display: grid; grid-template: ${this["grid-template"]}`):this.grid&&this.htmlElement.classList.add(this.grid);e.inputs={};const i=async(i,s)=>{for(var n in s={...s,name:t.name+"_"+i}){"inherit"===s[n]&&(s[n]=t[n])}return e.inputs[i]=await(async(t,i)=>e.context.exo.renderSingleControl(i))(0,s),e.inputs[i].setAttribute("data-multi-name",s.name),e.htmlElement.appendChild(e.inputs[i]),e.inputs[i]};for(var s in!this.fields&&t.fields&&(this.fields=t.fields),this.fields){var n=await i(s,this.fields[s]);this.areas&&n.setAttribute("style",`grid-area: ${s}`)}return this.htmlElement.setAttribute("exf-data-master","multiinput"),this.container}_qs(e){const t=this.context.field;return this.htmlElement?this.htmlElement.querySelector('[data-multi-name="'+t.name+"_"+e+'"]'):""}get value(){let e=this.context.field.value||{};for(var t in this.fields){var i=this._qs(t);if(i){let s=ne.getFieldFromElement(i);e[t]=s._control.value}}return e}set value(e){for(var t in e=e||{},this.context.field.value=e,this.fields){e[t]=e[t]||"",this.fields[t].value=e[t];var i=this._qs(t);if(i){ne.getFieldFromElement(i)._control.value=e[t]}}}get valid(){let e=!0;for(var t in this.fields){var i=this._qs(t);ne.getFieldFromElement(i)._control.valid||(e=!1)}return e}showValidationError(){for(var e in this.fields){var t=this.getFormElement(this._qs(e));if(console.log("Checking ",t),!t.checkValidity())return console.log("Not valid: ",t),t.reportValidity&&t.reportValidity(),!1}return!0}getFormElement(e){return e.name&&e.form?e:e.querySelector("[name]")||e}}e(A,"returnValueType",Object);class P extends A{constructor(...t){super(...t),e(this,"columns","4em 4em 10em 1fr"),e(this,"areas",'\n        "code code nr fill"\n        "ext ext city city"\n        "street street street street"'),e(this,"fields",{code:{caption:"Postcode",type:"text",size:7,maxlength:7,required:"inherit",pattern:"[1-9][0-9]{3}s?[a-zA-Z]{2}",placeholder:"1234AB"},nr:{caption:"Huisnummer",type:"number",size:6,maxlength:6,required:"inherit",placeholder:"67"},ext:{caption:"Toevoeging",type:"text",size:3,maxlength:3,placeholder:"F"},city:{caption:"Plaats",type:"text",maxlength:50,readonly:!0,placeholder:"Den Helder"},street:{caption:"Straatnaam",type:"text",maxlength:50,readonly:!0,placeholder:"Dorpstraat"}})}async render(){const e=this;let t=await super.render();const i=()=>{var t=this.value;t.code&&t.nr&&fetch(s.format(P.APIUrl,{nr:t.nr,code:t.code}),{referer:"https://stasfpwawesteu.z6.web.core.windows.net/",method:"GET"}).then((e=>e.json())).then((t=>{var i=t.response;if(i.numFound>0){let t=i.docs[0];e._qs("street").querySelector("[name]").value=t.straatnaam_verkort,e._qs("street").classList.add("exf-filled"),e._qs("city").querySelector("[name]").value=t.woonplaatsnaam,e._qs("city").classList.add("exf-filled")}}))};return e.inputs.nr.addEventListener("change",i),e.inputs.code.addEventListener("change",i),e.inputs.ext.addEventListener("change",i),t}}e(P,"APIUrl","https://geodata.nationaalgeoregister.nl/locatieserver/v3/free?q=postcode:{{code}}&huisnummer:{{nr}}");class M extends b.controls.div.type{constructor(t){super(t),e(this,"title","Dialog"),e(this,"_visible",!1),e(this,"confirmText","OK"),e(this,"cancelText","Cancel"),e(this,"cancelVisible",!1),e(this,"body","The dialog body"),e(this,"modal",!1),e(this,"dlgTemplate",'<div class="exf-dlg" role="dialog" id="{{dlgId}}">\n<div class="exf-dlg-c">\n    <div class="exf-dlg-h">\n        <div class="exf-dlg-t">{{title}}<button type="button" class="dlg-bc dlg-x dismiss" ><span>&times;</span></button></div>\n    </div>\n<div class="exf-dlg-b">{{body}}</div>\n<div class="exf-dlg-f">\n    <button type="button" class="dlg-x btn exf-btn btn-default dismiss" >{{cancelText}}</button>\n    <button type="button" class="dlg-x btn exf-btn btn-primary confirm" >{{confirmText}}</button>\n</div>\n</div>\n</div>'),this.acceptProperties("title","cancelText","body","confirmText","cancelVisible","modal"),this.dlgId="dlg_"+i.guid().replace("-","")}hide(e,t){this.context.field.click&&this.context.field.click.apply(this,[e,t])}set visible(e){this._visible=e,this.rendered&&(e?this.show():this.hide())}show(){const e=this;let t=s.format(e.dlgTemplate,{...this}),i=s.parseHTML(t);i.classList.add(this.cancelVisible?"dlg-cv":"dlg-ch");const n=(t,i)=>{var s="cancel",n=t.target;(i||n.classList.contains("confirm"))&&(s="confirm"),e.hide.apply(e,[s,t]),t.cancelBubble||e.remove()};i.querySelector(".dlg-x").addEventListener("click",n),document.body.appendChild(i),i.addEventListener("click",n),document.body.addEventListener("keydown",(e=>{27===e.keyCode&&n(e),13===e.keyCode&&n(e,!0)}),{once:!0}),this.modal||setTimeout((()=>{document.body.addEventListener("click",n,{once:!0})}),10)}remove(){let e=document.querySelector("#"+this.dlgId);e&&e.remove()}}class q extends b.controls.div.type{constructor(t){super(t),e(this,"template",'<section class="exf-info {{class}}">\n    <div class="exf-info-title"><span class="exf-info-icon {{icon}}"></span><span class="exf-info-title-text">{{title}}</span></div>\n    <div class="exf-info-body">{{body}}</div>\n    </section>'),e(this,"title",""),e(this,"body",""),e(this,"icon","ti-info"),this.acceptProperties("title","icon","body","class")}async render(){const e=this;return s.format(e.template,{...this}),e.htmlElement.appendChild(s.parseHTML(s.format(e.template,this))),e.htmlElement}}class F extends b.controls.range.type{constructor(...t){super(...t),e(this,"svg",'<svg>\n    <defs>\n      <path id="star" d="M48.856,22.73c0.983-0.958,1.33-2.364,0.906-3.671c-0.425-1.307-1.532-2.24-2.892-2.438l-12.092-1.757c-0.515-0.075-0.96-0.398-1.19-0.865L28.182,3.043c-0.607-1.231-1.839-1.996-3.212-1.996c-1.372,0-2.604,0.765-3.211,1.996L16.352,14c-0.23,0.467-0.676,0.79-1.191,0.865L3.069,16.622c-1.359,0.197-2.467,1.131-2.892,2.438c-0.424,1.307-0.077,2.713,0.906,3.671l8.749,8.528c0.373,0.364,0.544,0.888,0.456,1.4L8.224,44.701c-0.183,1.06,0.095,2.091,0.781,2.904c1.066,1.267,2.927,1.653,4.415,0.871l10.814-5.686c0.452-0.237,1.021-0.235,1.472,0l10.815,5.686c0.526,0.277,1.087,0.417,1.666,0.417c1.057,0,2.059-0.47,2.748-1.288c0.687-0.813,0.964-1.846,0.781-2.904l-2.065-12.042c-0.088-0.513,0.083-1.036,0.456-1.4L48.856,22.73z"></path>\n      <clipPath id="stars">\n        <use xlink:href="#star" x="0"></use>\n        <use xlink:href="#star" x="50"></use>\n        <use xlink:href="#star" x="100"></use>\n        <use xlink:href="#star" x="150"></use>\n        <use xlink:href="#star" x="200"></use>\n      </clipPath>\n    </defs>\n  </svg>\n  \x3c!-- for safari--\x3e\n  <svg>\n    <clipPath id="allStars">\n      <path d="M24.97,0.047 C26.343,0.047 27.575,0.812 28.182,2.043 L28.182,2.043 L33.588,12.999 C33.818,13.466 34.263,13.789 34.778,13.864 L34.778,13.864 L46.87,15.621 C48.23,15.819 49.337,16.752 49.762,18.059 C50.186,19.366 49.839,20.772 48.856,21.73 L48.856,21.73 L40.107,30.259 C39.734,30.623 39.563,31.146 39.651,31.659 L39.651,31.659 L41.716,43.701 C41.899,44.759 41.622,45.792 40.935,46.605 C40.246,47.423 39.244,47.893 38.187,47.893 C37.608,47.893 37.047,47.753 36.521,47.476 L36.521,47.476 L25.706,41.79 C25.255,41.555 24.686,41.553 24.234,41.79 L24.234,41.79 L13.42,47.476 C11.932,48.258 10.071,47.872 9.005,46.605 C8.319,45.792 8.041,44.761 8.224,43.701 L8.224,43.701 L10.288,31.659 C10.376,31.147 10.205,30.623 9.832,30.259 L9.832,30.259 L1.083,21.731 C0.1,20.773 -0.247,19.367 0.177,18.06 C0.602,16.753 1.71,15.819 3.069,15.622 L3.069,15.622 L15.161,13.865 C15.676,13.79 16.122,13.467 16.352,13 L16.352,13 L21.759,2.043 C22.366,0.812 23.598,0.047 24.97,0.047 Z M124.97,0.047 C126.343,0.047 127.575,0.812 128.182,2.043 L128.182,2.043 L133.588,12.999 C133.818,13.466 134.263,13.789 134.778,13.864 L134.778,13.864 L146.87,15.621 C148.23,15.819 149.337,16.752 149.762,18.059 C150.186,19.366 149.839,20.772 148.856,21.73 L148.856,21.73 L140.107,30.259 C139.734,30.623 139.563,31.146 139.651,31.659 L139.651,31.659 L141.716,43.701 C141.899,44.759 141.622,45.792 140.935,46.605 C140.246,47.423 139.244,47.893 138.187,47.893 C137.608,47.893 137.047,47.753 136.521,47.476 L136.521,47.476 L125.706,41.79 C125.255,41.555 124.686,41.553 124.234,41.79 L124.234,41.79 L113.42,47.476 C111.932,48.258 110.071,47.872 109.005,46.605 C108.319,45.792 108.041,44.761 108.224,43.701 L108.224,43.701 L110.288,31.659 C110.376,31.147 110.205,30.623 109.832,30.259 L109.832,30.259 L101.083,21.731 C100.1,20.773 99.753,19.367 100.177,18.06 C100.602,16.753 101.71,15.819 103.069,15.622 L103.069,15.622 L115.161,13.865 C115.676,13.79 116.122,13.467 116.352,13 L116.352,13 L121.759,2.043 C122.366,0.812 123.598,0.047 124.97,0.047 Z M174.97,0.047 C176.343,0.047 177.575,0.812 178.182,2.043 L178.182,2.043 L183.588,12.999 C183.818,13.466 184.263,13.789 184.778,13.864 L184.778,13.864 L196.87,15.621 C198.23,15.819 199.337,16.752 199.762,18.059 C200.186,19.366 199.839,20.772 198.856,21.73 L198.856,21.73 L190.107,30.259 C189.734,30.623 189.563,31.146 189.651,31.659 L189.651,31.659 L191.716,43.701 C191.899,44.759 191.622,45.792 190.935,46.605 C190.246,47.423 189.244,47.893 188.187,47.893 C187.608,47.893 187.047,47.753 186.521,47.476 L186.521,47.476 L175.706,41.79 C175.255,41.555 174.686,41.553 174.234,41.79 L174.234,41.79 L163.42,47.476 C161.932,48.258 160.071,47.872 159.005,46.605 C158.319,45.792 158.041,44.761 158.224,43.701 L158.224,43.701 L160.288,31.659 C160.376,31.147 160.205,30.623 159.832,30.259 L159.832,30.259 L151.083,21.731 C150.1,20.773 149.753,19.367 150.177,18.06 C150.602,16.753 151.71,15.819 153.069,15.622 L153.069,15.622 L165.161,13.865 C165.676,13.79 166.122,13.467 166.352,13 L166.352,13 L171.759,2.043 C172.366,0.812 173.598,0.047 174.97,0.047 Z M224.97,0.047 C226.343,0.047 227.575,0.812 228.182,2.043 L228.182,2.043 L233.588,12.999 C233.818,13.466 234.263,13.789 234.778,13.864 L234.778,13.864 L246.87,15.621 C248.23,15.819 249.337,16.752 249.762,18.059 C250.186,19.366 249.839,20.772 248.856,21.73 L248.856,21.73 L240.107,30.259 C239.734,30.623 239.563,31.146 239.651,31.659 L239.651,31.659 L241.716,43.701 C241.899,44.759 241.622,45.792 240.935,46.605 C240.246,47.423 239.244,47.893 238.187,47.893 C237.608,47.893 237.047,47.753 236.521,47.476 L236.521,47.476 L225.706,41.79 C225.255,41.555 224.686,41.553 224.234,41.79 L224.234,41.79 L213.42,47.476 C211.932,48.258 210.071,47.872 209.005,46.605 C208.319,45.792 208.041,44.761 208.224,43.701 L208.224,43.701 L210.288,31.659 C210.376,31.147 210.205,30.623 209.832,30.259 L209.832,30.259 L201.083,21.731 C200.1,20.773 199.753,19.367 200.177,18.06 C200.602,16.753 201.71,15.819 203.069,15.622 L203.069,15.622 L215.161,13.865 C215.676,13.79 216.122,13.467 216.352,13 L216.352,13 L221.759,2.043 C222.366,0.812 223.598,0.047 224.97,0.047 Z M74.97,0.047 C76.343,0.047 77.575,0.812 78.182,2.043 L78.182,2.043 L83.588,12.999 C83.818,13.466 84.263,13.789 84.778,13.864 L84.778,13.864 L96.87,15.621 C98.23,15.819 99.337,16.752 99.762,18.059 C100.186,19.366 99.839,20.772 98.856,21.73 L98.856,21.73 L90.107,30.259 C89.734,30.623 89.563,31.146 89.651,31.659 L89.651,31.659 L91.716,43.701 C91.899,44.759 91.622,45.792 90.935,46.605 C90.246,47.423 89.244,47.893 88.187,47.893 C87.608,47.893 87.047,47.753 86.521,47.476 L86.521,47.476 L75.706,41.79 C75.255,41.555 74.686,41.553 74.234,41.79 L74.234,41.79 L63.42,47.476 C61.932,48.258 60.071,47.872 59.005,46.605 C58.319,45.792 58.041,44.761 58.224,43.701 L58.224,43.701 L60.288,31.659 C60.376,31.147 60.205,30.623 59.832,30.259 L59.832,30.259 L51.083,21.731 C50.1,20.773 49.753,19.367 50.177,18.06 C50.602,16.753 51.71,15.819 53.069,15.622 L53.069,15.622 L65.161,13.865 C65.676,13.79 66.122,13.467 66.352,13 L66.352,13 L71.759,2.043 C72.366,0.812 73.598,0.047 74.97,0.047 Z"></path>\n    </clipPath>\n  </svg>')}async render(){let e=await super.render(),t=document.createElement("div");e.appendChild(t);let i=e.querySelector("[type=range]");throw i.setAttribute("min","0"),i.setAttribute("max","5"),i.setAttribute("step","any"),t.appendChild(i),e.insertBefore(s.parseHTML(this.svg),t),e.classList.add("exf-star-rating-cnt"),t.classList.add("exf-star-rating"),"Not implemented"}}e(F,"returnValueType",Number);class I{}e(I,"controls",{filedrop:{type:E,alias:"file",note:"An input for file uploading",demo:{max:1,fileTypes:["image/"],maxSize:4096e3,caption:"Select your profile image",class:"image-upload"}},switch:{type:w},richtext:{type:L,note:"A CKEditor wrapper for ExoForm"},tags:{caption:"Tags control",type:_,note:"A control for adding multiple tags",demo:{tags:["JavaScript","CSS","HTML"]}},multiinput:{type:A},creditcard:{caption:"Credit Card",type:class extends A{constructor(...t){super(...t),e(this,"columns","4em 4em 4em 1fr"),e(this,"areas",'\n        "name name number number"\n        "expiry expiry cvv fill"'),e(this,"fields",{name:{caption:"Name on Card",type:"text",maxlength:50,required:"inherit",placeholder:""},number:{caption:"Credit Card Number",type:"text",size:16,required:"inherit",maxlength:16,placeholder:"",pattern:"[0-9]{13,16}"},expiry:{caption:"Card Expires",class:"exf-label-sup",type:"month",required:"inherit",maxlength:3,placeholder:"",min:(new Date).getFullYear()+"-"+("0"+((new Date).getMonth()+1)).slice(-2)},cvv:{caption:"CVV",type:"number",required:"inherit",minlength:3,maxlength:3,size:3,placeholder:"",min:"000"}})}},note:"A credit card control"},name:{caption:"Name (first, last) group",type:class extends A{constructor(...t){super(...t),e(this,"columns","10em 1fr"),e(this,"areas",'"first last"'),e(this,"fields",{first:{caption:"First",type:"text",maxlength:30,required:"inherit"},last:{caption:"Last",type:"text",maxlength:50,required:"inherit"}})}},note:"Person name control"},nladdress:{caption:"Dutch address",type:P,note:"Nederlands adres"},daterange:{caption:"Date range",type:class extends A{constructor(...t){super(...t),e(this,"grid","exf-cols-10em-10em"),e(this,"fields",{from:{caption:"From",type:"date"},to:{caption:"To",type:"date"}})}async render(){let e=await super.render(),t=this.inputs.from.querySelector("[name]"),i=this.inputs.to.querySelector("[name]");const s=e=>{e.target===t?i.setAttribute("min",t.value):e.target===i&&t.setAttribute("max",i.value)};return t.addEventListener("change",s),i.addEventListener("change",s),e}},note:"A date range control"},embed:{type:T,note:"Embed anything in an IFrame",demo:{url:"https://codepen.io/chriscoyier/embed/gfdDu"}},video:{type:k,caption:"Embed video",note:"An embedded video from YouTube or Vimeo",demo:{player:"youtube",code:"85Nyi4Xb9PY"}},dropdownbutton:{hidden:!0,type:S,note:"A dropdown menu button"},captcha:{caption:"Google ReCaptcha Control",type:C,note:"Captcha field",demo:{sitekey:"6Lel4Z4UAAAAAOa8LO1Q9mqKRUiMYl_00o5mXJrR"}},starrating:{type:F,note:"An accessible star rating control",demo:{value:2.5}},dialog:{type:M,caption:"Dialog",note:"A simple dialog (modal or modeless)"},info:{type:q,note:"An info panel",demo:{title:"Info",icon:"ti-info",body:"Your informational text"}}});class D extends b.controls.div.type{constructor(t){super(t),e(this,"_mode","html"),e(this,"defaultThemes",{dark:"ambiance",light:"chrome"}),e(this,"_fontSize",14),this.htmlElement.data={},this.acceptProperties({name:"mode",type:String,description:"Ace Editor mode - refer to Ace documentation"},{name:"theme",type:String,description:"Ace Editor theme - refer to Ace documentation"},{name:"fontSize",type:Number}),this.theme=document.querySelector("html").classList.contains("theme-dark")?this.defaultThemes.dark:this.defaultThemes.light}async render(){return await super.render(),new Promise(((e,t)=>{s.require("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js",(()=>{var t=ace.edit(this.htmlElement);if(t.setTheme("ace/theme/"+this.theme),t.session.setMode("ace/mode/"+this.mode),this.htmlElement.style="min-height: 200px; width: 100%; font-size: "+this.fontSize+"px;","string"==typeof this.value&&this.value.length&&t.setValue(this.value,-1),this.htmlElement.setAttribute("data-evtarget","true"),t.on("change",(e=>{setTimeout((()=>{s.trigger(this.htmlElement,"change",{target:this.htmlElement})}),10)})),this.htmlElement.data.editor=t,this.htmlElement.classList.contains("full-height")){this.container.classList.add("full-height");let e=this.container.querySelector(".exf-ctl");e&&e.classList.add("full-height")}e(this.container)}))}))}get mode(){return this._mode}set mode(e){this._mode=e,this.ace&&this.ace.session.setMode("ace/mode/"+this._mode)}get value(){return this.ace?this.ace.getValue():this.context.field.value}set fontSize(e){this._fontSize=e,ace.config.set("fontSize",this._fontSize+"px;"),this.htmlElement.style.fontSize=this._fontSize+"px;"}get fontSize(){return this._fontSize}set value(e){e=e||"",this.context.field.value=e,this.ace&&this.ace.setValue(e,-1)}get ace(){return this.htmlElement.data&&this.htmlElement.data.editor?this.htmlElement.data.editor:null}setProperties(){this.context.field.mode&&(this.mode=this.context.field.mode,delete this.context.field.mode),this.context.field.theme&&(this.theme=this.context.field.theme,delete this.context.field.theme),super.setProperties()}}e(D,"returnValueType",String);class N{}e(N,"controls",{aceeditor:{type:D,note:"Ace code editor",demo:{mode:"html"}}});class R extends b.controls.div.type{constructor(t){super(t),e(this,"value","0"),e(this,"size","200"),e(this,"color","#00acc1"),this.acceptProperties({name:"value",type:Number,description:"Percentual value of the chart (0-100)"},{name:"size"},{name:"color"},{name:"backgroundColor"},{name:"textColor"},{name:"subLineColor"},{name:"caption"})}async render(){const e=this.htmlElement;await super.render();return e.appendChild(s.parseHTML(s.format('<svg class="circle-chart" viewbox="0 0 33.83098862 33.83098862" width="{{size}}" height="{{size}}" xmlns="http://www.w3.org/2000/svg">\n            <circle class="circle-chart__background" stroke="{{backgroundColor}}" stroke-width="2" fill="none" cx="16.91549431" cy="16.91549431" r="15.91549431" />\n            <circle class="circle-chart__circle" stroke="{{color}}" stroke-width="2" stroke-dasharray="{{value}},100" stroke-linecap="round" fill="none" cx="16.91549431" cy="16.91549431" r="15.91549431" />\n            <g class="circle-chart__info">\n              <text class="metric chart-pct" x="16.91549431" y="15.5" alignment-baseline="central" text-anchor="middle" font-size="8" >{{value}}%</text>\n              <text class="metric chart-sub" x="16.91549431" y="20.5" alignment-baseline="central" text-anchor="middle" font-size="2" >{{caption}}</text>\n            </g>\n          </svg>',this))),this.container.classList.add("exf-std-lbl"),this.container}}class V{}e(V,"controls",{circularchart:{type:R,note:"Simple circular chart (SVG)",demo:{mode:"html"}}});class H{constructor(){e(this,"typeMap",{string:"text",number:"number",boolean:"switch",null:"text"}),e(this,"defaultSchema",{pages:[{label:"",intro:"",fields:[]}]})}generateFormSchema(e){if(!e)throw"Missing DTO";"string"==typeof e&&(e=JSON.parse(e)),this.dto=e;let t={...this.defaultSchema};for(var i in this.dto)t.pages[0].fields.push({name:i,caption:i,value:this.dto[i],...this.getMatchingFieldSettingsFuzzy(i,this.dto[i])});return t}getMatchingFieldSettingsFuzzy(e,t,s){return void 0===t&&(t=this.getDefault(s)),{type:this.typeMap[typeof t]||"text",caption:i.toWords(e)}}getDefault(e){if(e){if("boolean"===e.type)return!1;if("number"===e.type)return 0}return""}}class B{constructor(e){this.exo=e}apply(){this.exo.container.classList.add("exf-theme-none"),this.exo.form.addEventListener("focusin",(e=>{let t=e.target.closest(".exf-ctl-cnt");t&&t.classList.add("exf-focus")})),this.exo.form.addEventListener("focusout",(e=>{let t=e.target.closest(".exf-ctl-cnt");t&&(t.classList.remove("exf-focus"),""==e.target.value&&t.classList.remove("exf-filled"))})),this.exo.form.addEventListener("input",(e=>{let t=e.target,i=t.closest(".exf-ctl-cnt");i&&i.classList[t.value?"add":"remove"]("exf-filled")}))}}class U{static getType(e){let t=e.schema.theme;return void 0!==t&&"auto"!==t||(t=U.matchTheme(e)),U.types[t]||B}static matchTheme(e){return"material"}}e(U,"types",{auto:void 0,none:B,fluent:class extends B{apply(){super.apply(),this.exo.container.classList.add("exf-theme-fluent")}},material:class extends B{apply(){super.apply(),this.exo.container.classList.add("exf-theme-material"),this.exo.form.querySelectorAll("[name][placeholder]").forEach((e=>{e.setAttribute("data-placeholder",e.getAttribute("placeholder")||""),e.removeAttribute("placeholder")})),this.exo.form.addEventListener("focusin",(e=>{e.target.setAttribute("placeholder",e.target.getAttribute("data-placeholder")||"")})),this.exo.form.addEventListener("focusout",(e=>{e.target.removeAttribute("placeholder")}))}}});class z{constructor(e){this.exo=e,e.form.setAttribute("novalidate",!0)}checkValidity(){return 0===this.exo.query((e=>!e._control.valid),{inScope:!0}).length}reportValidity(e){let t=this.exo.query((t=>(void 0===e||e===t._page.index)&&!t._control.valid)).map((e=>({field:e,validationMessage:e._control.validationMessage})));if(t.length){!1!==this.exo.triggerEvent(ne.events.reportValidity,{invalid:t})&&(console.log(t),this.focus(t[0].field))}}focus(e){let t=e._control.htmlElement;const i=e=>{let t=e._control.htmlElement;e._control.showValidationError(),t.form||(t=t.querySelector("[name]"))};if(null===t.offsetParent){let s=t.closest("[data-page]");if(s){let t=parseInt(s.getAttribute("data-page"));this.exo.addins.navigation.goto(t),setTimeout((()=>{i(e)}),20)}}else i(e);return!0}isPageValid(e){let t=!1;try{this.runValidCheck=!0,t=this.exo.schema.pages[e-1].fields.filter((e=>!e._control.valid)).length>0}finally{this.runValidCheck=!1}return!t}testValidity(e,t){this.runValidCheck&&e.preventDefault()}}class j{constructor(e){this._field=e,this._cnt=this._field._control.container||this._field._control.htmlElement,this._error=null,this._onInvalid=this._onInvalid.bind(this),this._onChange=this._onChange.bind(this),this.bindEventListeners()}bindEventListeners(){this._cnt&&(this._cnt.querySelectorAll("[name]").forEach((e=>{e.addEventListener("invalid",this._onInvalid)})),this._cnt.addEventListener("change",this._onChange))}showError(){this._field._control.showHelp(this._field._control.validationMessage,{type:"invalid"})}hideError(){this._field._control.showHelp()}_onInvalid(e){e.preventDefault()}_onChange(e){this._field._control.valid?this.hideError():this.showError()}}class O{static getType(e){let t=e.schema.validation;return"auto"!==t&&void 0!==t||(t=O.matchValidationType(e)),O.types[t]||z}static matchValidationType(e){return"inline"}}e(O,"types",{auto:void 0,html5:z,inline:class extends z{constructor(e){super(e);const t=e.form;e.on(ne.events.interactive,(i=>{e.query().forEach((e=>{e._control._validator=new j(e)})),t.setAttribute("novalidate",!0)}))}reportValidity(e){const t=e?t=>t._page.index===e&&!t._control.valid:e=>!e._control.valid;this.exo.query(t).forEach((e=>{e._control._validator.showError()}))}}});class W{constructor(t){e(this,"buttons",{}),this.exo=t,this._visible=!0,this._currentPage=1,this.form=t.form}get visible(){return this._visible}set visible(e){this._visible=e,this.form.querySelector(".exf-nav-cnt")&&s[this._visible?"show":"hide"]()}clear(){let e=this.form.querySelector(".exf-nav-cnt");e&&e.remove()}render(){for(var e in this.container=s.parseHTML('<fieldset class="exf-cnt exf-nav-cnt"></fieldset>'),this.buttons)this.addButton(e,this.buttons[e]);this.form.appendChild(this.container),this.form.setAttribute("data-current-page",this.currentPage),this.form.querySelector(".exf-cnt.exf-nav-cnt").addEventListener("click",(e=>{switch(console.log("nav click: "+e.target.name),e.target.name){case"next":e.preventDefault(),this.next();break;case"prev":e.preventDefault(),this.back()}})),this.exo.on(ne.events.page,(e=>{this.updateButtonStates()})),this.exo.on(ne.events.pageRelevancyChange,(e=>{this._pageCount=this.getLastPage(),this.updateButtonStates()})),this.exo.on(ne.events.interactive,this._ready.bind(this))}_ready(e){this._pageCount=this.getLastPage(),this.updateButtonStates()}canMove(e,t){return console.debug("Check navigation from",e,"to",t),!0}addButton(e,t){t={class:"",type:"button",caption:e,name:e,...t||{}};let i=s.parseHTML(`<button name="${t.name}" type="${t.type}" class="exf-btn ${t.class}">${t.caption}</button>`);this.buttons[e].element=i,this.container.appendChild(i)}_updateView(e,t){let i=this.currentPage;if(e>0&&i>0&&!this.exo.addins.validation.isPageValid(this.currentPage))return void this.exo.addins.validation.reportValidity(this.currentPage);if(0!==e&&(t=parseInt("0"+this.form.getAttribute("data-current-page"))||1),console.log("updateview 1 -> ",e,t,"current",i),t=this._getNextPage(e,t),console.log("updateview 2 -> ",e,t,"current",i),this._pageCount=this.getLastPage(),this._currentPage=t,i>0){if(!this.canMove(i,t))return;if(!1===this.exo.triggerEvent(ne.events.beforePage,{from:i,page:t,pageCount:this.pageCount}))return}this.form.setAttribute("data-current-page",this.currentPage),this.form.setAttribute("data-page-count",this.exo.schema.pages.length),this._currentPage=t;let s=0;return this.form.querySelectorAll(".exf-page[data-page]").forEach((e=>{s++,e.classList[s===t?"add":"remove"]("active")})),this.update(),this.exo.triggerEvent(ne.events.page,{from:i,page:t,pageCount:this.pageCount}),t}next(){this._updateView(1)}back(){this._updateView(-1)}restart(){this.goto(1)}goto(e){return this._updateView(0,e)}get currentPage(){return this._currentPage||(this._currentPage=1),this._currentPage}get pageCount(){return this._pageCount||(this._pageCount=this.getLastPage()),this._pageCount}_getNextPage(e,t){let i=!1;var s;do{if((t+=e)>this.exo.schema.pages.length)return;let n=this.form.querySelector('.exf-page[data-page="'+t+'"]');if(!n)return void(i=!0);if(s="true"===n.getAttribute("data-skip"),console.debug("Wizard Page "+t+" currently "+(s?"OUT OF":"in")+" scope"),s||(i=!0),0===e)break}while(!i);return t<1&&(t=1),t}getLastPage(){let e=parseInt("0"+this.form.getAttribute("data-current-page"))||1,t=0,i=-1;do{i=this._getNextPage(1,e),i&&(t=i,e=i)}while(i);return t||e||1}updateButtonStates(){let e=this.buttons.prev;e&&e.element&&s[1===this.currentPage?"disable":"enable"](e.element);let t=this.buttons.next;t&&t.element&&s[this.currentPage===this.pageCount?"disable":"enable"](t.element)}update(){}}class $ extends W{constructor(...t){super(...t),e(this,"buttons",{send:{caption:"Submit",class:"form-post"}})}render(){super.render(),this.buttons.send.element.addEventListener("click",(e=>{e.preventDefault(),this.exo.submitForm()}))}}class J extends ${constructor(...t){super(...t),e(this,"buttons",{prev:{caption:"Back",class:"form-prev"},next:{caption:"Next ",class:"form-next"},send:{caption:"Submit",class:"form-post"}})}}class G{static getType(e){let t=e.schema.navigation;return void 0!==t&&"auto"!==t||(t=G.matchNavigationType(e)),G.types[t]}static matchNavigationType(e){return e.schema.pages.length>1?"wizard":"default"}}e(G,"types",{auto:void 0,none:class extends W{},static:class extends W{render(){super.render(),this.exo.on(ne.events.renderReady,(e=>{setTimeout((()=>{this.form.querySelectorAll(".exf-page").forEach((e=>{e.style.display="block"}))}),1)}))}},default:$,wizard:J,survey:class extends J{constructor(...t){super(...t),e(this,"multiValueFieldTypes",["checkboxlist","tags"])}render(){const e=this;super.render();e.exo.form.querySelector(".exf-wrapper").addEventListener("change",(t=>{let i=t.target.closest("[data-exf]");i&&i.data&&i.data.field&&e.checkForward(i.data.field,"change",t)})),e.exo.form.addEventListener("keydown",(t=>{if(8===t.keyCode)(""===t.target.value&&!t.target.selectionStart||0===t.target.selectionStart)&&(e.this.back(),t.preventDefault(),t.returnValue=!1);else if(13===t.keyCode&&"textarea"!==t.target.type){let i=t.target.closest("[data-exf]"),s=ne.getFieldFromElement(i);e.checkForward(s,"enter",t),t.preventDefault(),t.returnValue=!1}})),e.exo.on(ne.events.page,(t=>{e.focusFirstControl()}));let t=e.exo.form.closest(".exf-container");t.classList.add("exf-survey"),e.exo.on(ne.events.interactive,(i=>{e.exo.form.style.height=t.offsetHeight+"px",e.exo.form.querySelectorAll(".exf-page").forEach((e=>{e.style.height=t.offsetHeight+"px"}))}))}focusFirstControl(){var e=this.exo.form.querySelector(".exf-page.active .exf-ctl-cnt");e&&null!==e.offsetParent&&(e.closest(".exf-page").scrollIntoView(),setTimeout((t=>{let i=e.querySelector("[name]");i&&i.offsetParent&&i.focus()}),20))}checkForward(e,t,i){if(this.exo.container&&(this.exo.container.classList.remove("end-reached"),this.exo.container.classList.remove("step-ready"),e._control.valid||!this.multiValueFieldTypes.includes(e.type)))if(this._currentPage==this.getLastPage())this.exo.container.classList.add("end-reached"),this.form.appendChild(this.exo.container.querySelector(".exf-nav-cnt"));else{let t=e.type;i.detail&&i.detail.field&&(t=i.detail.field),["checkboxlist","tags"].includes(t)?this.exo.container.classList.add("step-ready"):this.exo.addins.navigation.next(),e._control.container.appendChild(this.exo.container.querySelector(".exf-nav-cnt"))}}}});class Z{constructor(e){this.exo=e,this.nav=e.addins.navigation}render(){this.exo.on(ne.events.page,(e=>{console.debug(this,"Paging",e)}))}}class Y extends Z{}class X{static getType(e){let t=e.schema.progress;return void 0!==t&&"auto"!==t||(t=X.matchProgressType(e)),X.types[t]}static matchProgressType(e){return e.schema.pages.length>1?"static"===e.schema.navigation?"none":"page":"default"}}e(X,"types",{auto:void 0,none:Z,default:Y,page:class extends Y{render(){super.render();let e=this.exo.form.querySelectorAll(".exf-page:not([data-skip='true']) > legend"),t=1;e.length>1&&e.forEach((i=>{i.innerHTML+=` <span class="exf-pg-prg">(${t}/${e.length})</span>`,t++}))}},steps:class extends Y{constructor(...t){super(...t),e(this,"container",null),e(this,"templates",{progressbar:'\n            <nav class="exf-wiz-step-cnt">\n                <div class="step-wizard" role="navigation">\n                <div class="progress">\n                    <div class="progressbar empty"></div>\n                    <div class="progressbar prog-pct"></div>\n                </div>\n                <ul>\n                    {{inner}}\n                </ul>\n                </div>\n                \n            </nav>',progressstep:'\n            <li class="">\n                <button type="button" id="step{{step}}">\n                    <div class="step">{{step}}</div>\n                    <div class="title">{{pagetitle}}</div>\n                </button>\n            </li>'})}render(){super.render();const e=this;e.container=s.parseHTML(e.templates.progressbar.replace("{{inner}}","")),e.ul=e.container.querySelector("ul");let t=0;e.exo.schema.pages.forEach((i=>{t++,e.ul.appendChild(s.parseHTML(s.format(this.templates.progressstep,{step:t,pagetitle:i.legend})))})),e.container.querySelectorAll(".step-wizard ul button").forEach((t=>{t.addEventListener("click",(i=>{var s=parseInt(t.querySelector("div.step").innerText);e.exo.addins.navigation[s>0?"next":"back"]()}))})),e.exo.on(window.xo.form.factory.events.page,(t=>{e.setClasses()})),this.exo.container.insertBefore(this.container,this.exo.form)}setClasses(){const e=this;let t=e.nav.currentPage,i=e.nav.getLastPage();if(!e.container)return;if(t<0||t>i)return;var s=100/i*(t-1);let n=e.container.querySelector(".progressbar.prog-pct");n&&(n.style.width=s+"%");var r=0;e.container.querySelectorAll("ul li").forEach((i=>{r++,i.classList[r===t?"add":"remove"]("active"),i.classList[e.exo.addins.validation.isPageValid(r)?"add":"remove"]("done")})),e.container.querySelectorAll(".exf-wiz-step-cnt .step-wizard li").forEach((e=>{e.style.width=100/i+"%"}))}},survey:class extends Y{}});class K{constructor(e){this.exo=e}checkRules(){}}class Q{static getType(e){let t=e.schema.rules;return void 0!==t&&"auto"!==t||(t=Q.matchRuleEngineType(e)),Q.types[t]}static matchRuleEngineType(e){return"default"}}e(Q,"types",{auto:void 0,none:K,default:class extends K{constructor(...t){super(...t),e(this,"ruleMethods",{visible:[ee.show,ee.hide],enabled:[ee.enable,ee.disable],scope:[te.scope,te.descope],customMethod:[ee.callCustomMethod,()=>{}],goto:[te.goto,()=>{}],dialog:[ie.show,()=>{}]})}interpretRule(e,t,i){const n=this;let r=ne.fieldToString(t);if(console.debug("Rules: running rule on "+r+" -> [",i.expression.join(", ")+"]"),5===i.expression.length){let e=n.ruleMethods[i.type];if(e){let a=n.getRenderedControl(i.expression[0]);if(a){let o=a.querySelector("[name]");if(o||(o=a),o){console.debug("Rules: dependency control for rule on '"+r+"': ",o.name);const a=l=>{console.debug("Event '"+i.expression[1]+"' fired on ",s.elementPath(l));let c=i.expression.slice(2,5),d=n.testRule(t,o,...c);console.debug("Rules: rule",c,"matched: ",d);const h=e[d?0:1];console.debug("Rules: applying rule",i.expression[1],r),h.apply(t._control.htmlElement,[{event:l,field:t,exoForm:n.exo,rule:i,dependency:o}]);let u=n.getEventHost(o);n.setupEventEventListener({field:t,host:u,rule:i,eventType:i.expression[1],method:a})};a({target:o})}else console.error("Rules: dependency control for rule on '"+r+"' not found")}else console.warn("Dependency field for",t,"not found with id '"+i.expression[0]+"'")}else console.error("Rule method for rule type",i.type,"on field",t)}}setupEventEventListener(e){"livechange"===e.eventType&&(e.eventType="input"),console.debug("Setting up event listener of type '"+e.eventType+"' on ",s.elementToString(e.host)),e.host.addEventListener(e.eventType,e.method)}getRenderedControl(e){return this.exo.form.querySelector('[data-id="'+e+'"]')}checkRules(){const e=this;e.exo.schema.pages.forEach((t=>{Array.isArray(t.rules)&&(console.debug("Checking page rules",t),t.rules.forEach((i=>{Array.isArray(i.expression)&&e.interpretRule("page",t,i)}))),t.fields.forEach((t=>{Array.isArray(t.rules)&&(console.debug("Checking field rules",t),t.rules.forEach((i=>{Array.isArray(i.expression)&&e.interpretRule("field",t,i)})))}))}))}testRule(e,t,s,n,r){var a=void 0;let o=this.exo.getFieldValue(t);try{a=i.scopeEval(this,"return "+r)}catch(e){throw console.error("Error evaluating rule control value for ",t,n,o,r,e),"Error evaluating "+r}return console.debug("Value of '"+t.name+"' =",o),i.compare(n,o,a)}getEventHost(e){return e.closest('[data-evtarget="true"]')||e}}});class ee{static show(e){s.show(e.field._control.container)}static hide(e){s.hide(e.field._control.container)}static enable(e){s.enable(e.field._control.htmlElement)}static disable(e){s.disable(e.field._control.htmlElement)}static callCustomMethod(e){if(!e||!e.exoForm)throw"Invalid invocation of callCustomMethod";let t=e.rule.method;if(t){e.exoForm.options.customMethods[t].apply(e.exoForm,[e])}}}class te{static scope(e){e.field._control.container.removeAttribute("data-skip")}static descope(e){e.field._control.container.setAttribute("data-skip","true")}static goto(e){return e.exoForm.addins.navigation.goto(e.rule.page)}}class ie{static show(e){}}class se{constructor(e){this.config=e,this.baseUrl=document.location.origin,this.library=this._enrichMeta(e.library)}_enrichMeta(e){const t=this.createForm({internal:!0});for(var i in t.load({pages:[{}]}),e){let s=e[i],n={exo:t,field:{name:i,type:i}},r="base"!==i?new s.type(n):{acceptedProperties:[]};s.returns=s.returnValueType?s.returnValueType.name:"None",s.element=r.htmlElement?r.htmlElement.tagName.toLowerCase():"none",s.properties=this._getProps(s,s.type,r),s._key=i}return e}_getProps(e,t,i){let s={};return e.returnValueType&&(s.name={type:"string",description:"Name of the field. Determines posted value key"},s.required={type:"boolean",description:"Makes the field required. The form cannot be posted when the user has not entered a value in thisn field."}),s.caption={type:"string",description:"Caption text. Normally shown in a label element within the field container"},i&&i.acceptedProperties.length&&i.acceptedProperties.forEach((e=>{let t=e;"object"==typeof e&&(t=e.name),delete e.name,e.type=e.type||String,e.type=e.type.name,s[t]=e})),s}createForm(e){return new o(this,e)}createSchema(){return new a(this)}get(e){return this.library[e]}query(e){for(var t in this.library){var i=this.library[t];if(e.apply(this,[i]))return i}}isExoFormControl(e){return this.get(e.type).type.prototype instanceof ne.library.base.type}renderSingleControl(e){return this.createForm().renderSingleControl(e)}createGenerator(){return new H}}class ne{static build(e){return e=e||{},new Promise(((t,i)=>{var s=[];e={...this.defaults,...e},this.add(b.controls),this.add(I.controls),this.add(N.controls),this.add(V.controls),e.add&&e.imports.push(...e.add),e.imports.forEach((e=>{s.push(ne.loadLib(e))})),Promise.all(s).then((()=>{let i=ne.buildLibrary();console.debug("ExoFormFactory: loaded library",i,"from",e.imports),t(new se({...e,library:i}))}))}))}static buildLibrary(){for(var e in ne.library){var t=ne.library[e];t.typeName=e,t.returnValueType=String,t.type=this.lookupBaseType(e,t),t.isList=t.type.prototype instanceof ne.library.list.type,t.isList&&(t.isMultiSelect=t.type.isMultiSelect),t.returnValueType=t.type.returnValueType,["date"].includes(t.typeName)&&(t.returnValueType=Date)}return ne.library}static lookupBaseType(e,t){let i=t.type;for(;void 0===i&&t.base;)(t=this.library[t.base])||console.error("Invalid base type",t.base),i=t.type,i.prototype instanceof ne.library.base.type||console.error("Class for "+e+" is not derived from ExoControlBase");return i}static async loadLib(e){let t=(await import(e)).default;this.add(t.controls)}static add(e){for(var t in e){var i=e[t];ne.library[t]=i}}static listNativeProps(e){let t=e.__proto__,i=Object.getOwnPropertyNames(t),s=["id","style","class","accesskey","contenteditable","dir","disabled","hidefocus","lang","language","tabindex","title","unselectable"," xml:lang"];return i.forEach((e=>{void 0!==Object.getOwnPropertyDescriptor(t,e).set&&s.push(e.toLowerCase())})),s}static loadCustomControl(e,t){return ne.importType(t)}static async importType(e){return await import(e)}static tryScriptLiteral(e){let t;if("string"==typeof e&&e.trim().startsWith("const")){try{t=new Function("function s(){"+e+"; return schema};return s()").call()}catch(e){}return t}}static checkTypeConversion(e,t){let i,s=ne.library[e];if(s)try{i=ne.getTypeParser(s)(t),i!==t&&console.debug("ExoFormFactory: value '",t,"' for field",e," converted to",i,typeof i)}catch(e){console.error("Error converting '"+i+"'to "+s.returnValueType,e)}return i}static getTypeParser(e){switch(e.returnValueType){case Number:return Number.parseFloat;case Date:return ne.parseDate;case Boolean:return ne.parseBoolean;default:return e=>e}}static parseDate(e){let t=Date.parse(e);return isNaN(t)?t:new Date(t).toJSON()}static parseBoolean(e){return parseInt(e)>0||"1"===e||"true"===e||"on"===e}static getFieldFromElement(e,t){t={master:!1,...t||{}};let i=null;if(e.getAttribute("data-exf")?i=e.data.field:e.classList.contains("exf-ctl-cnt")?(e=e.querySelector("[data-exf]"))&&(i=e.data.field):(e=e.closest("[data-exf]"))&&(i=e.data.field),e&&t.master){let t=e.closest("[exf-data-master]");t&&(i=(e=t).data.field)}return i}static fieldToString(e){if(e){let t=e.type||"unknown type";if(e.isPage)return"Page "+e.index+" ("+t+")";if(e.name||e.id&&e.elm)return"Field '"+(e.name||e.id)+"' ("+t+")"}return"Unknown field"}}e(ne,"_ev_pfx","exf-ev-"),e(ne,"events",{schemaLoaded:ne._ev_pfx+"form-loaded",renderStart:ne._ev_pfx+"render-start",getListItem:ne._ev_pfx+"get-list-item",renderReady:ne._ev_pfx+"render-ready",interactive:ne._ev_pfx+"form-interactive",reportValidity:ne._ev_pfx+"report-validity",dataModelChange:ne._ev_pfx+"datamodel-change",beforePage:ne._ev_pfx+"before-page",page:ne._ev_pfx+"page",pageRelevancyChange:ne._ev_pfx+"page-relevancy-change",post:ne._ev_pfx+"post",error:ne._ev_pfx+"error"}),e(ne,"meta",{navigation:{type:G,description:"Navigation component"},validation:{type:O,description:"Validation component"},progress:{type:X,description:"Progress display component"},theme:{type:U,description:"Theme component"},rules:{type:Q,description:"Rules component"}}),e(ne,"Context",se),e(ne,"defaults",{imports:[],defaults:{navigation:"auto",validation:"default",progress:"auto",theme:"material"}}),e(ne,"html",{classes:{formContainer:"exf-container",pageContainer:"exf-page",elementContainer:"exf-ctl-cnt",groupContainer:"exf-input-group",groupElementCaption:"exf-caption"}}),e(ne,"library",{});class re{constructor(t,i,s){if(e(this,"title","Module"),e(this,"menuIcon","ti-test"),this.route=i,this.app=t,this.path=s,!t)throw"RouteModule constructor parameter 'app' not defined";if(!t.config)throw"app.config not defined"}init(){}_unload(){document.head.querySelectorAll("[data-pwa]").forEach((e=>{e.remove()})),this.unload()}unload(){}async asyncInit(){return Promise.resolve()}execute(){const e=this;e.asyncInit().then((()=>{e._beforeRender(),e.app.UI.areas.title&&e.app.UI.areas.title.set(e.title),e.render(...arguments)}))}render(){}_beforeRender(){const e=this;for(var t in e.app.UI.areas)e.app.UI.areas[t].empty=!1}}class ae{constructor(t,n,r){e(this,"modules",[]);const a=this;i.addEvents(this),a.app=t,a.routes=n,a.setupHashListener(r.onRoute),console.debug("Loading Route modules"),a.loadModules().then((()=>{console.debug("Loaded Route modules",a.modules),s.trigger(window,"hashchange")})).then((()=>{console.debug("Router Ready"),r.ready()}))}_triggerEvent(e,t,i){return console.debug("Triggering event",e,"detail: ",t),i||(i=new Event(e,{bubbles:!1,cancelable:!1})),i.detail={router:this,...t||{}},this.dispatchEvent(i)}on(e,t){return console.debug("Listening to event",e,t),this.addEventListener(e,t),this}static changeHash(e){history.replaceState(null,null,document.location.pathname+"#"+e)}setupHashListener(e){this.routeCallback=(t,i)=>{this._triggerEvent(ae.events.route,{module:t,path:i}),e(t,i)};const t=this;window.addEventListener("hashchange",(()=>{t.hashChanged()}))}hashChanged(){const e=this,t=window;var i=t.location.hash.substr(1);if(i.startsWith("/")){let s="/"+i.substr(1).split("/")[0],n=i.substr(s.length),r=e.routes[s];if(console.debug(t.location.hash,"RouteModule: ",r),r){let t=e.findByRoute(r);if(t&&t.module){e._route=s;let i=document.querySelector("html");i.classList.forEach((e=>{e.startsWith("route-")&&i.classList.remove(e)})),document.querySelector("html").classList.add("route-"+t.module.constructor.name),e.current&&e.current.module._unload(),e.current=t,e.routeCallback(t.module,n)}}else i.startsWith("dlg-")||e.home()}else e.home()}set route(e){if(!e.startsWith("/"))throw"Invalid route";let t=e.substring(1).split("/");if(!this.routes["/"+t[0]])throw"Unknown route: "+e;ae.changeHash(e),this.hashChanged()}get route(){return this._route}findByRoute(e){return this.modules.find((t=>t.route===e))}findById(e){return this.modules.find((t=>t.path===e))}loadModules(){const e=this;let t=[],i=!1;for(var s in e.routes){"/"===s&&(i=!0);let n=e.routes[s];if(!s.startsWith("/"))throw"Malformed route: "+s;t.push(new Promise(((t,i)=>{if(n.prototype&&n.prototype instanceof re){let i=new n(e.app,n,s);t(i)}else"string"==typeof n&&e.loadES6Module(n,e.app,n,s).then((e=>{t(e)}))})))}if(!i)throw"Router misconfiguration: no home (/) route found";return Promise.all(t).then((t=>{t.forEach((t=>{e.modules.push({...t,route:t.route,url:"#"+t.path,module:t})}))}))}loadES6Module(e){e=new URL(e,this.app.config.baseUrl);let t=Array.prototype.slice.call(arguments,1);return(async e=>{try{return await import(e)}catch(t){throw"Could not load "+e+": "+t}})(e).then((e=>{let i=new(0,e.default)(...t);return i.init(),i}))}home(){this.route="/"}generateMenu(e){const t=this;let i=[];t.modules.forEach((e=>{if(!e.hidden){let t={...e,name:e.module.constructor.name};t.menuTitle=t.menuTitle||e.title;let n=s.format('<li class="{{class}}" data-module="{{name}}" title="{{title}}"><a href="{{url}}"><span class="{{menuIcon}}"></span> <span class="name">{{menuTitle}}</span></a></li>',t);i.push(n)}}));let n=s.format('<nav class="main-menu"><ul>{{inner}}</ul></nav>',{inner:i.join("")});return e.add(s.parseHTML(n)),e.element.addEventListener("click",(e=>{const t=this;e.target.closest("li")&&(t.app.UI.areas.menu.element.classList.add("clicked"),this.touchStarted||setTimeout((()=>{t.app.UI.areas.menu.element.classList.remove("clicked"),t.touchStarted=!1}),1500))})),e.element.addEventListener("touchstart",(e=>{if(this.touchStarted=!0,t.config.areas.menu){let i=e.target.closest(t.config.areas.menu);i&&(e.target.closest("li")?i.classList.add("clicked"):i.classList.remove("clicked"))}})),e}}e(ae,"_ev_pfx","pwa-ev-"),e(ae,"events",{route:ae._ev_pfx+"route"});class oe{constructor(e){this.UI=e}add(e,t){t=t||{type:"info"},e?"string"!=typeof e&&(e=e.toString()):e="An unknown error has occurred";let i=s.parseHTML(s.format('\n            <div class="pwa-notif pwa-{{type}}">\n                <div class="pwa-cnt">\n                    <span>{{msg}}</span>\n                    <div class="pwa-notif-btns"></div>\n                    <progress value="100" max="100"></progress>\n                </div>\n            </div>\n        ',{type:t.type,msg:e}));if(t.buttons){let e=i.querySelector(".pwa-notif-btns");for(var n in t.buttons){let i=t.buttons[n],r=s.parseHTML(s.format('<button class="exf-btn">{{caption}}</button>',i));e.appendChild(r),r.addEventListener("click",(e=>{e.stopPropagation(),i.click(e)}))}}i.addEventListener("click",(()=>{i.remove()}));const r=t.timeout||2e3+200*e.split(" ").length;document.body.appendChild(i);let a=i.querySelector("progress");a.setAttribute("value","100");var o,l=100;o=setInterval((()=>{l--,a.setAttribute("value",l.toString()),l<=0&&clearInterval(o)}),r/100),setTimeout((()=>{i.classList.add("move-out"),setTimeout((()=>{i.remove()}),2e3)}),r)}}class le{constructor(e,t){this.name=e;this.element=t,this.checkPinnable()}add(e){if(e)try{"string"==typeof e&&(e=-1===e.indexOf("<")?s.parseHTML("<span>"+e+"</span>"):s.parseHTML(e)),this.element.appendChild(e)}catch(t){throw"Area.add failed for "+e+". "+t.toString()}}set(e){this.element.innerHTML=e}clear(){this.set("")}checkPinnable(){const e=this;e.element.classList.contains("pwa-pinnable")&&(e.element.addEventListener("mouseover",(t=>{t.offsetX>e.element.offsetWidth-70&&t.offsetY<70?(e.pinActive=!0,e.element.classList.add("pin-active")):e.pinActive&&(e.pinActive=!1,e.element.classList.remove("pin-active"))})),e.element.addEventListener("click",(t=>{e.pinActive&&(e.pinned=!e.pinned)})))}get pinned(){return this.element.classList.contains("pinned")}set pinned(e){this.element.classList[e?"add":"remove"]("pinned"),e||this.element.classList.remove("pin-active")}set busy(e){e?this.element.classList.add("pwa-loading"):this.element.classList.remove("pwa-loading")}get busy(){this.element.classList.add("pwa-loading")}set empty(e){clearTimeout(this.rtimer),clearTimeout(this.atimer),e?(this.element.classList.remove("remove"),this.rtimer=setTimeout((()=>{this.element.classList.remove("add")}),100),this.element.classList.add("pwa-empty-state","add")):(this.element.classList.add("remove"),this.rtimer=setTimeout((()=>{this.element.classList.remove("pwa-empty-state","remove")}),500))}get empty(){return this.element.classList.includes("pwa-empty-state")}}class ce{constructor(t){e(this,"_dirtyMessage","If you continue your changes will not be saved."),e(this,"_dirty",!1),e(this,"areas",{}),e(this,"notifications",new oe(this));const i=this;this.pwa=t,this.html=document.querySelector("html"),this.pwa.id&&this.html.setAttribute("id",this.pwa.id),this.pwa.config.UI.user={prefersDarkScheme:!!window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,currentTheme:localStorage.getItem("theme")||"light"},this.pwa.config.UI.allowUserSelection||this.html.classList.add("no-user-select"),"ontouchstart"in window&&this.html.classList.add("pwa-touch"),this.forceTheme?this.theme=this.forceTheme:void 0===this.pwa.config.UI.user.currentTheme?this.theme=this.pwa.config.UI.user.prefersDarkScheme?"dark":"light":this.theme=this.pwa.config.UI.user.currentTheme,window.addEventListener("beforeunload",(function(e){e.preventDefault(),i.dirty?e.returnValue="":delete e.returnValue})),this._setAreas()}set dirty(e){this._dirty=!0}get dirty(){return this._dirty}_setAreas(){let e=document.querySelectorAll("[data-pwa-area]");if(!e.length)throw"No PWA areas defined";e.forEach((e=>{var t=e.getAttribute("data-pwa-area");this.areas[t]=new le(t,e)}))}get theme(){return this._theme||"light"}set theme(e){this._theme=e;let t=document.querySelector("head > meta[name='color-scheme']");t?(t.setAttribute("content",e),localStorage.setItem("theme",e),document.querySelector("html").classList.remove("theme-dark","theme-light"),document.querySelector("html").classList.add("theme-"+e)):console.warn("Theming depends on meta[name='color-scheme']"),this.pwa._triggerEvent("pwa.theme",{theme:e})}addStyleSheet(e){s.addStyleSheet(e,{"data-pwa":this.pwa.router.current.path})}async showDialog(e){(await window.xo.form.factory.build()).createForm().renderSingleControl({...e||{},type:"dialog"}).then((e=>{window.xo.form.factory.getFieldFromElement(e)._control.show()}))}}class de{constructor(e){this.app=e,i.addEvents(this)}async init(){return new Promise(((e,t)=>{const i=this.app.config.signalR;i&&i.enabled?s.require("https://cdn.jsdelivr.net/npm/@aspnet/signalr@1.1.2/dist/browser/signalr.js",(()=>{const t=(new signalR.HubConnectionBuilder).withUrl(i.notificationServiceUrl+"/api").configureLogging(signalR.LogLevel[i.logLevel]).build();t.on("newMessage",(e=>{console.debug("signalR",e),this._triggerEvent(e.notificationDTO.useCase,{...e.notificationDTO})})),t.onclose((()=>console.log("disconnected"))),console.log("Starting signalR connection ",i.notificationServiceUrl),t.start().then((()=>!0)).catch(console.error),e()})):e()}))}on(e,t){return console.debug("Listening to event",e,t),this.addEventListener(e,t),this}_triggerEvent(e,t,i){return console.debug("Triggering event",e,"detail: ",t),i||(i=new Event(e,{bubbles:!1,cancelable:!0})),i.detail={eventHub:this,...t||{}},this.dispatchEvent(i)}}class he{constructor(e){this.app=e}send(e,t){const i=this,s=new Headers;t=t||{},e=new URL(e,this.app.config.baseUrl);const n={method:"GET",...t};let r=e=>Promise.resolve();return t.isAnonymous||(r=()=>i.app.getToken.apply(i.app)),r().then((i=>{if(i&&i.accessToken?s.append("Authorization","Bearer "+i.accessToken):console.warn("No JWT Token provided. Continuing anonymously"),t.headers)for(var r in t.headers)s.append(r,t.headers[r]);return n.headers=s,"DELETE"===n.method?fetch(e,n):fetch(e,n).then((e=>e.json()))}))}get(e,t){return t={...t||{},method:"GET"},this.send(e,t)}post(e,t){return t={...t||{},method:"POST"},this.send(e,t)}put(e,t){return t={...t||{},method:"PUT"},this.send(e,t)}delete(e,t){return t={...t||{},method:"DELETE"},this.send(e,t)}}class ue{constructor(t){e(this,"defaults",{UI:{allowUserSelection:!1},serviceWorker:{src:null}});const s=this;i.addEvents(this),document.querySelector("html").classList.add("pwa-signin-pending"),this.config={...this.defaults,...t||{}},this.config.baseUrl=document.location.origin,this.config.environment=["localhost","127.0.0.1"].includes(document.location.hostname)?"debug":"prod",console.debug("Checking for serviceWorker in config: serviceWorker.src"),s.config.serviceWorker.src&&s._registerWorker(s.config.serviceWorker),console.debug("PWA Config",this.config),this.restService=new he(this),this.eventHub=new de(this),this.eventHub.init().then((()=>{this.asyncInit().then((()=>{this.UI=new ce(this),s.init(),s.execute()}))}));let n=document.querySelector("html").classList;this.forceTheme=n.contains("theme-dark")?"dark":n.contains("theme-light")?"light":void 0,n.add("pwa-env-"+this.config.environment)}_triggerEvent(e,t,i){return console.debug("Triggering event",e,"detail: ",t),i||(i=new Event(e,{bubbles:!1,cancelable:!0})),i.detail={app:this,...t||{}},this.dispatchEvent(i)}on(e,t){return console.debug("Listening to event",e,t),this.addEventListener(e,t),this}_registerWorker(e){console.debug("Register PWA ServiceWoker..."+e.src),"serviceWorker"in navigator&&navigator.serviceWorker.register(e.src).then((function(e){console.debug("Registration successful, scope is:",e.scope)})).catch((function(e){console.log("Service worker registration failed, error:",e)}))}init(){}asyncInit(){return Promise.resolve()}execute(e){const t=this;this.setupUI(),t.router=new ae(t,this.config.routes,{onRoute:(e,t)=>{console.debug("PWA Executes Route",e,t),this._triggerEvent("pwa.route",{module:e,path:t})&&e.execute(t)},ready:()=>{console.debug("PWA Router Ready"),t.routerReady()}})}rest(e,t){return this.restService.send(e,t)}get signedIn(){return null!=window.account}getToken(){return Promise.resolve()}setupUI(){}routerReady(){}}e(ue,"RouteModule",re),e(ue,"Router",ae);class pe extends ue.RouteModule{async asyncInit(){this.exoContext=await ne.build()}}class me{constructor(t){e(this,"options",{mode:"redirect",libUrl:"https://alcdn.msauth.net/browser/2.7.0/js/msal-browser.js",msal:{auth:{clientId:"<clientid>",authority:"<authority>",redirectUri:document.URL.split("#")[0]},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(e,t,i)=>{if(!i)switch(e){case msal.LogLevel.Error:return void console.error(t);case msal.LogLevel.Info:return void console.info(t);case msal.LogLevel.Verbose:return void console.debug(t);case msal.LogLevel.Warning:return void console.warn(t)}}}},loginRequest:{scopes:["User.Read"]},tokenRequest:{scopes:["User.Read"],forceRefresh:!1}}});t=t||{},this.options={...this.options,...t}}async load(){const e=this;return await new Promise(((t,i)=>{e.require(e.options.libUrl,(i=>{console.debug(e.options.libUrl,"loaded"),e.init(),t(this)}))}))}require(e,t){var i=document;i.querySelectorAll("head");let s=i.createElement("script");s.src=e,i.head.appendChild(s),s.onload=t}static trigger(e){let t=new Event("msid");t.detail=e,document.body.dispatchEvent(t)}init(){var e=this;e.myMSALObj=new msal.PublicClientApplication(e.options.msal),"popup"!==e.options.mode&&e.myMSALObj.handleRedirectPromise().then((t=>{e.handleResponse(t)})).catch((e=>{console.error(e)})),e.getAccount()}signIn(e){var t=this;t.getAccount()||("popup"===t.options.mode?t.myMSALObj.loginPopup(t.options.msal.loginRequest).then((e=>{null!==e&&(t.account=e.account,t.signedIn())})).catch((e=>{console.error(e)})):t.myMSALObj.loginRedirect(t.options.msal.loginRequest))}signedIn(){me.trigger({type:"signedIn",account:this.account,mode:this.options.mode})}signOut(){var e=this;e.account&&e.myMSALObj.logout({account:e.myMSALObj.getAccountByUsername(e.account.username)}).then((()=>{me.trigger({type:"signedOut",account:e.account,mode:e.options.mode})}))}getAccount(){var e=this;const t=e.myMSALObj.getAllAccounts();if(0===t.length)return null;if(t.length>1)throw"Multiple accounts detected.";1===t.length&&(e.account=t[0],e.signedIn())}getJWT(e){const t=this,i=t.options.msal.tokenRequest;return t.waitForInit().then((()=>{if(!e)throw"No user signed in";return i.account=t.myMSALObj.getAccountByUsername(e),t.myMSALObj.acquireTokenSilent(i).catch((e=>{if(e instanceof msal.InteractionRequiredAuthError)return t.myMSALObj.acquireTokenRedirect(i);console.warn(e)}))}))}waitForInit(){const e=e=>new Promise((t=>setTimeout(t,e)));return this.myMSALObj?e(1):e(200)}handleResponse(e){var t=this;null!==e&&(t.account=e.account,t.isBusy()||t.signedIn())}isBusy(){return this.myMSALObj.interactionInProgress()}}const ge={core:i,dom:s,pwa:ue,route:pe,form:{factory:ne,fields:{base:b},wizard:class extends pe{constructor(...t){super(...t),e(this,"title","Wizard"),e(this,"menuIcon","ti-wand")}formLoaded(){}wizardRendered(){}post(e){}event(e){}unload(){this.app.UI.areas.main.clear();let e=document.querySelector(".exf-wiz-step-cnt");e&&e.remove(),document.body.classList.remove("exf-fs-progress")}render(){const e=this;e.engine=e.exoContext.createForm({host:e}).on(ne.events.post,(t=>{e.post(t.detail.postData)}));let t=null;t=e.wizardSettings.url?new URL(e.wizardSettings.url,e.app.config.baseUrl).toString():e.wizardSettings.schema,e.engine.load(t).then((t=>{e.formLoaded(),t.addEventListener(ne.events.page,(t=>{s.changeHash(e.path+"/page/"+t.detail.page)})),t.renderForm().then((t=>{e.app.UI.areas.main.clear(),e.app.UI.areas.main.add(t.container),e.wizardRendered(t)}))}))}}},identity:{msal:me}};return window.xo=ge,ge}));
