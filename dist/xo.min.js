!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("regenerator-runtime/runtime")):"function"==typeof define&&define.amd?define(["regenerator-runtime/runtime"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).xo=t()}(this,(function(){"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Emitter{constructor(e){this.obj=e,this.eventTarget=document.createDocumentFragment(),["addEventListener","dispatchEvent","removeEventListener"].forEach(this.delegate,this)}delegate(e){this.obj[e]=this.eventTarget[e].bind(this.eventTarget)}}class Iterator{constructor(e,t){for(var r in this.index=[],this.i=0,this.o=e,e)this.index.push({key:r,order:e[r][t]});this.index.sort((function(e,t){var r=e.order,o=t.order;return r==o?0:r>o?1:-1})),this.len=this.index.length}next(){return this.i<this.len?this.o[this.index[this.i++].key]:null}}class Core{static addEvents(e){new Emitter(e)}static compare(e,t,r){return this.operatorTable[e](t,r)}static stringifyJSONWithCircularRefs(e){var t=[],r=JSON.stringify(e,((e,r)=>{if("object"==typeof r&&null!==r){if(t.includes(r))return;t.push(r)}return r}),2);return t=null,r}static toPascalCase(e){return"string"!=typeof e?e:e.replace(/(\w)(\w*)/g,(function(e,t,r){return t.toUpperCase()+r.toLowerCase()}))}static prettyPrintJSON(e){return JSON.stringify(e,null,3).replace(/&/g,"&amp;").replace(/\\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/^( *)("[\w]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/gm,(function(e,t,r,o,n){var a=t||"";return r&&(a=a+'<span class="json-key" style="color: brown">'+r.replace(/[": ]/g,"")+"</span>: "),o&&(a=a+('"'==o[0]?'<span class="json-string" style="color: olive">':'<span class="json-value" style="color: navy">')+o+"</span>"),a+(n||"")}))}static guid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}static async waitFor(e,t){return new Promise(((r,o)=>{let n=new Date,a=setInterval((function(){e()?(clearInterval(a),r()):new Date-n>t&&(clearInterval(a),o())}),20)}))}static isValidUrl(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}static toWords(e){var t=e.replace(/([A-Z])/g," $1");return t.charAt(0).toUpperCase()+t.slice(1)}}_defineProperty(Core,"operatorTable",{">":(e,t)=>e>t,"<":(e,t)=>e<t,">":(e,t)=>e>=t,"<=":(e,t)=>e<=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"&&":(e,t)=>e&&t}),_defineProperty(Core,"Iterator",Iterator);class DragDropSorter{constructor(e,t,r){Core.addEvents(this),this.masterContainer=e,this.selector=t,this.childSelector=r,this.dragSortContainers=e.querySelectorAll(t),console.debug("dragSortContainers selected for dragdrop sorting: "+this.dragSortContainers.length,", selector: ",t),this.enableDragList(e,r)}triggerEvent(e,t){console.debug("Triggering event",e,"detail: ",t);let r=new Event(e);r.detail=t,this.dispatchEvent(r)}on(e,t){return console.debug("Listening to event",e,t),this.addEventListener(e,t),this}enableDragList(e,t){let r=e.querySelectorAll(t);console.debug("Elements selected for dragdrop sorting: "+r.length,", childSelector: ",t),r.forEach((e=>{this.enableDragItem(e)}))}enableDragItem(e){e.setAttribute("draggable",!0),e.ondrag=e=>{this.handleDrag(e)},e.ondragend=e=>{this.handleDrop(e)}}handleDrag(e){const t=e.target,r=t.closest(this.selector),o=e.clientX,n=e.clientY;t.classList.add("drag-sort-active");let a=t.closest(this.selector);a&&(a.classList.add("drag-sort-in-process"),console.debug("drag starts: "+t.class,", container:",a.class));let i=null===document.elementFromPoint(o,n)?t:document.elementFromPoint(o,n);r===i.parentNode&&(i=i!==t.nextSibling?i:i.nextSibling,r.insertBefore(t,i))}handleDrop(e){e.target.classList.remove("drag-sort-active"),console.debug("drag stopped: "+e.target.class);let t=e.target.closest(this.selector);t&&(console.debug("Sort container: "+t.class),t.classList.remove("drag-sort-in-process")),this.triggerEvent("sort",{order:this.getOrder()})}getOrder(){return[]}destroy(){this.masterContainer.querySelectorAll("[draggable]").forEach((e=>{e.draggable=!1,e.ondrag=null,e.ondragend=null}))}}class DOM$1{static parseHTML(e){return(new DOMParser).parseFromString(e,"text/html").body.firstChild}static getValue(e){if(DOM$1._checkNull("getValue",e),"select"===e.type||"select-one"===e.type)return-1!==e.selectedIndex?e.options[e.selectedIndex].value:void 0;if("radio"===e.type){let t=e.closest('[data-name="'+e.name+'"]').querySelector(":checked");return t?t.value:void 0}return e.value}static setValue(e,t){DOM$1._checkNull("setValue",e),e.value=t}static elementPath(e){return e.toString()}static elementToString(e){DOM$1._checkNull("elementToString",e);let t=[];return e&&e.nodeName&&t.push(e.nodeName),e.id&&t.push("#",e.id),e.classList&&e.classList.length&&(t.push("."),t.push(Array(e.classList).join("."))),t.join("")}static _checkNull(e,t){}static hide(e){DOM$1._checkNull("hide",e),e.style.display="none"}static show(e){DOM$1._checkNull("show",e),e.style.display="block"}static enable(e){DOM$1._checkNull("enable",e),e.removeAttribute("disabled")}static disable(e){DOM$1._checkNull("disable",e),e.setAttribute("disabled","disabled")}static trigger(e,t,r){DOM$1._checkNull("trigger",e);let o=new Event(t);o.detail=r,e.dispatchEvent(o)}static throttleResize(e,t){DOM$1._checkNull("throttleResize",e);let r;t(),e.addEventListener("resize",(e=>{clearTimeout(r),r=setTimeout(t,100)}))}static changeHash(e){history.replaceState(null,null,document.location.pathname+"#"+e)}static prettyPrintHTML(e){var t=document.createElement("div");return t.innerHTML=e.trim(),DOM$1.formatHTMLNode(t,0).innerHTML.trim()}static formatHTMLNode(e,t){for(var r,o=new Array(1+t++).join("  "),n=new Array(t-1).join("  "),a=0;a<e.children.length;a++)r=document.createTextNode("\n"+o),e.insertBefore(r,e.children[a]),DOM$1.formatHTMLNode(e.children[a],t),e.lastElementChild==e.children[a]&&(r=document.createTextNode("\n"+n),e.appendChild(r));return e}static setupGrid(){const e=document.querySelector("HTML");DOM$1.throttleResize(window,(t=>{((t,r)=>{const o="nsp-",n={xs:768,sm:992,md:1200,lg:1440,xl:1920,uw:2300};var a="nsp-xs";for(var i in n)e.classList.remove(o+i),t>n[i]&&(a=o+i);e.classList.remove("nsp-portrait"),e.classList.remove("nsp-landscape"),e.classList.add(t>r?"nsp-landscape":"nsp-portrait"),e.classList.add(a)})(window.innerWidth,window.innerHeight)}))}static parseCSS(e){let t=document.implementation.createHTMLDocument(""),r=document.createElement("style");return r.textContent=e,t.body.appendChild(r),r.sheet.cssRules}static waitFor(e,t){return t||(t=1e3),Core.waitFor((()=>document.querySelector(e)),t)}static require(e,t){"string"==typeof e&&(e=[e]);var r=document;let o=0;return new Promise(((n,a)=>{e.forEach((a=>{let i=r.createElement("script");i.src=a,r.head.appendChild(i),i.onload=r=>{o++,o===e.length&&("function"==typeof t&&t(),n())}}))}))}static addStyleSheet(e,t){var r=document;if(r.querySelector("head > link[rel=stylesheet][href='"+e+"']"))return;let o=r.createElement("link");if(o.rel="stylesheet",o.href=e,t)for(var n in t)o.setAttribute(n,t[n]);r.head.appendChild(o)}static getObjectValue(e,t,r){t=DOM$1.stringToPath(t);for(var o=e,n=0;n<t.length;n++){if(!o[t[n]])return r;o=o[t[n]]}return o}static format(e,t,r){if(r=r||{empty:""},e="function"==typeof e?e():e,-1===["string","number"].indexOf(typeof e))throw"Placeholders: please provide a valid template";return t?e=e.replace(/\{\{([^}]+)\}\}/g,(function(e){e=e.slice(2,-2);var o=DOM$1.getObjectValue(t,e.trim());return o||(void 0!==r.empty?r.empty:"{{"+e+"}}")})):e}static stringToPath(e){if("string"!=typeof e)return e;var t=[];return e.split(".").forEach((function(e){e.split(/\[([^}]+)\]/g).forEach((function(e){e.length>0&&t.push(e)}))})),t}static replace(e,t){let r=e;return r.parentNode.insertBefore(t,r),r.remove(),t}static unwrap(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);return t.removeChild(e),t}static copyToClipboard(e){const t=window.getSelection(),r=document.createRange();r.selectNodeContents(e),t.removeAllRanges(),t.addRange(r);const o=document.execCommand("copy");return window.getSelection().removeAllRanges(),o}static maskInput(e,t){t.pattern,t.mask;const r=(e,t,r)=>{for(var o=e.replace(/[^0-9]/g,"").split(""),n=0,a="",i=0;i<t.length;i++){const e=t[i];o[n]?/\*/.test(e)?(a+=o[n],n++):a+=e:r&&r.split("")[i]&&(a+=r.split("")[i])}return a},o=e=>{const t=r(e.value,e.getAttribute("data-format"));if(e.value=r(e.value,e.getAttribute("data-format"),e.getAttribute("data-mask")),e.createTextRange){var o=e.createTextRange();o.move("character",t.length),o.select()}else e.selectionStart&&(e.focus(),e.setSelectionRange(t.length,t.length))};e.addEventListener("keyup",(function(){o(e)})),e.addEventListener("keydown",(function(){o(e)})),o(e)}}_defineProperty(DOM$1,"DragDropSorter",DragDropSorter),_defineProperty(DOM$1,"_staticConstructor",void DOM$1.setupGrid());class ExoForm{static setup(){}constructor(e,t){_defineProperty(this,"defaults",{type:"form",baseUrl:document.location.origin,navigation:"auto",validation:"default",runtime:{progress:!1},form:{theme:"fluent",class:""},multiValueFieldTypes:["checkboxlist","tags"],ruleMethods:{visible:[Field.show,Field.hide],enabled:[Field.enable,Field.disable],scope:[Page.scope,Page.descope],customMethod:[Field.callCustomMethod,()=>{}],goto:[Page.goto,()=>{}],dialog:[Dialog.show,()=>{}]}});const r=this;if(Core.addEvents(this),!(e&&e instanceof ExoFormFactory.Context))throw"Invalid instantiation of ExoForm: need ExoFormContext instance";r.context=e,t=t||{};r.options={type:"form",customMethods:{},...t},r.formSchema={...r.defaults},r.form=DOM$1.parseHTML(DOM$1.format(ExoForm.meta.templates[r.options.type],{...r.formSchema.form||{class:""}})),r.container=DOM$1.parseHTML(ExoForm.meta.templates.exocontainer)}load(e){const t=this;return new Promise(((r,o)=>{const n=e=>{if(e){t.rawSchema=JSON.stringify(e,null,2),t.formSchema={...t.defaults,...e},t.triggerEvent(ExoFormFactory.events.schemaLoaded),t.formSchema.totalFieldCount=t.getTotalFieldCount(t.formSchema),t._applyLoadedSchema();let o=ExoFormFactory.navigation.getType(t);t.navigation=new o(t);let n=ExoFormFactory.validation.types[t.formSchema.validation];t.validation=new n(t),console.debug("Navigation type:",t.formSchema.navigation,o.name),r(t)}else r(t)};if("object"==typeof e)n(e);else try{e=new URL(e,this.formSchema.baseUrl),fetch(e).then((e=>e.json())).then((e=>{n(e)})).catch((e=>{o(e)}))}catch(e){o(e)}}))}_applyLoadedSchema(){const e=this;e.formSchema.form=e.formSchema.form||{theme:e.defaults.form.theme},(e.formSchema.form.theme?e.formSchema.form.theme.split(" "):[e.defaults.form.theme]).forEach((t=>{e.container.classList.add(t)})),(e.formSchema.form.class?e.formSchema.form.class.split(" "):["standard"]).forEach((t=>{e.form.classList.add(t)}))}triggerEvent(e,t,r){return console.debug("Triggering event",e,"detail: ",t),r||(r=new Event(e,{bubbles:!1,cancelable:!0})),r.detail={exoForm:this,...t||{}},this.dispatchEvent(r)}getTotalFieldCount(e){let t=0;return e&&e.pages&&0!==e.pages.length?(e.pages.forEach((e=>{e&&e.fields&&(t+=e.fields.length)})),t):0}isPageValid(e){const t=this;let r=!1;try{this.runValidCheck=!0,r=this.formSchema.pages[e-1].fields.filter((e=>!e._control.valid)).length>0}finally{t.runValidCheck=!1}return!r}renderForm(){const e=this;return e.triggerEvent(ExoFormFactory.events.renderStart),e._cleanup(),new Promise(((t,r)=>{if(!e.formSchema||!e.formSchema.pages||null==e.formSchema.pages.length)throw"Invalid ExoForm schema";e.container.appendChild(e.form),e.container.classList.add("exf-ver-"+ExoForm.version);try{e._renderPages().then((()=>{e._finalizeForm(),t(e)})).catch((e=>{r("_renderPages() failed: "+e.toString())}))}catch(e){r("Exception in _renderPages(): "+e.toString())}}))}_finalizeForm(){const e=this;console.debug("Finalizing form, rendering is ready"),e.navigation.render(),e.form.addEventListener("submit",(t=>{t.preventDefault(),t.stopPropagation(),e.submitForm(t)})),e.form.addEventListener("change",(e=>{e.stopPropagation()})),e._checkRules(),e._updateView(0),e.triggerEvent(ExoFormFactory.events.renderReady),new IntersectionObserver(((t,r)=>{e.container.offsetHeight&&(console.debug("Form is now interactive"),e.triggerEvent(ExoFormFactory.events.interactive))}),{root:document.documentElement}).observe(e.container)}_cleanup(){this.navigation.clear(),this.container&&(this.container.innerHTML="")}on(e,t){return console.debug("Listening to event",e,t),this.addEventListener(e,t),this}_renderPages(){const e=this;return new Promise(((t,r)=>{var o=0;e.form.setAttribute("data-current-page",o+1);let n=0;e.pageContainer=DOM$1.parseHTML('<div class="exf-wrapper" />'),e.formSchema.pages.forEach((a=>{o++,a=e._enrichPageSettings(a,o),e.pageContainer.appendChild(a.dummy),e.createControl(a).then((i=>{let s=0;a.fields.forEach((l=>{console.debug("Rendering field",l.name,l),l.dummy=DOM$1.parseHTML("<span/>"),i.appendChild(l.dummy),e.createControl(l).then((()=>{l._control.render().then((e=>{if(!e)throw ExoFormFactory.fieldToString(l)+" does not render an HTML element";s=this._addRendered(l,e,s,a,i)})).catch((e=>{let t=DOM$1.parseHTML(DOM$1.format('<span class="exf-error exf-render-error" title="{{title}}">ERROR</span>',{title:"Error rendering field "+ExoFormFactory.fieldToString(l)+": "+e.toString()}));s=this._addRendered(l,t,s,a,i)})).finally((r=>{if(n++,n===e.formSchema.totalFieldCount)if(e.container.classList.add(o>1?"exf-multi-page":"exf-single-page"),e.formSchema.form.container){let r=e._getFormContainerProps(e);e.createControl(r).then((r=>{r.render().then((o=>{o.appendChild(e.pageContainer),e.pageContainer=DOM$1.unwrap(e.pageContainer),r.finalize(e.pageContainer),e.form.appendChild(o),t()}))}))}else e.form.appendChild(e.pageContainer),t()}))})).catch((e=>{r("Exception in createControl() for control "+ExoFormFactory.fieldToString(l)+": "+e.toString())}))}))})).catch((e=>{r("Exception in createControl() for page container "+ExoFormFactory.fieldToString(a)+": "+e.toString())}))}))}))}_addRendered(e,t,r,o,n){return DOM$1.replace(e.dummy,t),delete e.dummy,++r===o.fields.length&&(console.debug("Page "+o.pagenr+" rendered with "+r+" controls"),n.render().then((e=>{DOM$1.replace(o.dummy,e),delete o.dummy}))),r}_getFormContainerProps(){return{type:"div",class:"exf-wrapper",...this.formSchema.form.container,pages:this.formSchema.pages&&this.formSchema.pages.length?this.formSchema.pages.map((e=>({id:"page"+e.id,caption:e.legend}))):[]}}_enrichPageSettings(e,t){return e.index=t,console.debug("Rendering page "+e.index),e.isPage=!0,e.type=e.type||"fieldset",e.pagenr=t,e.pageid=e.id||"page"+t,e.class="exf-cnt exf-page"+(e.class?" "+e.class:""),e.dummy=DOM$1.parseHTML("<span/>"),e}query(e){void 0===e&&(e=()=>!0);let t=[];return this.formSchema.pages.forEach((r=>{r.fields.forEach((o=>{o={_page:{index:r.index,legend:r.legend},...o},e(o)&&t.push(o)}))})),t}map(e){return this.query().forEach((t=>{let r=e(t);void 0!==r&&(t.value=r,t.setCurrentValue?t.setCurrentValue(t.value):t._control&&t._control.htmlElement&&(t._control.htmlElement.value=t.value||""))})),this}submitForm(e){const t=this;if(e&&e.preventDefault(),!t.validation.checkValidity())return console.debug("checkValidity - Form not valid"),void t.validation.reportValidity();t.form,t.getFormValues(e).then((e=>{t.triggerEvent(ExoFormFactory.events.post,{postData:e})}))}getFormValues(){const e=this,t={};return new Promise(((r,o)=>{let n=Object.fromEntries(new FormData(e.form));e.formSchema.pages.forEach((e=>{e.fields.forEach((e=>{e.getCurrentValue?t[e.name]=e.getCurrentValue():(t[e.name]=n[e.name],t[e.name]=ExoFormFactory.checkTypeConversion(e.type,t[e.name]))}))})),console.debug("Form data to post",t),r(t)}))}getFieldValue(e){return e&&e.getCurrentValue?e.getCurrentValue():e.name?DOM$1.getValue(this.form.querySelector("[name='"+e.name+"']")):void 0}gotoPage(e){return this._updateView(0,e)}nextPage(){this._updateView(1)}previousPage(){this._updateView(1)}_updateView(e,t){const r=this;let o=r.currentPage;if(e>0&&o>0&&!this.isPageValid(r.currentPage))return void this.validation.reportValidity(r.currentPage);t=t||1,0!==e&&(t=parseInt(r.form.getAttribute("data-current-page")||"0")),t=r._getNextPage(e,t);let n=r.getLastPage();if(o>0){if(!r.navigation.canMove(o,t))return;if(!1===r.triggerEvent(ExoFormFactory.events.beforePage,{from:o,page:t,pageCount:n}))return}r.form.setAttribute("data-current-page",t),r.form.setAttribute("data-page-count",r.formSchema.pages.length),r.currentPage=t;let a=0;return r.form.querySelectorAll(".exf-page[data-page]").forEach((e=>{a++,e.classList[a===t?"add":"remove"]("active")})),r.navigation.update(),r.triggerEvent(ExoFormFactory.events.page,{from:o,page:t,pageCount:n}),t}_getNextPage(e,t){const r=this;let o=!1;var n;do{if((t+=e)>r.formSchema.pages.length)return;let a=r.form.querySelector('.exf-page[data-page="'+t+'"]');if(!a)return void(o=!0);if(n="true"===a.getAttribute("data-skip"),console.debug("Wizard Page "+t+" currently "+(n?"OUT OF":"in")+" scope"),n||(o=!0),0===e)break}while(!o);return t<1&&(t=1),t}getLastPage(){const e=this;let t=parseInt(e.form.getAttribute("data-current-page")),r=0,o=-1;do{o=e._getNextPage(1,t),o&&(r=o,t=o)}while(o);return r||t||1}async renderSingleControl(e){let t=await this.createControl(e);e._control=t;let r=await t.render();if(!r)throw ExoFormFactory.fieldToString(e)+" does not render an HTML element";return r}createControl(e){const t=this;return new Promise(((r,o)=>{const n=(e,t)=>{e._control=t,t.htmlElement.data=t.htmlElement.data||{},t.htmlElement.data.field=e,t.htmlElement.setAttribute("data-exf","1"),console.debug("Resolving ",ExoFormFactory.fieldToString(e)),r(t)};try{if(!e||!e.type)throw"Incorrect field options. Must be object with at least 'type' property. "+JSON.stringify(e);e.id=e.id||Core.guid();let r=t.context.get(e.type);if(!r)throw e.type+" is not a registered ExoForm field type";let o=r.type;if(!o)throw"Class for "+e.type+" not defined";if(!t.context.isExoFormControl(e))throw"Cannot create control: class for "+e.type+" is not derived from ExoControlBase";let a=null,i={exo:t,field:e};e.custom?ExoFormFactory.loadCustomControl(e,e.custom).then((t=>{let r=t.default;a=new r(i),n(e,a)})):(a=new o(i),n(e,a))}catch(r){let o=new(t.context.get("div").type)({exo:t,field:{...e}});o.htmlElement.appendChild(DOM$1.parseHTML(DOM$1.format('<span class="exf-error exf-create-error" title="{{title}}">ERROR</span>',{title:"Error creating "+ExoFormFactory.fieldToString(e)+": "+r.toString()}))),n(e,o)}}))}testValidity(e,t){this.runValidCheck&&e.preventDefault()}_checkRules(){const e=this;"form"===e.options.type&&e.formSchema.pages.forEach((t=>{Array.isArray(t.rules)&&(console.debug("Checking page rules",t),t.rules.forEach((r=>{Array.isArray(r.expression)&&e._interpretRule("page",t,r)}))),t.fields.forEach((t=>{Array.isArray(t.rules)&&(console.debug("Checking field rules",t),t.rules.forEach((r=>{Array.isArray(r.expression)&&e._interpretRule("field",t,r)})))}))}))}getRenderedControl(e){return this.form.querySelector('[data-id="'+e+'"]')}getFieldFromElementId(e){var t=this.getRenderedControl(e);return ExoFormFactory.getFieldFromElement(t)}_interpretRule(e,t,r){const o=this;let n=ExoFormFactory.fieldToString(t);if(console.debug("Running rule on "+n+" -> [",r.expression.join(", ")+"]"),5===r.expression.length){let e=o.formSchema.ruleMethods[r.type];if(e){let a=o.getRenderedControl(r.expression[0]);if(a){let i=a.querySelector("[name]");if(i||(i=a),i){console.debug("Dependency control for rule on '"+n+"': ",i.name);const a=s=>{console.debug("Event '"+r.expression[1]+"' fired on ",DOM$1.elementPath(s));let l=r.expression.slice(2,5),c=o._testRule(t,i,...l);console.debug("Rule",l,"matched: ",c);const d=e[c?0:1];console.debug("Applying rule",r.expression[1],n),d.apply(t._control.htmlElement,[{event:s,field:t,exoForm:o,rule:r,dependency:i}]);let p=o._getEventHost(i);o._setupEventEventListener({field:t,host:p,rule:r,eventType:r.expression[1],method:a})};a({target:i})}else console.error("Dependency control for rule on '"+n+"' not found")}else console.warn("Dependency field for",t,"not found with id '"+r.expression[0]+"'")}else console.error("Rule method for rule type",r.type,"on field",t)}}_setupEventEventListener(e){"livechange"===e.eventType&&(e.eventType="input"),console.debug("Setting up event listener of type '"+e.eventType+"' on ",DOM$1.elementToString(e.host)),e.host.addEventListener(e.eventType,e.method)}_getEventHost(e){return e.closest('[data-evtarget="true"]')||e}_testRule(f,control,value,compare,rawValue){var t=void 0;let v=this.getFieldValue(control);try{t=eval(rawValue)}catch(e){throw console.error("Error evaluating rule control value for ",control,compare,v,rawValue),"Error evaluating "+rawValue}return console.debug("Value of '"+control.name+"' =",v),Core.compare(compare,v,t)}clear(){this.form.reset(),this.form.querySelectorAll(".clearable").forEach((e=>{e.innerHTML=""}))}}_defineProperty(ExoForm,"meta",{properties:{all:["accept","alt","autocomplete","autofocus","capture","checked","dirName","disabled","height","list","max","maxLength","min","minLength","multiple","name","pattern","placeholder","readOnly","required","size","src","step","type","value","width","className"],map:{class:"className",readonly:"readOnly",dirname:"dirName",minlength:"minLength",maxlength:"maxLength"},reserved:["containerClass","caption","template","elm","ctl","tagname"]},templates:{empty:'<span data-replace="true"></span>',exocontainer:'<div class="exf-container"></div>',default:'<div data-id="{{id}}" class="exf-ctl-cnt {{class}}"><label title="{{caption}}">{{caption}}</label><span data-replace="true"></span></div>',nolabel:'<div data-id="{{id}}" class="exf-ctl-cnt {{class}}"><span data-replace="true"></span></div>',text:'<div data-id="{{id}}" class="exf-ctl-cnt exf-base-text {{class}}"><span data-replace="true"></span><label title="{{caption}}">{{caption}}</label></div>',labelcontained:'<div data-id="{{id}}" class="exf-ctl-cnt {{class}}"><label title="{{tooltip}}"><span data-replace="true"></span> <span>{{caption}}</span></label></div>',form:'<form class="exf-form {{class}}" method="post"></form>',static:'<div class="{{class}}" ></div>',fieldset:'<fieldset data-page="{{pagenr}}" data-pageid="{{pageid}}" class="exf-cnt {{class}}"></fieldset>',legend:'<legend class="exf-page-title">{{legend}}</legend>',pageIntro:'<p class="exf-page-intro">{{intro}}</p>',datalist:'<datalist id="{{id}}"></datalist>',datalistItem:'<option label="{{label}}" value="{{value}}" >',button:'<button name="{{name}}" type="{{type}}" class="btn {{class}}">{{caption}}</button>'}}),_defineProperty(ExoForm,"_staticConstructor",void ExoForm.setup()),_defineProperty(ExoForm,"version","0.981");class Field{static show(e){DOM$1.show(e.field._control.container)}static hide(e){DOM$1.hide(e.field._control.container)}static enable(e){DOM$1.enable(e.field._control.htmlElement)}static disable(e){DOM$1.disable(e.field._control.htmlElement)}static callCustomMethod(e){if(!e||!e.exoForm)throw"Invalid invocation of callCustomMethod";let t=e.rule.method;if(t){e.exoForm.options.customMethods[t].apply(e.exoForm,[e])}}}class Page{static scope(e){e.field._control.container.removeAttribute("data-skip")}static descope(e){e.field._control.container.setAttribute("data-skip","true")}static goto(e){return e.exoForm.gotoPage(e.rule.page)}}class Dialog{static show(e){}}class ExoControlBase{constructor(e){if(_defineProperty(this,"attributes",{}),_defineProperty(this,"acceptedProperties",[]),_defineProperty(this,"dataProps",{}),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.empty),this.constructor===ExoControlBase)throw new Error("Can't instantiate abstract class!");if(this.context=e,!e||!e.field||!e.exo)throw"Invalid instantiation of ExoControlBase";this.htmlElement=DOM$1.parseHTML("<span/>")}set htmlElement(e){this._htmlElement=e,this.allowedAttributes=ExoFormFactory.listNativeProps(this.htmlElement),this.isSelfClosing=["area","base","col","embed","hr","img","input","link","meta","param","source","track","wbr"].includes(e.tagName.toLowerCase())}get htmlElement(){return this._htmlElement}appendChild(e){this.htmlElement.appendChild(e)}triggerChange(e){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),t.detail=e,this.htmlElement.dispatchEvent(t)}set enabled(e){let t=this.htmlElement;t.disabled=!e;let r=t.closest(".exf-ctl-cnt");r&&r.classList[e?"remove":"add"]("disabled")}acceptProperties(...e){e.forEach((e=>{"string"==typeof e&&(e={name:e}),this.acceptedProperties.find((t=>t.name===e.name))||(this.acceptedProperties.push(e),void 0!==this.context.field[e.name]&&(this[e.name]=this.context.field[e.name]))}))}get enabled(){return!this.htmlElement.disabled}async render(){for(var e in this.setProperties(),this.attributes)this._htmlElement.setAttribute(e,this.attributes[e]);for(var e in this.dataProps)this._htmlElement.setAttribute("data-"+e,this.dataProps[e]);if(this.container=DOM$1.parseHTML(DOM$1.format(this.containerTemplate,this.getContainerAttributes())),"true"===this.container.getAttribute("data-replace"))this.container=this.htmlElement;else{let e=this.container.querySelector('[data-replace="true"]');e?DOM$1.replace(e,this.htmlElement):this.container=this.htmlElement}return this.addEventListeners(),this.container}addEventListeners(){const e=this,t=e.context.exo,r=e.context.field;e.htmlElement.addEventListener("invalid",(o=>(console.debug("check validity on ",o.target,"submitCheck",e.submitCheck),"true"===o.target.closest("[data-page]").getAttribute("data-skip")?(console.debug("invalid event on skipped control",o.target.name),o.preventDefault(),!1):t.testValidity(o,r)))),e.htmlElement.addEventListener("change",(e=>{let t=e.target.value!=e.target.defaultValue,r=e.target.closest(".exf-ctl-cnt");r&&r.classList[t?"add":"remove"]("exf-dirty")}))}getContainerAttributes(){let e=this.context.field;return{caption:e.caption,tooltip:e.tooltip||"",class:e.containerClass||"",id:e.id+"-container"}}setProperties(){let e=this.context.field;for(var t in e){if(ExoForm.meta.properties.reserved.includes(t))continue;let r=e[t.toLowerCase()],o=t;this.allowedAttributes.includes(o)?this.attributes[o]=r:"object"==typeof r?this[o]=r:this.acceptedProperties&&this.acceptedProperties.includes(o)||(this.dataProps[o]=r)}}get valid(){return!this.htmlElement||!this.htmlElement.reportValidity||this.htmlElement.reportValidity()}get validationMessage(){return this.htmlElement.validationMessage}showValidationError(){return!this.htmlElement||!this.htmlElement.reportValidity||this.htmlElement.reportValidity()}}_defineProperty(ExoControlBase,"returnValueType",void 0);class ExoElementControl extends ExoControlBase{constructor(e){if(super(e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.empty),e.field.tagName)try{if(this.htmlElement=DOM$1.parseHTML("<"+e.field.tagName+"/>"),this.htmlElement.nodeName!==e.field.tagName.toUpperCase())throw"'"+e.field.tagName+"' is not a valid tagName";this.isSelfClosing||this.acceptProperties({name:"html",type:String,description:"Inner HTML"}),this.html&&(this.htmlElement.innerHTML=this.html)}catch(t){throw"Could not generate '"+e.field.tagName+"' element: "+t.toString()}}}_defineProperty(ExoElementControl,"returnValueType",void 0);class ExoLinkControl extends ExoElementControl{constructor(e){super(e),this.htmlElement=document.createElement("a"),this.acceptProperties({name:"external",type:Boolean,description:"External to open in new tab"},{name:"html",type:String})}async render(){return this.external&&this.htmlElement.setAttribute("target","_blank"),super.render()}}class ExoInputControl extends ExoElementControl{constructor(e){super(e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.default),this.htmlElement=document.createElement("input"),"hidden"===e.field.type&&(this.containerTemplate=ExoForm.meta.templates.empty)}async render(){return"email"===this.context.field.type&&this.createEmailLookup(),await super.render(),this.testDataList(),this.container}createEmailLookup(){const e=this;e.htmlElement.addEventListener("keyup",(t=>{if(13!==t.keyCode){let r=[];["@gmail.com","@outlook.com","@live.nl","@yahoo.com","@hotmail.com"].forEach((e=>{r.push(t.target.value.split("@")[0]+e)})),r.length>1&&e.createDataList(e.context.field,r)}}))}testDataList(){const e=this;let t=e.context.field;if(t.lookup)if(Array.isArray(t.lookup))e.createDataList(t,t.lookup);else{let r=r=>{let o=t.lookup.replace(".json","_"+r+".json");o=new URL(o,e.formSchema.baseUrl),fetch(o).then((e=>e.json())).then((r=>{e.createDataList(t,r)}))};Core.isValidUrl(t.lookup)||(r=e.getFetchLookup(t)),this.htmlElement.addEventListener("keyup",(e=>{r(t._control.htmlElement.value)}))}}getFetchLookup(e){const t=this,r=t.context.exo,o={field:e,type:"lookup",data:e.lookup,callback:(e,r)=>{t.createDataList.call(t,e,r)}};return"OpenData"===o.data.type?e=>{e=e.substr(0,1).toUpperCase()+e.substr(1);let t=o.data.url+"?$top=20&$filter=substring("+o.data.field+",0,"+e.length+") eq '"+e+"'";fetch(t).then((e=>e.json())).then((e=>{e&&e.value&&o.callback(o.field,e.value.map((e=>e.Title)))}))}:r.options.get(o)}createDataList(e,t){let r=e.id;e._control.htmlElement.setAttribute("list","list-"+r);let o=e._control.container.querySelector("datalist");o&&o.remove();const n=DOM$1.parseHTML(DOM$1.format(ExoForm.meta.templates.datalist,{id:"list-"+r}));t.forEach((e=>{let t={value:e,label:e.name,...e};n.appendChild(DOM$1.parseHTML(DOM$1.format(ExoForm.meta.templates.datalistItem,t)))})),e._control.container.appendChild(n)}}_defineProperty(ExoInputControl,"returnValueType",String);class ExoTextControl extends ExoInputControl{constructor(e){super(e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.text),this.isTextInput=!0,this.htmlElement=DOM$1.parseHTML('<input type="text"/>')}async render(){var e=this.context.field;return this.attributes.placeholder||(this.attributes.placeholder=" "),await super.render(),e.mask&&DOM$1.maskInput(this.htmlElement,{mask:e.mask,format:e.format}),this.container}}class ExoFormControl extends ExoElementControl{constructor(e){super(e),this.htmlElement=DOM$1.parseHTML("<form />")}}class ExoDivControl extends ExoElementControl{constructor(e){super(e),_defineProperty(this,"html",""),this.htmlElement=document.createElement("div"),this.acceptProperties({name:"html",type:String,description:"Inner HTML of the div"})}async render(){return this.html&&(this.htmlElement.innerHTML=this.html),await super.render()}}class ExoTextAreaControl extends ExoTextControl{constructor(e){super(e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.text),this.htmlElement=DOM$1.parseHTML("<textarea/>")}setProperties(){super.setProperties(),this.attributes.value&&(this.htmlElement.innerHTML=this.attributes.value,delete this.attributes.value)}}class ExoListControl extends ExoElementControl{constructor(e){super(e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.default),_defineProperty(this,"isMultiSelect",!1),_defineProperty(this,"view","tiles"),this.htmlElement=DOM$1.parseHTML("<select></select>"),this.acceptProperties({name:"view",type:String,description:"Set the view mode (list, tiles)"})}async populateList(e,t){const r=this,o=r.context.field;o.items&&Array.isArray(o.items)&&o.items.forEach((n=>{r.addListItem(o,n,t,e)}))}addListItem(e,t,r,o){const n=this;var a=DOM$1.parseHTML("<span/>");o.appendChild(a);let i={...t,name:t.name||t,value:void 0!==t.value?t.value:t,type:n.optionType,inputname:e.name,checked:t.checked?"checked":"",tooltip:(t.tooltip||t.name||"").replace("{{field}}","")};var s={field:e,control:n,item:i};if(i.element)s.listElement=i.element,DOM$1.replace(a,i.element);else if(i.field)this.renderFieldSync(i,r,o);else if(i.html)s.listElement=DOM$1.parseHTML(i.html),DOM$1.replace(a,s.listElement);else{var l=DOM$1.format(r,i);s.listElement=DOM$1.parseHTML(l),DOM$1.replace(a,s.listElement)}n.context.exo.triggerEvent(ExoFormFactory.events.getListItem,s)}renderFieldSync(e,t,r){return(async(e,t)=>{-1===e.name.indexOf("{{field}}")&&(e.tooltip=e.tooltip||e.name,e.name=e.name+"{{field}}");const o=this.context.exo.context;let n=await o.createForm().renderSingleControl(e.field);e.name=DOM$1.format(e.name,{field:n.outerHTML}),r.appendChild(DOM$1.parseHTML(DOM$1.format(t,e)))})(e,t)}async render(){let e=await super.render();switch(this.view){case"tiles":e.classList.add("tiles");break;case"list":e.classList.add("block")}return e}}class ExoDropdownListControl extends ExoListControl{constructor(e){super(e),this.htmlElement=DOM$1.parseHTML('<select size="1"></select>')}async render(){let e=this.context.field;e.containerClass=(e.containerClass||"")+" exf-"+this.context.field.type+" exf-input-group";return await this.populateList(this.htmlElement,'<option class="{{class}}" value="{{value}}">{{name}}</option>'),super.render()}}class ExoInputListControl extends ExoListControl{constructor(e){super(e);this.htmlElement=DOM$1.parseHTML(DOM$1.format('<div data-evtarget="true" class="{{class}}" {{required}}>{{inner}}</div>',{class:[this.context.field.class||""].join(" ")}))}async render(){let e=this.context.field;e.containerClass=(e.containerClass||"")+" exf-"+this.context.field.type+" exf-input-group";return await this.populateList(this.htmlElement,'<label title="{{tooltip}}"><input class="{{class}}" {{checked}} name="{{inputname}}" value="{{value}}" type="{{type}}" /><span class="exf-caption">{{name}}</span></label>'),super.render(),this.container}get valid(){if(this.context.field.required){let e=this.context.exo.getFieldValue(this.context.field);if(!e||0===e.length){let e=this.htmlElement.querySelector("input");try{e.setCustomValidity(this.getValidationMessage()),e.reportValidity()}catch{}return!1}}return!0}getValidationMessage(){let e="You must select a value",t=DOM$1.parseHTML('<form><input name="test" required /></form');return t.querySelector("input").addEventListener("invalid",(t=>{e=t.validationMessage,t.preventDefault()})),t.submit(),e}showValidationError(){this.htmlElement.querySelector("input").setCustomValidity("This cannot be empty")}get validationMessage(){return this.htmlElement.querySelector("input").validationMessage}}class ExoRadioButtonListControl extends ExoInputListControl{constructor(e){super(e),_defineProperty(this,"optionType","radio")}}class ExoCheckboxListControl extends ExoInputListControl{constructor(e){super(e),_defineProperty(this,"optionType","checkbox")}async render(){return await super.render(),this.context.field.getCurrentValue=()=>{let e=[];return this.container.querySelectorAll(":checked").forEach((t=>{e.push(t.value)})),e},this.container}}_defineProperty(ExoCheckboxListControl,"returnValueType",Array);class ExoButtonControl extends ExoElementControl{constructor(e){super(e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.nolabel),this.iconHtml="",this.htmlElement=DOM$1.parseHTML("<button />"),this.acceptProperties({name:"icon",description:"Icon class to be used (using a span)"},{name:"click",description:"Click method"},{name:"action",description:"Possible values: 'next' (next page in Wizard)"})}async render(){const e=this;e.icon&&(e.htmlElement.appendChild(DOM$1.parseHTML('<span class="'+e.icon+'"></span>')),this.htmlElement.appendChild(document.createTextNode(" "))),e.htmlElement.appendChild(document.createTextNode(this.context.field.caption));let t=await super.render();return e.htmlElement.addEventListener("click",(t=>{if(e.click)e.context.exo.getFormValues().then((t=>{let r=e.click;if("function"!=typeof r&&(r=e.context.exo.options.customMethods[r]),"function"!=typeof r){if(!e.context.exo.options.host)throw"Not a valid function: "+e.click;if("function"==typeof e.context.exo.options.host[e.click])return r=e.context.exo.options.host[e.click],void r.apply(e.context.exo.options.host,[t])}r.apply(e,[t])}));else if(e.action)switch(e.action){case"next":e.context.exo.nextPage()}})),t}set icon(e){this._icon=e}get icon(){return this._icon}}class ExoNumberControl extends ExoInputControl{constructor(e){super(e),this.context.field.type="number"}}_defineProperty(ExoNumberControl,"returnValueType",Number);class ExoRangeControl extends ExoNumberControl{constructor(e){super(e),this.context.field.type="range"}}_defineProperty(ExoRangeControl,"returnValueType",Number);class ExoProgressControl extends ExoElementControl{constructor(e){super(e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.nolabel),this.htmlElement=DOM$1.parseHTML("<progress />")}}class ExoFormPageControl extends ExoDivControl{finalize(){}}class ExoFieldSetControl extends ExoFormPageControl{constructor(e){super(e),this.htmlElement=DOM$1.parseHTML(DOM$1.format(ExoForm.meta.templates.fieldset,e.field)),e.field.legend&&this.appendChild(DOM$1.parseHTML(DOM$1.format(ExoForm.meta.templates.legend,{legend:e.field.legend}))),e.field.intro&&this.appendChild(DOM$1.parseHTML(DOM$1.format(ExoForm.meta.templates.pageIntro,{intro:e.field.intro})))}}class ExoBaseControls{}_defineProperty(ExoBaseControls,"controls",{base:{hidden:!0,type:ExoControlBase},element:{type:ExoElementControl,note:"Any raw HTML Element",demo:{type:"element",tagName:"img",src:"https://source.unsplash.com/random/600x400"}},input:{hidden:!0,type:ExoInputControl},div:{hidden:!0,type:ExoDivControl,note:"A standard HTML div container element",demo:{html:"<h3>Wow!</h3>"}},form:{hidden:!0,type:ExoFormControl},formpage:{hidden:!0,type:ExoFormPageControl},fieldset:{hidden:!0,for:"page",type:ExoFieldSetControl,note:"A fieldset for grouping controls in a form"},text:{caption:"Short text",type:ExoTextControl,note:"Standard text input"},url:{caption:"Website Address/URL",base:"text",note:"A text input that will accept URLs only"},tel:{caption:"Phone number",base:"input",note:"A text input that is used to input phone numbers",demo:{value:"06 23467899"}},number:{caption:"Numeric Control",type:ExoNumberControl,note:"A text input that is used to input phone numbers",demo:{min:1,max:99}},range:{caption:"Range Slider",type:ExoRangeControl,note:"A range slider input",demo:{min:1,max:10,value:5}},color:{caption:"Color Input",base:"input",note:"A control to select a color",demo:{value:"#cc4433"}},checkbox:{base:"input",note:"A checkbox",demo:{checked:!0}},email:{caption:"Email Address",base:"text",note:"A text input that validates email addresses",demo:{required:!0}},date:{base:"input",note:"A date input that is used to input phone numbers"},month:{base:"input",note:"A month selector input"},"datetime-local":{caption:"Local Date &amp; Time selector",base:"input",note:"A date input that is used to input local date/time"},search:{base:"text",note:"A search text input with a clear button"},password:{base:"text",note:"A text input for password masking"},file:{caption:"File upload",base:"text",note:"A standard file upload control"},multiline:{caption:"Long text",type:ExoTextAreaControl,alias:"textarea",note:"A multi-line text input"},list:{hidden:!0,type:ExoListControl},dropdown:{type:ExoDropdownListControl,alias:"select",note:"A dropdown list control",demo:{items:["First","Second"]}},checkboxlist:{caption:"Multiselect List (checkbox)",type:ExoCheckboxListControl,note:"A group of checkboxes to select multiple items",demo:{items:["First","Second"]}},radiobuttonlist:{caption:"Single select List (radio)",type:ExoRadioButtonListControl,note:"A group of radio buttons to select a single value from",demo:{items:["First","Second"]}},hidden:{base:"input",note:"A hidden input that is used to store variables"},custom:{hidden:!0,base:"div",note:"A custom control that is used to render your own ExoFormControl classes"},button:{type:ExoButtonControl,note:"A button control",demo:{caption:"Click me"}},time:{caption:"Time selector",base:"text",note:"A time input control"},progressbar:{type:ExoProgressControl,alias:"progress",note:"A progress indicator control"},link:{type:ExoLinkControl,note:"HTML Anchor element"}});class ExoFileDropControl extends ExoBaseControls.controls.input.type{constructor(e){super(e),this.acceptProperties({name:"maxSize"},{name:"max",type:Number,description:"Max number of files accepted"},{name:"fileTypes",type:String|Array,description:'Array of strings - example: ["image/"]'},{name:"maxSize",type:Number,description:"Maximum filesize of files to be uploaded (in bytes) - example: 4096000"})}async render(){const e=this;return e.field=e.context.field,e.field.type="file",e.field.data=this.field.data||[],await super.render(),e.previewDiv=DOM$1.parseHTML('<div class="file-preview clearable"></div>'),e.container.appendChild(e.previewDiv),e.container.classList.add("exf-filedrop"),e.bind((t=>{if(t.error)alert(t.error);else{var r=DOM$1.parseHTML('<div data-id="'+t.fileName+'" class="thumb '+t.type.replace("/"," ")+'"></div>');let o=DOM$1.parseHTML('<button title="Remove" type="button" class="close">x</button>');o.addEventListener("click",(t=>{let r=t.target.closest(".thumb"),o=r.getAttribute("data-id");Array.from(e.previewDiv.children).indexOf(r),r.remove(),e.field.data=e.field.data.filter((e=>e.fileName!==o)),e._change()})),r.appendChild(o),r.setAttribute("title",t.fileName);let n=DOM$1.parseHTML('<div class="thumb-data"></div>');t.type.startsWith("image/")?(r.classList.add("image"),n.style.backgroundImage='url("'+e.getDataUrl(t.b64,t.type)+'")'):r.classList.add("no-img"),r.appendChild(n),r.appendChild(DOM$1.parseHTML("<figcaption>"+t.fileName+"</figcaption>")),e.previewDiv.appendChild(r)}})),e.field.getCurrentValue=()=>e.field.data.sort(),e.container}_change(){DOM$1.trigger(this.htmlElement,"change",{data:this.context.field.data})}bind(e){const t=this,r=r=>{var o=r.file,n=new FileReader;n.onload=function(){let o={error:"",fileName:r.file.name,type:r.file.type,size:r.file.size,date:r.file.lastModifiedDate};if(t.field.max&&t.field.data.length>=t.field.max&&(o.error="Maximum number of attachements reached"),t.field.fileTypes){let e=!1;t.field.fileTypes.forEach((t=>{0===r.file.type.indexOf(t)&&(e=!0)})),e||(o.error="Invalid file type")}!o.error&&t.field.maxSize&&r.file.size>t.field.maxSize&&(o.error="Max size exceeded"),o.error||(o.b64=btoa(n.result)),o.error||(t.field.data.push(o),t._change()),e(o)};try{n.readAsBinaryString(o)}catch{}},o=t.htmlElement.closest(".exf-ctl-cnt");t.htmlElement.addEventListener("change",(e=>{if(!e.detail){for(var t in e.stopImmediatePropagation(),e.cancelBubble=!0,e.preventDefault(),e.stopPropagation(),e.returnValue=!1,o.classList.remove("drag-over"),e.target.files)r({file:e.target.files[t]});return!1}})),o.addEventListener("dragover",(e=>{e.dataTransfer.dropEffect="copy",o.classList.add("drag-over")})),o.addEventListener("drop",(e=>{e.dataTransfer.dropEffect="none",o.classList.remove("drag-over")})),o.addEventListener("dragleave",(e=>{e.dataTransfer.dropEffect="none",o.classList.remove("drag-over")}))}getDataUrl(e,t){return"data:"+t+";base64,"+e}}class ExoCKRichEditor extends ExoBaseControls.controls.div.type{constructor(e){super(e),this.htmlElement.data={}}async render(){const e=this;return await super.render(),e.htmlElement,new Promise(((t,r)=>{DOM$1.require("https://cdn.ckeditor.com/ckeditor5/17.0.0/classic/ckeditor.js",(()=>{ClassicEditor.create(e.htmlElement).catch((e=>{console.error(e)})).then((t=>{e.htmlElement.data.editor=t,e.context.field.getCurrentValue=()=>e.htmlElement.data.editor.getData(),e.context.field.setCurrentValue=t=>{e.htmlElement.data.editor.setData(t)}})),t(e.container)}))}))}}class ExoSwitchControl extends ExoBaseControls.controls.range.type{constructor(...e){super(...e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.labelcontained)}setProperties(){this.context.field.min=0,this.context.field.max=1,this.context.field.value=this.context.field.value||0,super.setProperties(),this.context.field.type="switch"}async render(){const e=this;let t=await super.render();this.container.classList.add("exf-switch");const r=t=>{let r=t.target.closest(".exf-switch"),o=r.querySelector("[type='range']");r.classList["1"===o.value?"add":"remove"]("on"),e.triggerChange()};return r({target:t}),this.context.field.disabled&&(this.enabled=!1),t.addEventListener("click",(e=>{e.stopImmediatePropagation(),e.cancelBubble=!0,e.preventDefault(),e.stopPropagation(),e.returnValue=!1;let t=e.target.closest(".exf-switch").querySelector("[type='range']");"INPUT"!=e.target.tagName&&(t.value="0"==t.value?1:0,r({target:t})),r({target:t})})),t}}_defineProperty(ExoSwitchControl,"returnValueType",Boolean);class ExoTaggingControl extends ExoBaseControls.controls.text.type{constructor(e){super(e),_defineProperty(this,"max",null),_defineProperty(this,"duplicate",!1),_defineProperty(this,"wrapperClass","exf-tags-input"),_defineProperty(this,"tagClass","tag"),_defineProperty(this,"arr",[]),this.acceptProperties({name:"max",type:Number,description:"Maximum number of tags allowed"},{name:"duplicate",type:Boolean,description:"Allow duplicates. Default false"},{name:"tags",description:"Tag names to set (array)"})}async render(){const e=this;return await super.render(),e.wrapper=document.createElement("div"),e.input=document.createElement("input"),e.htmlElement.setAttribute("type","hidden"),e.htmlElement.addEventListener("change",(e=>{e.detail||(e.stopImmediatePropagation(),e.cancelBubble=!0,e.preventDefault(),e.stopPropagation(),e.returnValue=!1)})),e.wrapper.append(e.input),e.wrapper.classList.add(e.wrapperClass),e.container.insertBefore(e.wrapper,e.htmlElement),e.context.field.getCurrentValue=()=>e.arr,e.wrapper.addEventListener("click",(function(){e.input.focus()})),e.input.addEventListener("keydown",(t=>{var r=e.input.value.trim();if(~[9,13,188].indexOf(t.keyCode))t.preventDefault(),t.stopPropagation(),t.returnValue=!1,e.input.value="",""!==r&&e.addTag(r);else if("Backspace"===t.key&&""===e.input.value){let t=e.wrapper.querySelectorAll(".tag");if(t.length){let r=t.length-1;e.deleteTag(t[r],r)}}})),e.tags&&e.tags.forEach((t=>{e.addTag(t)})),e.container}addTag(e){const t=this;if(!t.anyErrors(e)){t.arr.push(e);var r=document.createElement("span");r.className=this.tagClass,r.textContent=e;var o=document.createElement("a");return o.innerHTML="&times;",o.addEventListener("click",(e=>{e.preventDefault();for(var r=e.target.parentNode,o=0;o<t.wrapper.childNodes.length;o++)t.wrapper.childNodes[o]==r&&t.deleteTag(r,o)})),r.appendChild(o),t.wrapper.insertBefore(r,t.input),t.triggerChange(),t}}deleteTag(e,t){return e.remove(),this.arr.splice(t,1),this.triggerChange(),this}triggerChange(){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!0),e.detail={field:"tags"},this.input.dispatchEvent(e)}anyErrors(e){return null!=this.max&&this.arr.length>=this.max||!this.duplicate&&-1!=this.arr.indexOf(e)}addData(e){var t=this;return e.forEach((function(e){t.addTag(e)})),this}}class ExoCaptchaControl extends ExoBaseControls.controls.div.type{constructor(e){super(e),DOM$1.require("https://www.google.com/recaptcha/api.js"),this.acceptProperties({name:"sitekey",type:String,description:"Key for Google reCaptcha",more:"https://developers.google.com/recaptcha/intro"})}async render(){return this.htmlElement.classList.add("g-recaptcha"),this.htmlElement.setAttribute("data-sitekey",this.sitekey),this.htmlElement}set sitekey(e){this._sitekey=e}get sitekey(){return this._sitekey}}class DropDownButton extends ExoBaseControls.controls.list.type{constructor(e){super(e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.nolabel),_defineProperty(this,"navTemplate",'\n        <nav class="ul-drop" role=\'navigation\'>\n            <ul>\n                <li>\n                    <a class="user-icon" href="#"><span class="ti-user"></span></a>\n                    <ul></ul>\n                </li>\n            </ul>\n        </nav>'),this.context.field.type="hidden",this.htmlElement=DOM$1.parseHTML(this.navTemplate)}async render(){this.context.field;return await this.populateList(this.htmlElement.querySelector("ul > li > ul"),'<li title="{{tooltip}}"><a class="{{class}}" href="{{value}}">{{name}}</a></li>'),await super.render()}setupButton(){document.querySelector("body").classList.add("signed-out"),container.appendChild(DOM$1.parseHTML(DOM$1.format(tpl,data,{empty:void 0})))}}class ExoEmbedControl extends ExoBaseControls.controls.element.type{constructor(e){super(e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.default),_defineProperty(this,"width",600),_defineProperty(this,"height",400),this.acceptProperties({name:"url",description:"Url of the page to embed"},{name:"width"},{name:"height"}),this.htmlElement=document.createElement("iframe")}async render(){this.htmlElement.setAttribute("src",this.url),this.htmlElement.setAttribute("frameborder","0"),this.htmlElement.setAttribute("allowfullscreen","true"),this.htmlElement.setAttribute("allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),await super.render();let e=document.createElement("div");return e.classList.add("exf-embed"),e.appendChild(this.htmlElement),this.container.appendChild(e),this.container}}class ExoVideoControl extends ExoEmbedControl{constructor(e){super(e),_defineProperty(this,"mute",!1),_defineProperty(this,"autoplay",!0),_defineProperty(this,"player","youtube"),_defineProperty(this,"code","abcdefghij"),this.acceptProperties({name:"code",description:"Code of the video to embed"},{name:"width"},{name:"height"},{name:"autoplay",type:Boolean,description:"Boolean indicating whether the video should immediately start playing"},{name:"mute",type:Boolean,description:"Boolean indicating whether the video should be muted"},{name:"player",type:String,description:"Player type. Currently implemented: youtube, vimeo"})}async render(){const e=ExoVideoControl.players[this.player];return this.url=DOM$1.format(e.url,this),await super.render(),this.container}}_defineProperty(ExoVideoControl,"players",{youtube:{url:"https://www.youtube.com/embed/{{code}}?autoplay={{autoplay}}&mute={{mute}}"},vimeo:{url:"https://player.vimeo.com/video/{{code}}?title=0&byline=0&portrait=0&background={{mute}}"}});class MultiInputControl extends ExoBaseControls.controls.div.type{constructor(e){super(e),_defineProperty(this,"containerTemplate",ExoForm.meta.templates.default),_defineProperty(this,"columns",""),_defineProperty(this,"areas",""),this.acceptProperties({name:"grid-template",description:"CSS3 grid template",more:"https://developer.mozilla.org/en-US/docs/Web/CSS/grid-template"},{name:"areas",description:"Grid template areas to set up on the containing div",example:'"field1 field1 field2"\n                "field3 field4 field4"'},{name:"columns",description:"Grid columns to set up on containing div",example:"10em 10em 1fr"},{name:"fields",type:Object,description:"Fields structure",example:{first:{caption:"First",type:"text",maxlength:30,required:!0,placeholder:""},last:{caption:"Last",type:"text",maxlength:50,required:!0,placeholder:""}}})}async render(){await super.render();const e=this,t=e.context.field,r=e.context.exo;this.htmlElement.classList.add("exf-cnt","exf-ctl-group"),(this.areas&&this.columns||this["grid-template"]||this.grid)&&this.htmlElement.classList.add("grid"),this.areas&&this.columns?this.htmlElement.setAttribute("style",`display: grid; grid-template-areas: ${this.areas}; grid-template-columns: ${this.columns}`):this["grid-template"]?this.htmlElement.setAttribute("style",`display: grid; grid-template: ${this["grid-template"]}`):this.grid&&this.htmlElement.classList.add(this.grid),e._qs=e=>this.htmlElement.querySelector('[data-multi-name="'+t.name+"_"+e+'"]');e.inputs={};const o=async(r,o)=>(o={name:t.name+"_"+r,...o},e.inputs[r]=await(async(t,r)=>e.context.exo.renderSingleControl(r))(0,o),e.inputs[r].setAttribute("data-multi-name",o.name),e.htmlElement.appendChild(e.inputs[r]),e.inputs[r]);for(var n in!this.fields&&t.fields&&(this.fields=t.fields),this.fields){var a=await o(n,this.fields[n]);this.areas&&a.setAttribute("style",`grid-area: ${n}`)}return e._gc=t=>{let o={};for(var n in e.fields){var a=e._qs(n);let t=ExoFormFactory.getFieldFromElement(a);o[n]=r.getFieldValue(t)}return o},e._sc=t=>{for(var r in e.fields){var o=e._qs(r);let n=ExoFormFactory.getFieldFromElement(o);n.setCurrentValue?n.setCurrentValue(t[r]):o.querySelector("[name]").value=t[r]}},this.context.field.getCurrentValue=e._gc,this.context.field.setCurrentValue=e._sc,this.container}}_defineProperty(MultiInputControl,"returnValueType",Object);class ExoNameControl extends MultiInputControl{constructor(...e){super(...e),_defineProperty(this,"grid",""),_defineProperty(this,"grid-template","'first last' auto/ 10em 1fr"),_defineProperty(this,"fields",{first:{caption:"First",type:"text",maxlength:30,required:!0,placeholder:""},last:{caption:"Last",type:"text",maxlength:50,required:!0,placeholder:""}})}}class ExoNLAddressControl extends MultiInputControl{constructor(...e){super(...e),_defineProperty(this,"grid",""),_defineProperty(this,"columns","4em 4em 10em 1fr"),_defineProperty(this,"areas",'\n        "code code nr fill"\n        "ext ext city city"\n        "street street street street"'),_defineProperty(this,"fields",{code:{caption:"Postcode",type:"text",size:7,maxlength:7,required:!0,pattern:"[1-9][0-9]{3}s?[a-zA-Z]{2}",placeholder:""},nr:{caption:"Huisnummer",type:"number",size:6,maxlength:6,placeholder:""},ext:{caption:"Toevoeging",type:"text",size:3,maxlength:3,placeholder:""},city:{caption:"Plaats",type:"text",maxlength:50,readonly:!0,placeholder:""},street:{caption:"Straatnaam",type:"text",maxlength:50,readonly:!0,placeholder:""}})}async render(){const e=this;let t=await super.render();const r=()=>{var t=e._gc();t.code&&t.nr&&fetch(DOM$1.format(ExoNLAddressControl.APIUrl,{nr:t.nr,code:t.code}),{referer:"https://stasfpwawesteu.z6.web.core.windows.net/",method:"GET"}).then((e=>e.json())).then((t=>{var r=t.response;if(r.numFound>0){let t=r.docs[0];e._qs("street").querySelector("[name]").value=t.straatnaam_verkort,e._qs("city").querySelector("[name]").value=t.woonplaatsnaam}}))};return e.inputs.nr.addEventListener("change",r),e.inputs.code.addEventListener("change",r),e.inputs.ext.addEventListener("change",r),t}}_defineProperty(ExoNLAddressControl,"APIUrl","https://geodata.nationaalgeoregister.nl/locatieserver/v3/free?q=postcode:{{code}}&huisnummer:{{nr}}");class ExoCreditCardControl extends MultiInputControl{constructor(...e){super(...e),_defineProperty(this,"fields",{name:{caption:"Name on Card",type:"text",maxlength:50,required:!0,placeholder:""},number:{caption:"Credit Card Number",type:"text",size:16,required:!0,maxlength:16,placeholder:"",pattern:"[0-9]{13,16}"},expiry:{caption:"Card Expires",containerClass:"exf-label-sup",type:"month",required:!0,maxlength:3,placeholder:"",min:(new Date).getFullYear()+"-"+("0"+((new Date).getMonth()+1)).slice(-2)},cvv:{caption:"CVV",type:"number",required:!0,minlength:3,maxlength:3,size:3,placeholder:"",min:"000"}})}}class ExoDateRangeControl extends MultiInputControl{constructor(...e){super(...e),_defineProperty(this,"grid","exf-cols-10em-10em"),_defineProperty(this,"fields",{from:{caption:"From",type:"date",required:!0},to:{caption:"To",type:"date",required:!0}})}async render(){let e=await super.render(),t=this.inputs.from.querySelector("[name]"),r=this.inputs.to.querySelector("[name]");const o=e=>{e.target===t?r.setAttribute("min",t.value):e.target===r&&t.setAttribute("max",r.value)};return t.addEventListener("change",o),r.addEventListener("change",o),e}}class ExoDialogControl extends ExoBaseControls.controls.div.type{constructor(e){super(e),_defineProperty(this,"title","Dialog"),_defineProperty(this,"confirmText","OK"),_defineProperty(this,"cancelText","Cancel"),_defineProperty(this,"cancelVisible",!1),_defineProperty(this,"body","The dialog body"),_defineProperty(this,"modal",!1),_defineProperty(this,"dlgTemplate",'<div class="exf-dlg" role="dialog" id="{{dlgId}}">\n<div class="exf-dlg-c">\n    <div class="exf-dlg-h">\n        <div class="exf-dlg-t">{{title}}<button type="button" class="dlg-bc dlg-x dismiss" ><span>&times;</span></button></div>\n    </div>\n<div class="exf-dlg-b">{{body}}</div>\n<div class="exf-dlg-f">\n    <button type="button" class="dlg-x btn btn-default dismiss" >{{cancelText}}</button>\n    <button type="button" class="dlg-x btn btn-primary confirm" >{{confirmText}}</button>\n</div>\n</div>\n</div>'),this.acceptProperties("title","cancelText","body","confirmText","cancelVisible","modal"),this.dlgId="dlg_"+Core.guid().replace("-","")}hide(e){this.context.field.click&&this.context.field.click.apply(this,[e])}show(){const e=this;let t=DOM$1.format(e.dlgTemplate,{...this}),r=DOM$1.parseHTML(t);r.classList.add(this.cancelVisible?"dlg-cv":"dlg-ch");const o=(t,r)=>{e.remove();var o="cancel",n=t.target;(r||n.classList.contains("confirm"))&&(o="confirm"),e.hide.apply(e,[o])};r.querySelector(".dlg-x").addEventListener("click",o),document.body.appendChild(r),r.addEventListener("click",o),document.body.addEventListener("keydown",(e=>{27===e.keyCode&&o(e),13===e.keyCode&&o(e,!0)}),{once:!0}),this.modal||setTimeout((()=>{document.body.addEventListener("click",o,{once:!0})}),10)}remove(){let e=document.querySelector("#"+this.dlgId);e&&e.remove()}}class ExoInfoControl extends ExoBaseControls.controls.div.type{constructor(e){super(e),_defineProperty(this,"template",'<section class="exf-info {{class}}">\n    <div class="exf-info-title"><span class="exf-info-icon {{icon}}"></span><span class="exf-info-title-text">{{title}}</span></div>\n    <div class="exf-info-body">{{body}}</div>\n    </section>'),_defineProperty(this,"title",""),_defineProperty(this,"body",""),_defineProperty(this,"icon","ti-info"),this.acceptProperties("title","icon","body","class")}async render(){const e=this;return DOM$1.format(e.template,{...this}),e.htmlElement.appendChild(DOM$1.parseHTML(DOM$1.format(e.template,this))),e.htmlElement}}class ExoStarRatingControl extends ExoBaseControls.controls.range.type{constructor(...e){super(...e),_defineProperty(this,"svg",'<svg>\n    <defs>\n      <path id="star" d="M48.856,22.73c0.983-0.958,1.33-2.364,0.906-3.671c-0.425-1.307-1.532-2.24-2.892-2.438l-12.092-1.757c-0.515-0.075-0.96-0.398-1.19-0.865L28.182,3.043c-0.607-1.231-1.839-1.996-3.212-1.996c-1.372,0-2.604,0.765-3.211,1.996L16.352,14c-0.23,0.467-0.676,0.79-1.191,0.865L3.069,16.622c-1.359,0.197-2.467,1.131-2.892,2.438c-0.424,1.307-0.077,2.713,0.906,3.671l8.749,8.528c0.373,0.364,0.544,0.888,0.456,1.4L8.224,44.701c-0.183,1.06,0.095,2.091,0.781,2.904c1.066,1.267,2.927,1.653,4.415,0.871l10.814-5.686c0.452-0.237,1.021-0.235,1.472,0l10.815,5.686c0.526,0.277,1.087,0.417,1.666,0.417c1.057,0,2.059-0.47,2.748-1.288c0.687-0.813,0.964-1.846,0.781-2.904l-2.065-12.042c-0.088-0.513,0.083-1.036,0.456-1.4L48.856,22.73z"></path>\n      <clipPath id="stars">\n        <use xlink:href="#star" x="0"></use>\n        <use xlink:href="#star" x="50"></use>\n        <use xlink:href="#star" x="100"></use>\n        <use xlink:href="#star" x="150"></use>\n        <use xlink:href="#star" x="200"></use>\n      </clipPath>\n    </defs>\n  </svg>\n  \x3c!-- for safari--\x3e\n  <svg>\n    <clipPath id="allStars">\n      <path d="M24.97,0.047 C26.343,0.047 27.575,0.812 28.182,2.043 L28.182,2.043 L33.588,12.999 C33.818,13.466 34.263,13.789 34.778,13.864 L34.778,13.864 L46.87,15.621 C48.23,15.819 49.337,16.752 49.762,18.059 C50.186,19.366 49.839,20.772 48.856,21.73 L48.856,21.73 L40.107,30.259 C39.734,30.623 39.563,31.146 39.651,31.659 L39.651,31.659 L41.716,43.701 C41.899,44.759 41.622,45.792 40.935,46.605 C40.246,47.423 39.244,47.893 38.187,47.893 C37.608,47.893 37.047,47.753 36.521,47.476 L36.521,47.476 L25.706,41.79 C25.255,41.555 24.686,41.553 24.234,41.79 L24.234,41.79 L13.42,47.476 C11.932,48.258 10.071,47.872 9.005,46.605 C8.319,45.792 8.041,44.761 8.224,43.701 L8.224,43.701 L10.288,31.659 C10.376,31.147 10.205,30.623 9.832,30.259 L9.832,30.259 L1.083,21.731 C0.1,20.773 -0.247,19.367 0.177,18.06 C0.602,16.753 1.71,15.819 3.069,15.622 L3.069,15.622 L15.161,13.865 C15.676,13.79 16.122,13.467 16.352,13 L16.352,13 L21.759,2.043 C22.366,0.812 23.598,0.047 24.97,0.047 Z M124.97,0.047 C126.343,0.047 127.575,0.812 128.182,2.043 L128.182,2.043 L133.588,12.999 C133.818,13.466 134.263,13.789 134.778,13.864 L134.778,13.864 L146.87,15.621 C148.23,15.819 149.337,16.752 149.762,18.059 C150.186,19.366 149.839,20.772 148.856,21.73 L148.856,21.73 L140.107,30.259 C139.734,30.623 139.563,31.146 139.651,31.659 L139.651,31.659 L141.716,43.701 C141.899,44.759 141.622,45.792 140.935,46.605 C140.246,47.423 139.244,47.893 138.187,47.893 C137.608,47.893 137.047,47.753 136.521,47.476 L136.521,47.476 L125.706,41.79 C125.255,41.555 124.686,41.553 124.234,41.79 L124.234,41.79 L113.42,47.476 C111.932,48.258 110.071,47.872 109.005,46.605 C108.319,45.792 108.041,44.761 108.224,43.701 L108.224,43.701 L110.288,31.659 C110.376,31.147 110.205,30.623 109.832,30.259 L109.832,30.259 L101.083,21.731 C100.1,20.773 99.753,19.367 100.177,18.06 C100.602,16.753 101.71,15.819 103.069,15.622 L103.069,15.622 L115.161,13.865 C115.676,13.79 116.122,13.467 116.352,13 L116.352,13 L121.759,2.043 C122.366,0.812 123.598,0.047 124.97,0.047 Z M174.97,0.047 C176.343,0.047 177.575,0.812 178.182,2.043 L178.182,2.043 L183.588,12.999 C183.818,13.466 184.263,13.789 184.778,13.864 L184.778,13.864 L196.87,15.621 C198.23,15.819 199.337,16.752 199.762,18.059 C200.186,19.366 199.839,20.772 198.856,21.73 L198.856,21.73 L190.107,30.259 C189.734,30.623 189.563,31.146 189.651,31.659 L189.651,31.659 L191.716,43.701 C191.899,44.759 191.622,45.792 190.935,46.605 C190.246,47.423 189.244,47.893 188.187,47.893 C187.608,47.893 187.047,47.753 186.521,47.476 L186.521,47.476 L175.706,41.79 C175.255,41.555 174.686,41.553 174.234,41.79 L174.234,41.79 L163.42,47.476 C161.932,48.258 160.071,47.872 159.005,46.605 C158.319,45.792 158.041,44.761 158.224,43.701 L158.224,43.701 L160.288,31.659 C160.376,31.147 160.205,30.623 159.832,30.259 L159.832,30.259 L151.083,21.731 C150.1,20.773 149.753,19.367 150.177,18.06 C150.602,16.753 151.71,15.819 153.069,15.622 L153.069,15.622 L165.161,13.865 C165.676,13.79 166.122,13.467 166.352,13 L166.352,13 L171.759,2.043 C172.366,0.812 173.598,0.047 174.97,0.047 Z M224.97,0.047 C226.343,0.047 227.575,0.812 228.182,2.043 L228.182,2.043 L233.588,12.999 C233.818,13.466 234.263,13.789 234.778,13.864 L234.778,13.864 L246.87,15.621 C248.23,15.819 249.337,16.752 249.762,18.059 C250.186,19.366 249.839,20.772 248.856,21.73 L248.856,21.73 L240.107,30.259 C239.734,30.623 239.563,31.146 239.651,31.659 L239.651,31.659 L241.716,43.701 C241.899,44.759 241.622,45.792 240.935,46.605 C240.246,47.423 239.244,47.893 238.187,47.893 C237.608,47.893 237.047,47.753 236.521,47.476 L236.521,47.476 L225.706,41.79 C225.255,41.555 224.686,41.553 224.234,41.79 L224.234,41.79 L213.42,47.476 C211.932,48.258 210.071,47.872 209.005,46.605 C208.319,45.792 208.041,44.761 208.224,43.701 L208.224,43.701 L210.288,31.659 C210.376,31.147 210.205,30.623 209.832,30.259 L209.832,30.259 L201.083,21.731 C200.1,20.773 199.753,19.367 200.177,18.06 C200.602,16.753 201.71,15.819 203.069,15.622 L203.069,15.622 L215.161,13.865 C215.676,13.79 216.122,13.467 216.352,13 L216.352,13 L221.759,2.043 C222.366,0.812 223.598,0.047 224.97,0.047 Z M74.97,0.047 C76.343,0.047 77.575,0.812 78.182,2.043 L78.182,2.043 L83.588,12.999 C83.818,13.466 84.263,13.789 84.778,13.864 L84.778,13.864 L96.87,15.621 C98.23,15.819 99.337,16.752 99.762,18.059 C100.186,19.366 99.839,20.772 98.856,21.73 L98.856,21.73 L90.107,30.259 C89.734,30.623 89.563,31.146 89.651,31.659 L89.651,31.659 L91.716,43.701 C91.899,44.759 91.622,45.792 90.935,46.605 C90.246,47.423 89.244,47.893 88.187,47.893 C87.608,47.893 87.047,47.753 86.521,47.476 L86.521,47.476 L75.706,41.79 C75.255,41.555 74.686,41.553 74.234,41.79 L74.234,41.79 L63.42,47.476 C61.932,48.258 60.071,47.872 59.005,46.605 C58.319,45.792 58.041,44.761 58.224,43.701 L58.224,43.701 L60.288,31.659 C60.376,31.147 60.205,30.623 59.832,30.259 L59.832,30.259 L51.083,21.731 C50.1,20.773 49.753,19.367 50.177,18.06 C50.602,16.753 51.71,15.819 53.069,15.622 L53.069,15.622 L65.161,13.865 C65.676,13.79 66.122,13.467 66.352,13 L66.352,13 L71.759,2.043 C72.366,0.812 73.598,0.047 74.97,0.047 Z"></path>\n    </clipPath>\n  </svg>')}async render(){let e=await super.render(),t=document.createElement("div");e.appendChild(t);let r=e.querySelector("[type=range]");throw r.setAttribute("min","0"),r.setAttribute("max","5"),r.setAttribute("step","any"),t.appendChild(r),e.insertBefore(DOM$1.parseHTML(this.svg),t),e.classList.add("exf-star-rating-cnt"),t.classList.add("exf-star-rating"),"Not implemented"}}_defineProperty(ExoStarRatingControl,"returnValueType",Number);class ExoExtendedControls{}_defineProperty(ExoExtendedControls,"controls",{filedrop:{type:ExoFileDropControl,alias:"file",note:"An input for file uploading",demo:{max:1,fileTypes:["image/"],maxSize:4096e3,caption:"Select your profile image",containerClass:"image-upload"}},switch:{type:ExoSwitchControl},richtext:{type:ExoCKRichEditor,note:"A CKEditor wrapper for ExoForm"},tags:{caption:"Tags control",type:ExoTaggingControl,note:"A control for adding multiple tags",demo:{tags:["JavaScript","CSS","HTML"]}},multiinput:{type:MultiInputControl},creditcard:{caption:"Credit Card",type:ExoCreditCardControl,note:"A credit card control"},name:{caption:"Name (first, last) group",type:ExoNameControl,note:"Person name control"},nladdress:{caption:"Dutch address",type:ExoNLAddressControl,note:"Nederlands adres"},daterange:{caption:"Date range",type:ExoDateRangeControl,note:"A date range control"},embed:{type:ExoEmbedControl,note:"Embed anything in an IFrame",demo:{url:"https://codepen.io/chriscoyier/embed/gfdDu"}},video:{type:ExoVideoControl,caption:"Embed video",note:"An embedded video from YouTube or Vimeo",demo:{player:"youtube",code:"85Nyi4Xb9PY"}},dropdownbutton:{hidden:!0,type:DropDownButton,note:"A dropdown menu button"},captcha:{caption:"Google ReCaptcha Control",type:ExoCaptchaControl,note:"Captcha field",demo:{sitekey:"6Lel4Z4UAAAAAOa8LO1Q9mqKRUiMYl_00o5mXJrR"}},starrating:{type:ExoStarRatingControl,note:"An accessible star rating control",demo:{value:2.5}},dialog:{type:ExoDialogControl,caption:"Dialog",note:"A simple dialog (modal or modeless)"},info:{type:ExoInfoControl,note:"An info panel",demo:{title:"Info",icon:"ti-info",body:"Your informational text"}}});class ExoAceCodeEditor extends ExoBaseControls.controls.div.type{constructor(e){super(e),_defineProperty(this,"mode","html"),_defineProperty(this,"theme","chrome"),this.htmlElement.data={},this.acceptProperties({name:"mode",type:String,description:"Ace Editor mode - refer to Ace documentation"},{name:"theme",type:String,description:"Ace Editor theme - refer to Ace documentation"}),document.querySelector("html").classList.contains("theme-dark")&&(this.theme="ambiance")}async render(){const e=this;return await super.render(),e.htmlElement,e.context.field.getCurrentValue=()=>e.htmlElement.data.editor.getValue(),e.context.field.setCurrentValue=t=>{e.htmlElement.data.editor.setValue(t,-1)},new Promise(((t,r)=>{DOM$1.require("https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js",(()=>{var r=ace.edit(e.htmlElement);ace.require("ace/ext/beautify"),r.setTheme("ace/theme/"+e.theme),r.session.setMode("ace/mode/"+e.mode),e.htmlElement.style="min-height: 200px; width: 100%","string"==typeof e.value&&e.value.length&&r.setValue(e.value,-1),e.htmlElement.setAttribute("data-evtarget","true"),r.on("change",(t=>{setTimeout((()=>{DOM$1.trigger(e.htmlElement,"change",{target:e.htmlElement})}),10)})),e.htmlElement.data.editor=r,t(e.container)}))}))}setProperties(){this.context.field.mode&&(this.mode=this.context.field.mode,delete this.context.field.mode),this.context.field.theme&&(this.theme=this.context.field.theme,delete this.context.field.theme),this.context.field.value&&(this.value=this.context.field.value,delete this.context.field.value),super.setProperties()}}_defineProperty(ExoAceCodeEditor,"returnValueType",String);class ExoDevControls{}_defineProperty(ExoDevControls,"controls",{aceeditor:{type:ExoAceCodeEditor,note:"Ace code editor",demo:{mode:"html"}}});class ExoCircularChart extends ExoBaseControls.controls.div.type{constructor(e){super(e),_defineProperty(this,"value","0"),_defineProperty(this,"size","200"),_defineProperty(this,"color","#00acc1"),this.acceptProperties({name:"value",type:Number,description:"Percentual value of the chart (0-100)"},{name:"size"},{name:"color"},{name:"backgroundColor"},{name:"textColor"},{name:"subLineColor"},{name:"caption"})}async render(){const e=this.htmlElement;let t=await super.render();return e.appendChild(DOM$1.parseHTML(DOM$1.format('<svg class="circle-chart" viewbox="0 0 33.83098862 33.83098862" width="{{size}}" height="{{size}}" xmlns="http://www.w3.org/2000/svg">\n            <circle class="circle-chart__background" stroke="{{backgroundColor}}" stroke-width="2" fill="none" cx="16.91549431" cy="16.91549431" r="15.91549431" />\n            <circle class="circle-chart__circle" stroke="{{color}}" stroke-width="2" stroke-dasharray="{{value}},100" stroke-linecap="round" fill="none" cx="16.91549431" cy="16.91549431" r="15.91549431" />\n            <g class="circle-chart__info">\n              <text class="metric chart-pct" x="16.91549431" y="15.5" alignment-baseline="central" text-anchor="middle" font-size="8" >{{value}}%</text>\n              <text class="metric chart-sub" x="16.91549431" y="20.5" alignment-baseline="central" text-anchor="middle" font-size="2" >{{caption}}</text>\n            </g>\n          </svg>',this))),t}}class ExoChartControls{}_defineProperty(ExoChartControls,"controls",{circularchart:{type:ExoCircularChart,note:"Simple circular chart (SVG)",demo:{mode:"html"}}});class ExoSchemaGenerator{constructor(){_defineProperty(this,"typeMap",{string:"text",number:"number",boolean:"switch",null:"text"}),_defineProperty(this,"defaultSchema",{form:{theme:"fluent",class:"standard"},pages:[{label:"",intro:"",fields:[]}]})}generateFormSchema(e){if(!e)throw"Missing DTO";"string"==typeof e&&(e=JSON.parse(e)),this.dto=e;let t={...this.defaultSchema};for(var r in this.dto)t.pages[0].fields.push({name:r,caption:r,value:this.dto[r],...this.getMatchingFieldSettingsFuzzy(r,this.dto[r])});return t}getMatchingFieldSettingsFuzzy(e,t,r){return void 0===t&&(t=this.getDefault(r)),{type:this.typeMap[typeof t]||"text",caption:Core.toWords(e)}}getDefault(e){if(e){if("boolean"===e.type)return!1;if("number"===e.type)return 0}return""}}class ExoTheme{constructor(e){_defineProperty(this,"fieldTemplate",'<div data-id="{{id}}" class="exf-ctl-cnt {{class}}">\n    <label title="{{caption}}">\n        <div class="exf-caption">{{caption}}</div>\n        <span data-replace="true"></span>\n    </label>\n</div>'),this.name=e}}class Fluent extends ExoTheme{constructor(e){super(e)}}class ExoThemes{}_defineProperty(ExoThemes,"fluent",new Fluent("fluent"));class ExoFormDefaultValidation{constructor(e){this.exo=e,e.form.setAttribute("novalidate",!0)}checkValidity(){return 0===this.exo.query((e=>!e._control.valid)).length}reportValidity(){let e=this.exo.query((e=>!e._control.valid)).map((e=>({field:e,validationMessage:e._control.validationMessage})));if(e.length){!1!==this.exo.triggerEvent(ExoFormFactory.events.reportValidity,{invalid:e})&&this.focus(e[0].field)}}focus(e){let t=e._control.htmlElement;const r=()=>{e._control.showValidationError(),t.focus()};if(null===t.offsetParent){let e=t.closest("[data-page]");if(e){let t=parseInt(e.getAttribute("data-page"));this.exo.gotoPage(t),setTimeout((e=>r),20)}}else r();return!0}}class InlineFieldValidator{constructor(e){this._field=e,this._cnt=this._field._control.container||this._field._control.htmlElement,this._error=null,this._onInvalid=this._onInvalid.bind(this),this._onChange=this._onChange.bind(this),this.bindEventListeners()}bindEventListeners(){this._cnt&&(this._cnt.querySelectorAll("[name]").forEach((e=>{e.addEventListener("invalid",this._onInvalid)})),this._cnt.addEventListener("change",this._onChange))}showError(){if(null!==this._error)return this.updateError();this._error=DOM$1.parseHTML(DOM$1.format('<div class="exf-help">{{help}}</div>',{help:this._field._control.validationMessage})),this._cnt.setAttribute("aria-invalid","true"),this._cnt&&(this._cnt.classList.add("has-error"),this._cnt.appendChild(this._error))}updateError(){null!==this._error&&(this._error.innerHTML=this._field._control.validationMessage)}hideError(){null!==this._error&&(this._error.parentNode.removeChild(this._error),this._error=null),this._cnt.removeAttribute("aria-invalid"),this._cnt&&this._cnt.classList.remove("has-error")}_onInvalid(e){e.preventDefault()}_onChange(e){this._field._control.valid?this.hideError():this.showError()}}class ExoFormInlineValidation extends ExoFormDefaultValidation{constructor(e){super(e);const t=e.form;e.on(ExoFormFactory.events.interactive,(r=>{e.query().forEach((e=>{e._control._validator=new InlineFieldValidator(e)})),t.setAttribute("novalidate",!0)}))}reportValidity(e){const t=e?t=>t._page.index===e&&!t._control.valid:e=>!e._control.valid;this.exo.query(t).forEach((e=>{e._control._validator.showError()}))}}class ExoFormValidation{}_defineProperty(ExoFormValidation,"types",{default:ExoFormDefaultValidation,inline:ExoFormInlineValidation});class ExoFormNavigationBase{constructor(e){_defineProperty(this,"buttons",{}),this.exo=e,this._visible=!0}get visible(){return this._visible}set visible(e){this._visible=e,this.exo.form.querySelector(".exf-nav-cnt")&&DOM$1[this._visible?"show":"hide"]()}clear(){let e=this.exo.form.querySelector(".exf-nav-cnt");e&&e.remove()}render(){for(var e in this.container=DOM$1.parseHTML('<fieldset class="exf-cnt exf-nav-cnt"></fieldset>'),this.buttons)this.addButton(e,this.buttons[e]);this.exo.form.appendChild(this.container)}canMove(e,t){return console.debug("Check navigation from",e,"to",t),!0}addButton(e,t){t={class:"",type:"button",caption:e,name:e,...t||{}};let r=DOM$1.parseHTML(DOM$1.format('<button name="{{name}}" type="{{type}}" class="btn {{class}}">{{caption}}</button>',t));this.buttons[e].element=r,this.container.appendChild(r)}update(){}}class ExoFormNoNavigation extends ExoFormNavigationBase{next(){this.exo.nextPage()}back(){this.exo.previousPage()}restart(){this.exo.gotoPage(1)}}class ExoFormDefaultNavigation extends ExoFormNoNavigation{constructor(...e){super(...e),_defineProperty(this,"buttons",{send:{caption:"Submit",class:"form-post"}})}render(){const e=this;super.render(),this.buttons.send.element.addEventListener("click",(t=>{t.preventDefault(),e.exo.submitForm()}))}}class ExoFormWizardNavigation extends ExoFormDefaultNavigation{constructor(...e){super(...e),_defineProperty(this,"buttons",{prev:{caption:"Back",class:"form-prev"},next:{caption:"Next ",class:"form-next"},send:{caption:"Submit",class:"form-post"}})}render(){const e=this;super.render(),this.buttons.prev.element.addEventListener("click",(t=>{t.preventDefault(),e.back()})),this.buttons.next.element.addEventListener("click",(t=>{t.preventDefault(),e.next()})),e.exo.on(ExoFormFactory.events.page,(t=>{let r=t.detail.page,o=t.detail.pageCount;DOM$1[1===r?"disable":"enable"](e.buttons.prev.element),DOM$1[r===o?"disable":"enable"](e.buttons.next.element)}))}}class ExoFormSurveyNavigation extends ExoFormWizardNavigation{render(){const e=this;super.render();e.exo.form.querySelector(".exf-wrapper").addEventListener("change",(t=>{let r=t.target.closest("[data-exf]");r&&r.data&&r.data.field&&e.checkForward(r.data.field,"change",t)})),e.exo.form.addEventListener("keydown",(t=>{if(8===t.keyCode)(""===t.target.value&&!t.target.selectionStart||0===t.target.selectionStart)&&(e.exo.previousPage(),t.preventDefault(),t.returnValue=!1);else if(13===t.keyCode&&"textarea"!==t.target.type){let r=t.target.closest("[data-exf]"),o=ExoFormFactory.getFieldFromElement(r);e.checkForward(o,"enter",t),t.preventDefault(),t.returnValue=!1}})),e.exo.on(ExoFormFactory.events.page,(t=>{e.focusFirstControl()}));let t=e.exo.form.closest(".exf-container");t.classList.add("exf-survey"),e.exo.on(ExoFormFactory.events.interactive,(r=>{e.exo.form.style.height=t.offsetHeight+"px",e.exo.form.querySelectorAll(".exf-page").forEach((e=>{e.style.height=t.offsetHeight+"px"}))}))}focusFirstControl(){var e=this.exo.form.querySelector(".exf-page.active .exf-ctl-cnt");e&&null!==e.offsetParent&&(e.closest(".exf-page").scrollIntoView(),setTimeout((t=>{let r=e.querySelector("[name]");r&&r.offsetParent&&r.focus()}),20))}checkForward(e,t,r){const o=this.exo;if(o.container&&(o.container.classList.remove("end-reached"),o.container.classList.remove("step-ready"),e._control.valid||!o.formSchema.multiValueFieldTypes.includes(e.type)))if(o.currentPage==o.getLastPage())o.container.classList.add("end-reached"),o.form.appendChild(o.container.querySelector(".exf-nav-cnt"));else{let t=e.type;r.detail&&r.detail.field&&(t=r.detail.field),["checkboxlist","tags"].includes(t)?o.container.classList.add("step-ready"):o.nextPage(),e._control.container.appendChild(o.container.querySelector(".exf-nav-cnt"))}}}class ExoFormNavigation{static getType(e){let t=e.formSchema.navigation;return"auto"===t&&(t=ExoFormNavigation.matchNavigationType(e)),ExoFormNavigation.types[t]}static matchNavigationType(e){return e.formSchema.pages.length>1?"wizard":"default"}}_defineProperty(ExoFormNavigation,"types",{auto:void 0,none:ExoFormNoNavigation,default:ExoFormDefaultNavigation,wizard:ExoFormWizardNavigation,survey:ExoFormSurveyNavigation});class ExoFormContext{constructor(e){this.library=this.enrichMeta(e),this.themes=ExoThemes,this._theme=this.themes.fluent}enrichMeta(e){const t=this.createForm();for(var r in t.load({pages:[{}]}),e){let o=e[r],n={exo:t,field:{name:r,type:r}},a="base"!==r?new o.type(n):{acceptedProperties:[]};o.returns=o.returnValueType?o.returnValueType.name:"None",o.element=a.htmlElement?a.htmlElement.tagName.toLowerCase():"none",o.properties=this.getProps(o,o.type,a),o._key=r}return e}getProps(e,t,r){let o={};return e.returnValueType&&(o.name={type:"string",description:"Name of the field. Determines posted value key"},o.required={type:"boolean",description:"Makes the field required. The form cannot be posted when the user has not entered a value in thisn field."}),o.caption={type:"string",description:"Caption text. Normally shown in a label element within the field container"},r&&r.acceptedProperties.length&&r.acceptedProperties.forEach((e=>{let t=e;"object"==typeof e&&(t=e.name),delete e.name,e.type=e.type||String,e.type=e.type.name,o[t]=e})),o}createForm(e){return new ExoForm(this,e)}get(e){return this.library[e]}query(e){for(var t in this.library){var r=this.library[t];if(e.apply(this,[r]))return r}}isExoFormControl(e){return this.get(e.type).type.prototype instanceof ExoFormFactory.library.base.type}renderSingleControl(e){return this.createForm().renderSingleControl(e)}createGenerator(){return new ExoSchemaGenerator}get theme(){return this._theme}set theme(e){if(!this.themes[e])throw"Theme not registered";this._theme=this.themes[e]}}class ExoFormFactory{static build(e){return e=e||{},new Promise(((t,r)=>{var o=[];e.imports=e.imports||this.defaults.imports,this.add(ExoBaseControls.controls),this.add(ExoExtendedControls.controls),this.add(ExoDevControls.controls),this.add(ExoChartControls.controls),e.add&&e.imports.push(...e.add),e.imports.forEach((e=>{o.push(ExoFormFactory.loadLib(e))})),Promise.all(o).then((()=>{let r=ExoFormFactory.buildLibrary();console.debug("ExoFormFactory loaded library",r,"from",e.imports),t(new ExoFormContext(r))}))}))}static buildLibrary(){for(var e in ExoFormFactory.library){var t=ExoFormFactory.library[e];t.typeName=e,t.returnValueType=String,t.type=this.lookupBaseType(e,t),t.isList=t.type.prototype instanceof ExoFormFactory.library.list.type,t.isList&&(t.isMultiSelect=t.type.isMultiSelect),t.returnValueType=t.type.returnValueType,["date"].includes(t.typeName)&&(t.returnValueType=Date)}return ExoFormFactory.library}static lookupBaseType(e,t){let r=t.type;for(;void 0===r&&t.base;)(t=this.library[t.base])||console.error("Invalid base type",t.base),r=t.type,r.prototype instanceof ExoFormFactory.library.base.type||console.error("Class for "+e+" is not derived from ExoControlBase");return r}static async loadLib(e){let t=(await import(e)).default;this.add(t.controls)}static add(e){for(var t in e){var r=e[t];ExoFormFactory.library[t]=r}}static listNativeProps(e){let t=e.__proto__,r=Object.getOwnPropertyNames(t),o=["style","class","accesskey","contenteditable","dir","disabled","hidefocus","lang","language","tabindex","title","unselectable"," xml:lang"];return r.forEach((e=>{void 0!==Object.getOwnPropertyDescriptor(t,e).set&&o.push(e.toLowerCase())})),o}static loadCustomControl(e,t){return ExoFormFactory.importType(t)}static async importType(e){return await import(e)}static checkTypeConversion(e,t){let r,o=ExoFormFactory.library[e];if(o)try{r=ExoFormFactory.getTypeParser(o)(t),r!==t&&console.debug("Value '",t,"' for field",e," converted to",r,typeof r)}catch(e){console.error("Error converting '"+r+"'to "+o.returnValueType,e)}return r}static getTypeParser(e){switch(e.returnValueType){case Number:return Number.parseFloat;case Date:return ExoFormFactory.parseDate;case Boolean:return ExoFormFactory.parseBoolean;default:return e=>e}}static parseDate(e){let t=Date.parse(e);return isNaN(t)?t:new Date(t).toJSON()}static parseBoolean(e){return parseInt(e)>0||"1"===e||"true"===e||"on"===e}static getFieldFromElement(e){let t=null;return e.getAttribute("data-exf")?t=e.data.field:e.classList.contains("exf-ctl-cnt")?(e=e.querySelector("[data-exf]"))&&(t=e.data.field):(e=e.closest("[data-exf]"))&&(t=e.data.field),t}static fieldToString(e){if(e){let t=e.type||"unknown type";if(e.isPage)return"Page "+e.index+" ("+t+")";if(e.name||e.id&&e.elm)return"Field '"+(e.name||e.id)+"' ("+t+")"}return"Unknown field"}}_defineProperty(ExoFormFactory,"_ev_pfx","exf-ev-"),_defineProperty(ExoFormFactory,"events",{beforePage:ExoFormFactory._ev_pfx+"before-page",page:ExoFormFactory._ev_pfx+"page",getListItem:ExoFormFactory._ev_pfx+"get-list-item",post:ExoFormFactory._ev_pfx+"post",renderStart:ExoFormFactory._ev_pfx+"render-start",renderReady:ExoFormFactory._ev_pfx+"render-ready",change:ExoFormFactory._ev_pfx+"change",reportValidity:ExoFormFactory._ev_pfx+"report-validity",schemaLoaded:ExoFormFactory._ev_pfx+"form-loaded",interactive:ExoFormFactory._ev_pfx+"form-interactive"}),_defineProperty(ExoFormFactory,"navigation",ExoFormNavigation),_defineProperty(ExoFormFactory,"validation",ExoFormValidation),_defineProperty(ExoFormFactory,"Context",ExoFormContext),_defineProperty(ExoFormFactory,"defaults",{imports:[]}),_defineProperty(ExoFormFactory,"html",{classes:{formContainer:"exf-container",pageContainer:"exf-page",elementContainer:"exf-ctl-cnt"}}),_defineProperty(ExoFormFactory,"library",{});class RouteModule{constructor(e,t,r){if(_defineProperty(this,"title","Module"),_defineProperty(this,"menuIcon","ti-test"),this.route=t,this.app=e,this.path=r,!e)throw"RouteModule constructor parameter 'app' not defined";if(!e.config)throw"app.config not defined"}init(){}_unload(){document.head.querySelectorAll("[data-pwa]").forEach((e=>{e.remove()})),this.unload()}unload(){}async asyncInit(){return Promise.resolve()}execute(){const e=this;e.asyncInit().then((()=>{e._beforeRender(),e.app.UI.areas.title&&e.app.UI.areas.title.set(e.title),e.render(...arguments)}))}render(){}_beforeRender(){const e=this;for(var t in e.app.UI.areas)e.app.UI.areas[t].empty=!1}}class Router{constructor(e,t,r){_defineProperty(this,"modules",[]);const o=this;Core.addEvents(this),o.app=e,o.routes=t,o.setupHashListener(r.onRoute),console.debug("Loading Route modules"),o.loadModules().then((()=>{console.debug("Loaded Route modules",o.modules),DOM$1.trigger(window,"hashchange")})).then((()=>{console.debug("Router Ready"),r.ready()}))}_triggerEvent(e,t,r){return console.debug("Triggering event",e,"detail: ",t),r||(r=new Event(e,{bubbles:!1,cancelable:!1})),r.detail={router:this,...t||{}},this.dispatchEvent(r)}on(e,t){return console.debug("Listening to event",e,t),this.addEventListener(e,t),this}static changeHash(e){history.replaceState(null,null,document.location.pathname+"#"+e)}setupHashListener(e){this.routeCallback=(t,r)=>{this._triggerEvent(Router.events.route,{module:t,path:r}),e(t,r)};const t=this;window.addEventListener("hashchange",(()=>{t.hashChanged()}))}hashChanged(){const e=this,t=window;var r=t.location.hash.substr(1);if(r.startsWith("/")){let o="/"+r.substr(1).split("/")[0],n=r.substr(o.length),a=e.routes[o];if(console.debug(t.location.hash,"RouteModule: ",a),a){let t=e.findByRoute(a);if(t&&t.module){e._route=o;let r=document.querySelector("html");r.classList.forEach((e=>{e.startsWith("route-")&&r.classList.remove(e)})),document.querySelector("html").classList.add("route-"+t.module.constructor.name),e.current&&e.current.module._unload(),e.current=t,e.routeCallback(t.module,n)}}else r.startsWith("dlg-")||e.home()}else e.home()}set route(e){if(!e.startsWith("/"))throw"Invalid route";let t=e.substring(1).split("/");if(!this.routes["/"+t[0]])throw"Unknown route: "+e;Router.changeHash(e),this.hashChanged()}get route(){return this._route}findByRoute(e){return this.modules.find((t=>t.route===e))}findById(e){return this.modules.find((t=>t.path===e))}loadModules(){const e=this;let t=[],r=!1;for(var o in e.routes){"/"===o&&(r=!0);let n=e.routes[o];if(!o.startsWith("/"))throw"Malformed route: "+o;t.push(new Promise(((t,r)=>{if(n.prototype&&n.prototype instanceof RouteModule){let r=new n(e.app,n,o);t(r)}else"string"==typeof n&&e.loadES6Module(n,e.app,n,o).then((e=>{t(e)}))})))}if(!r)throw"Router misconfiguration: no home (/) route found";return Promise.all(t).then((t=>{t.forEach((t=>{e.modules.push({...t,route:t.route,url:"#"+t.path,module:t})}))}))}loadES6Module(e){e=new URL(e,this.app.config.baseUrl);let t=Array.prototype.slice.call(arguments,1);return(async e=>{try{return await import(e)}catch(t){throw"Could not load "+e+": "+t}})(e).then((e=>{let r=new(0,e.default)(...t);return r.init(),r}))}home(){this.route="/"}generateMenu(e){const t=this;let r=[];t.modules.forEach((e=>{if(!e.hidden){let t={...e,name:e.module.constructor.name};t.menuTitle=t.menuTitle||e.title;let o=DOM$1.format('<li class="{{class}}" data-module="{{name}}" title="{{title}}"><a href="{{url}}"><span class="{{menuIcon}}"></span> <span class="name">{{menuTitle}}</span></a></li>',t);r.push(o)}}));let o=DOM$1.format('<nav class="main-menu"><ul>{{inner}}</ul></nav>',{inner:r.join("")});return e.add(DOM$1.parseHTML(o)),e.element.addEventListener("click",(e=>{const t=this;e.target.closest("li")&&(t.app.UI.areas.menu.element.classList.add("clicked"),this.touchStarted||setTimeout((()=>{t.app.UI.areas.menu.element.classList.remove("clicked"),t.touchStarted=!1}),1500))})),e.element.addEventListener("touchstart",(e=>{if(this.touchStarted=!0,t.config.areas.menu){let r=e.target.closest(t.config.areas.menu);r&&(e.target.closest("li")?r.classList.add("clicked"):r.classList.remove("clicked"))}})),e}}_defineProperty(Router,"_ev_pfx","pwa-ev-"),_defineProperty(Router,"events",{route:Router._ev_pfx+"route"});class PWA_Notifications{constructor(e){this.UI=e}add(e,t){t=t||{type:"info"},e?"string"!=typeof e&&(e=e.toString()):e="An unknown error has occurred";let r=DOM$1.parseHTML(DOM$1.format('\n            <div class="pwa-notif pwa-{{type}}">\n                <div class="pwa-cnt">\n                    <span>{{msg}}</span>\n                    <div class="pwa-notif-btns"></div>\n                    <progress value="100" max="100"></progress>\n                </div>\n            </div>\n        ',{type:t.type,msg:e}));if(t.buttons){let e=r.querySelector(".pwa-notif-btns");for(var o in t.buttons){let r=t.buttons[o],n=DOM$1.parseHTML(DOM$1.format('<button class="btn">{{caption}}</button>',r));e.appendChild(n),n.addEventListener("click",(e=>{e.stopPropagation(),r.click(e)}))}}r.addEventListener("click",(()=>{r.remove()}));const n=t.timeout||2e3+200*e.split(" ").length;document.body.appendChild(r);let a=r.querySelector("progress");a.setAttribute("value","100");var i,s=100;i=setInterval((()=>{s--,a.setAttribute("value",s.toString()),s<=0&&clearInterval(i)}),n/100),setTimeout((()=>{r.classList.add("move-out"),setTimeout((()=>{r.remove()}),2e3)}),n)}}class PWA_Area{constructor(e,t){this.name=e;this.element=t,this.checkPinnable()}add(e){if(e)try{"string"==typeof e&&(e=-1===e.indexOf("<")?DOM$1.parseHTML("<span>"+e+"</span>"):DOM$1.parseHTML(e)),this.element.appendChild(e)}catch(t){throw"Area.add failed for "+e+". "+t.toString()}}set(e){this.element.innerHTML=e}clear(){this.set("")}checkPinnable(){const e=this;e.element.classList.contains("pwa-pinnable")&&(e.element.addEventListener("mouseover",(t=>{t.offsetX>e.element.offsetWidth-70&&t.offsetY<70?(e.pinActive=!0,e.element.classList.add("pin-active")):e.pinActive&&(e.pinActive=!1,e.element.classList.remove("pin-active"))})),e.element.addEventListener("click",(t=>{e.pinActive&&(e.pinned=!e.pinned)})))}get pinned(){return this.element.classList.contains("pinned")}set pinned(e){this.element.classList[e?"add":"remove"]("pinned"),e||this.element.classList.remove("pin-active")}set busy(e){e?this.element.classList.add("pwa-loading"):this.element.classList.remove("pwa-loading")}get busy(){this.element.classList.add("pwa-loading")}set empty(e){clearTimeout(this.rtimer),clearTimeout(this.atimer),e?(this.element.classList.remove("remove"),this.rtimer=setTimeout((()=>{this.element.classList.remove("add")}),100),this.element.classList.add("pwa-empty-state","add")):(this.element.classList.add("remove"),this.rtimer=setTimeout((()=>{this.element.classList.remove("pwa-empty-state","remove")}),500))}get empty(){return this.element.classList.includes("pwa-empty-state")}}class PWA_UI{constructor(e){_defineProperty(this,"_dirtyMessage","If you continue your changes will not be saved."),_defineProperty(this,"_dirty",!1),_defineProperty(this,"areas",{}),_defineProperty(this,"notifications",new PWA_Notifications(this));const t=this;this.pwa=e,this.html=document.querySelector("html"),this.pwa.id&&this.html.setAttribute("id",this.pwa.id),this.pwa.config.UI.user={prefersDarkScheme:!!window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,currentTheme:localStorage.getItem("theme")||"light"},this.pwa.config.UI.allowUserSelection||this.html.classList.add("no-user-select"),"ontouchstart"in window&&this.html.classList.add("pwa-touch"),this.forceTheme?this.theme=this.forceTheme:void 0===this.pwa.config.UI.user.currentTheme?this.theme=this.pwa.config.UI.user.prefersDarkScheme?"dark":"light":this.theme=this.pwa.config.UI.user.currentTheme,window.addEventListener("beforeunload",(function(e){e.preventDefault(),t.dirty?e.returnValue="":delete e.returnValue})),this._setAreas()}set dirty(e){this._dirty=!0}get dirty(){return this._dirty}_setAreas(){let e=document.querySelectorAll("[data-pwa-area]");if(!e.length)throw"No PWA areas defined";e.forEach((e=>{var t=e.getAttribute("data-pwa-area");this.areas[t]=new PWA_Area(t,e)}))}get theme(){return this._theme||"light"}set theme(e){this._theme=e;let t=document.querySelector("head > meta[name='color-scheme']");t?(t.setAttribute("content",e),localStorage.setItem("theme",e),document.querySelector("html").classList.remove("theme-dark","theme-light"),document.querySelector("html").classList.add("theme-"+e)):console.warn("Theming depends on meta[name='color-scheme']")}addStyleSheet(e){DOM.addStyleSheet(e,{"data-pwa":this.pwa.router.current.path})}async showDialog(e){(await window.xo.form.factory.build()).createForm().renderSingleControl({...e||{},type:"dialog"}).then((e=>{window.xo.form.factory.getFieldFromElement(e)._control.show()}))}}class PWA_SignalR{constructor(e){this.app=e}async init(){return new Promise(((e,t)=>{const r=this.app.config.signalR;r&&r.enabled?DOM$1.require("https://cdn.jsdelivr.net/npm/@aspnet/signalr@1.1.2/dist/browser/signalr.js",(()=>{const t=(new signalR.HubConnectionBuilder).withUrl(r.notificationServiceUrl+"/api").configureLogging(signalR.LogLevel[r.logLevel]).build();t.on("newMessage",(e=>{this.app.triggerEvent("eventhub.topic."+e.notificationDTO.useCase,{...e.notificationDTO})})),t.onclose((()=>console.log("disconnected"))),console.log("Starting signalR connection ",r.notificationServiceUrl),t.start().then((()=>!0)).catch(console.error),e()})):e()}))}}class PWA{constructor(e){_defineProperty(this,"defaults",{UI:{allowUserSelection:!1},serviceWorker:{src:null}});const t=this;Core.addEvents(this),document.querySelector("html").classList.add("pwa-signin-pending"),this.config={...this.defaults,...e||{}},this.config.baseUrl=document.location.origin,this.config.environment=["localhost","127.0.0.1"].includes(document.location.hostname)?"debug":"prod",console.debug("Checking for serviceWorker in config: serviceWorker.src"),t.config.serviceWorker.src&&t.registerWorker(t.config.serviceWorker),console.debug("PWA Config",this.config),this.signalR=new PWA_SignalR(this).init().then((()=>{this.asyncInit().then((()=>{this.UI=new PWA_UI(this),t.init(),t.execute()}))}));let r=document.querySelector("html").classList;this.forceTheme=r.contains("theme-dark")?"dark":r.contains("theme-light")?"light":void 0,r.add("pwa-env-"+this.config.environment)}triggerEvent(e,t,r){return console.debug("Triggering event",e,"detail: ",t),r||(r=new Event(e,{bubbles:!1,cancelable:!0})),r.detail={exoForm:this,...t||{}},this.dispatchEvent(r)}on(e,t){return console.debug("Listening to event",e,t),this.addEventListener(e,t),this}registerWorker(e){console.debug("Register PWA ServiceWoker..."+e.src),"serviceWorker"in navigator&&navigator.serviceWorker.register(e.src).then((function(e){console.debug("Registration successful, scope is:",e.scope)})).catch((function(e){console.log("Service worker registration failed, error:",e)}))}init(){}asyncInit(){return Promise.resolve()}execute(e){const t=this;this.setupUI(),t.router=new Router(t,this.config.routes,{onRoute:(e,t)=>{console.debug("PWA Executes Route",e,t),this.triggerEvent("pwa.route",{module:e,path:t})&&e.execute(t)},ready:()=>{console.debug("PWA Router Ready"),t.routerReady()}})}rest(e,t){const r=this,o=new Headers;t=t||{},e=new URL(e,this.config.baseUrl);const n={method:"GET",...t};let a=e=>Promise.resolve();return t.isAnonymous||(a=()=>r.getToken.apply(r)),a().then((r=>{if(r&&r.accessToken?o.append("Authorization","Bearer "+r.accessToken):console.warn("No JWT Token provided. Continuing anonymously"),t.headers)for(var a in t.headers)o.append(a,t.headers[a]);return n.headers=o,fetch(e,n).then((e=>e.json()))}))}get signedIn(){return null!=window.account}getToken(){return Promise.resolve()}setupUI(){}routerReady(){}}_defineProperty(PWA,"RouteModule",RouteModule),_defineProperty(PWA,"Router",Router);class ExoRouteModule extends PWA.RouteModule{async asyncInit(){this.exoContext=await ExoFormFactory.build()}}class ExoWizardRouteModule extends ExoRouteModule{constructor(...e){super(...e),_defineProperty(this,"title","Wizard"),_defineProperty(this,"menuIcon","ti-wand")}formLoaded(){}wizardRendered(){}post(e){alert(JSON.stringify(e,null,2))}event(e){}unload(){this.app.UI.areas.main.clear();let e=document.querySelector(".exf-wiz-step-cnt");e&&e.remove(),document.body.classList.remove("exf-fs-progress")}render(){const e=this;e.engine=e.exoContext.createForm({host:e}).on(ExoFormFactory.events.post,(t=>{e.post(t.detail.postData)}));let t=null;t=e.wizardSettings.url?new URL(e.wizardSettings.url,e.app.config.baseUrl).toString():e.wizardSettings.schema,e.engine.load(t).then((t=>{e.formLoaded(),t.addEventListener(ExoFormFactory.events.page,(t=>{DOM$1.changeHash(e.path+"/page/"+t.detail.page)})),t.renderForm().then((t=>{e.app.UI.areas.main.clear(),e.app.UI.areas.main.add(t.container),e.wizardRendered(t)}))}))}}class MsIdentity{constructor(e){_defineProperty(this,"options",{mode:"redirect",libUrl:"https://alcdn.msauth.net/browser/2.7.0/js/msal-browser.js",msal:{auth:{clientId:"<clientid>",authority:"<authority>",redirectUri:document.URL.split("#")[0]},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:(e,t,r)=>{if(!r)switch(e){case msal.LogLevel.Error:return void console.error(t);case msal.LogLevel.Info:return void console.info(t);case msal.LogLevel.Verbose:return void console.debug(t);case msal.LogLevel.Warning:return void console.warn(t)}}}},loginRequest:{scopes:["User.Read"]},tokenRequest:{scopes:["User.Read"],forceRefresh:!1}}});e=e||{},this.options={...this.options,...e}}async load(){const e=this;return await new Promise(((t,r)=>{e.require(e.options.libUrl,(r=>{console.debug(e.options.libUrl,"loaded"),e.init(),t(this)}))}))}require(e,t){var r=document;r.querySelectorAll("head");let o=r.createElement("script");o.src=e,r.head.appendChild(o),o.onload=t}static trigger(e){let t=new Event("msid");t.detail=e,document.body.dispatchEvent(t)}init(){var e=this;e.myMSALObj=new msal.PublicClientApplication(e.options.msal),"popup"!==e.options.mode&&e.myMSALObj.handleRedirectPromise().then((t=>{e.handleResponse(t)})).catch((e=>{console.error(e)})),e.getAccount()}signIn(e){var t=this;t.getAccount()||("popup"===t.options.mode?t.myMSALObj.loginPopup(t.options.msal.loginRequest).then((e=>{null!==e&&(t.account=e.account,t.signedIn())})).catch((e=>{console.error(e)})):t.myMSALObj.loginRedirect(t.options.msal.loginRequest))}signedIn(){MsIdentity.trigger({type:"signedIn",account:this.account,mode:this.options.mode})}signOut(){var e=this;e.account&&e.myMSALObj.logout({account:e.myMSALObj.getAccountByUsername(e.account.username)}).then((()=>{MsIdentity.trigger({type:"signedOut",account:e.account,mode:e.options.mode})}))}getAccount(){var e=this;const t=e.myMSALObj.getAllAccounts();if(0===t.length)return null;if(t.length>1)throw"Multiple accounts detected.";1===t.length&&(e.account=t[0],e.signedIn())}getJWT(e){const t=this,r=t.options.msal.tokenRequest;return t.waitForInit().then((()=>{if(!e)throw"No user signed in";return r.account=t.myMSALObj.getAccountByUsername(e),t.myMSALObj.acquireTokenSilent(r).catch((e=>{if(e instanceof msal.InteractionRequiredAuthError)return t.myMSALObj.acquireTokenRedirect(r);console.warn(e)}))}))}waitForInit(){const e=e=>new Promise((t=>setTimeout(t,e)));return this.myMSALObj?e(1):e(200)}handleResponse(e){var t=this;null!==e&&(t.account=e.account,t.isBusy()||t.signedIn())}isBusy(){return this.myMSALObj.interactionInProgress()}}const xo={core:Core,dom:DOM$1,pwa:PWA,route:ExoRouteModule,form:{factory:ExoFormFactory,fields:{base:ExoBaseControls},wizard:ExoWizardRouteModule},identity:{msal:MsIdentity}};return window.xo=xo,xo}));
